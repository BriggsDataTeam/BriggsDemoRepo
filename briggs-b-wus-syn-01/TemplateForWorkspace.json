{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"workspaceName": {
			"type": "string",
			"metadata": "Workspace name",
			"defaultValue": "briggs-b-wus-syn-01"
		},
		"AzureBlobStorage1_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'AzureBlobStorage1'"
		},
		"AzureBlobStorage2_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'AzureBlobStorage2'"
		},
		"AzureBlobStorage_Parquet_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'AzureBlobStorage_Parquet'"
		},
		"AzureProdDatabase_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'AzureProdDatabase'"
		},
		"AzureSqlDatabase1_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'AzureSqlDatabase1'"
		},
		"Briggs_Dataset_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'Briggs_Dataset'"
		},
		"LS_POR99_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'LS_POR99'"
		},
		"Netsuite_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'Netsuite'"
		},
		"Netsuite_password": {
			"type": "secureString",
			"metadata": "Secure string for 'password' of 'Netsuite'"
		},
		"POR_Dataset_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'POR_Dataset'"
		},
		"RouseSFTP_password": {
			"type": "secureString",
			"metadata": "Secure string for 'password' of 'RouseSFTP'"
		},
		"Salesforce_sandbox_password": {
			"type": "secureString",
			"metadata": "Secure string for 'password' of 'Salesforce_sandbox'"
		},
		"Salesforce_sandbox_securityToken": {
			"type": "secureString",
			"metadata": "Secure string for 'securityToken' of 'Salesforce_sandbox'"
		},
		"atest_accountKey": {
			"type": "secureString",
			"metadata": "Secure string for 'accountKey' of 'atest'"
		},
		"briggs-b-wus-syn-01-WorkspaceDefaultSqlServer_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'briggs-b-wus-syn-01-WorkspaceDefaultSqlServer'"
		},
		"Bruin_RestLinkedService_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://api.bruin.com/"
		},
		"Netsuite_properties_typeProperties_userName": {
			"type": "string",
			"defaultValue": "Team-SammonsDataTeam@sammonsindustrial.com"
		},
		"RestService_Ceridian_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://us63-services.dayforcehcm.com/Api/siteprorentals/V1/Reports/"
		},
		"RouseSFTP_properties_typeProperties_host": {
			"type": "string",
			"defaultValue": "ftp.rouseservices.com"
		},
		"RouseSFTP_properties_typeProperties_userName": {
			"type": "string",
			"defaultValue": "Sitepro"
		},
		"Salesforce_sandbox_properties_typeProperties_environmentUrl": {
			"type": "string",
			"defaultValue": "https://test.salesforce.com"
		},
		"Salesforce_sandbox_properties_typeProperties_username": {
			"type": "string",
			"defaultValue": "team-sammonsdatateam@sammonsindustrial.com"
		},
		"atest_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://briggsazureblob.dfs.core.windows.net/"
		},
		"briggs-b-wus-syn-01-WorkspaceDefaultStorage_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://briggsbetawusdls01.dfs.core.windows.net"
		}
	},
	"variables": {
		"workspaceId": "[concat('Microsoft.Synapse/workspaces/', parameters('workspaceName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('workspaceName'), '/EmailSendFailure')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "SendEmailOnFailure",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": "https://prod-08.centralus.logic.azure.com:443/workflows/b24c7e82a2c14446974f719cd87126c7/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=Kf5uyDy7Il5uil24WpziKHFBOfPgNAqmNZ7fNZchaQ0",
							"connectVia": {
								"referenceName": "AutoResolveIntegrationRuntime",
								"type": "IntegrationRuntimeReference"
							},
							"method": "POST",
							"headers": {
								"content-type": "application/json"
							},
							"body": {
								"value": "{“EmailTo”: “@{pipeline().parameters.EmailTo}”,\n”Subject”: “An error has occurred in the @{pipeline().Pipeline}-pipeline”,\n”DataFactoryName”: “@{pipeline().DataFactory}”,\n”PipelineName”: “@{pipeline().Pipeline}”,\n”ActivityType”: “@{pipeline().parameters.ActivityType}”,\n”ErrorMessage”: “@{pipeline().parameters.errorMessage}”}",
								"type": "Expression"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"EmailTo": {
						"type": "string"
					},
					"ActivityType": {
						"type": "string"
					},
					"ErrorMessage": {
						"type": "string"
					}
				},
				"folder": {
					"name": "annie"
				},
				"annotations": [],
				"lastPublishTime": "2022-08-08T20:34:58Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/LOAD_POR_TEMP')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Heavy Equipment Tax_Updated",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": " SELECT distinct  CLDT\n  ,CONVERT (varchar(10),CLDT, 101) as ClosedDate\n  ,CASE LEFT(t.CNTR,1) \n\t  WHEN 'c' THEN 'Credit'\n\t  ELSE 'Invoice'\n\t  END AS TransactionType,\n      t.CNTR as 'Contract'\n\t, cust.[KEY] AS 'POR Customer'\n\t, cust.[NAME] As 'Customer Name'\n\t, cust.APILink AS NetSuiteCustomer\n\t,[STR] AS 'Store'\n\t,CASE SUBSTRING(TXTY,1,1)\n\t\t\tWHEN 'R' THEN 'Rental'\n\t\t\tWHEN 'S' THEN 'Sale'\n\t\t\tEND AS LinePrimaryStatus\n\t\t--CASE SUBSTRING(TXTY,2,1)\n\t\t--\tWHEN 'R' THEN 'Returned'\n\t\t--\tWHEN 'X' THEN 'Prev Returned'\n\t\t--\tWHEN 'H' THEN 'Not Returned. Hold'\n\t\t--\tWHEN 'S' THEN 'Sales Item'\n\t\t--\tWHEN 'A' THEN 'Sold Asset'\n\t\t--\tWHEN 'D' THEN 'Not Returned'\n\t\t--\tWHEN 'M' THEN 'Not Returned Reservation'\n\t\t--\tWHEN 'N' THEN 'Not Returned'\n\t\t--\tWHEN ' ' THEN 'Not Returned'\n\t\t--ELSE 'UNKNOWN'\n\t\t--END AS LineSecondaryStatus\n\t,cat.[Name] AS CatDesc\n\t,ifile.[KEY] AS ItemKey\n\t,ifile.NUM AS ItemNumber\n\t,ifile.[Name] As EquipDesc\n\t,FUEL\n\t,MANF AS Manufacturer\n\t,MODN AS ModelNumber\n\t,ModelYear\n\t,SerialNumber\n\t,DEPA AS AssetCost\n\t,PRIC AS ItemAmount,\n\tgetdate() last_refresh_date\n    FROM [POR].dbo.Transactions t\n        JOIN [POR].dbo.AccountingAPIQueueTR api ON api.ContractNumber = t.CNTR\n        JOIN [POR].dbo.TransactionItems i ON i.CNTR = t.CNTR\n        JOIN [POR].dbo.ItemFile ifile ON ifile.NUM = i.ITEM  ---\n        JOIN [POR].dbo.ItemCategory cat ON ifile.Category = cat.Category\n        JOIN [POR].dbo.CustomerFile cust ON cust.CNUM = t.CUSN\n        LEFT JOIN [POR].dbo.ParameterFile store ON t.[STR] = store.Store\n    WHERE \nt.STAT IN ('C', 'CR') \nAND api.NoExport = 0\nAND STORE_CITY LIKE '%TX%'\n--AND ifile.TYPE IN ('H','T')\nAND  GVWR = 1\nAND cat.[Name] !='RERENT'\norder by t.CLDT",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.Heavy_Equipment_Tax",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "POR_Dataset",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Heavy_Equipment_Tax"
								}
							}
						]
					},
					{
						"name": "TERP with Equipment Rented or Sold_Updated",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "TERP LINE ONLY_Updated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "\n SELECT ClosedDate,\nTransactionType,\nT.[Contract],\n[POR Customer],\n[NetSuiteCustomer],\n[Store],\n[RentalTotal],\n[TERPAmount],\n[DeliverToName],\n[custPickup],\n[DeliveryAddress],\n[DeliveryCity],\n[DeliveryState],\n[DeliveryZip],\n[CatDesc],\n[EquipDesc],\n[SerialNumber],\n[FUEL]\n,getdate() last_refresh_date\n  FROM\n\n --- TERP Line Item \n (\n SELECT distinct \n  CONVERT (varchar(10),CLDT, 101) as ClosedDate\n  ,CASE LEFT(t.CNTR,1) \n  WHEN 'c' THEN 'Credit'\n  ELSE 'Invoice'\n  END AS TransactionType,\n        t.CNTR as 'Contract'\n\t, cust.[KEY] AS 'POR Customer'\n\t, cust.APILink AS NetSuiteCustomer\n\t,[STR] AS 'Store'\n\t,t.RENT AS RentalTotal\n\t,i.PRIC AS TERPAmount\n\t,COALESCE(NULLIF(t.DeliverToCompany,''), NULLIF(cust.[NAME],'')) AS DeliverToName\n\t, t.Pickup AS custPickup\n\t\t,CASE t.Pickup \tWHEN 0 THEN \n\t COALESCE(NULLIF(j.SiteAddress,''), NULLIF(t.DeliveryAddress,''), NULLIF(store.STORE_STRT,''))\n\t ELSE (store.STORE_STRT)\n\t END AS DeliveryAddress\n\t, CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(NULLIF(LEFT(j.SiteCity, CHARINDEX(',',j.SiteCity + ',',  1) -1),''),NULLIF(LEFT(t.DeliveryCity, CHARINDEX(',',t.DeliveryCity + ',',  1) -1),''), NULLIF(LEFT(store.STORE_CITY, CHARINDEX(',',store.STORE_CITY + ',',  1) -1),'')) \n\tELSE LEFT(STORE_CITY, CHARINDEX(',',STORE_CITY + ',',  1) -1)\n\tEND AS DeliveryCity\n\t,CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(NULLIF(LEFT(j.SiteCity, CHARINDEX(',',j.SiteCity + ',',  1) -1),''),NULLIF(LEFT(t.DeliveryCity, CHARINDEX(',',t.DeliveryCity + ',',  1) -1),''), NULLIF(LEFT(store.STORE_CITY, CHARINDEX(',',store.STORE_CITY + ',',  1) -1),'')) \n\tELSE SUBSTRING(STORE_CITY,CHARINDEX(',',STORE_CITY)+1,3)\tEND AS DeliveryState\n\t,CASE t.Pickup \tWHEN 0 THEN \n\tCOALESCE(NULLIF(j.SiteZip,''), NULLIF(t.DeliveryZip,''), NULLIF(store.STORE_ZIP,'')) \n\tELSE NULLIF(store.STORE_ZIP,'') END AS DeliveryZip\n\n\n    FROM [POR].dbo.Transactions t\n        JOIN [POR].dbo.AccountingAPIQueueTR api ON api.ContractNumber = t.CNTR\n        JOIN [POR].dbo.TransactionItems i ON i.CNTR = t.CNTR\n        JOIN [POR].dbo.ItemFile ifile ON ifile.NUM = i.ITEM\n        JOIN [POR].dbo.ItemCategory cat ON ifile.Category = cat.Category\n        JOIN [POR].dbo.CustomerFile cust ON cust.CNUM = t.CUSN\n        LEFT JOIN [POR].dbo.CustomerJobSite j ON t.JobSite = j.Number\n        LEFT JOIN [POR].dbo.ParameterFile store ON t.[STR] = store.Store\n    WHERE \napi.NoExport = 0\nAND  ifile.[KEY] = 'EQTAX'\nAND PRIC >0\nAND STORE_CITY LIKE '%TX%'\n--AND CLDT BETWEEN DATEADD(month, DATEDIFF(month, -1, getdate()) - 2, 0) AND DATEADD(ss, -1, DATEADD(month, DATEDIFF(month, 0, getdate()), 0))\n\n\n) T\nJOIN \n--- Equipment on Rent\n(\n\n   select distinct\n   t.CNTR AS Contract\n\t,cat.[Name] AS CatDesc\n\t,ifile.[Name] As EquipDesc\n\t,SerialNumber\n\t,ifile.FUEL\n\t\n    FROM [POR].dbo.Transactions t\n        JOIN [POR].dbo.AccountingAPIQueueTR api ON api.ContractNumber = t.CNTR\n        JOIN [POR].dbo.TransactionItems i ON i.CNTR = t.CNTR\n        JOIN [POR].dbo.ItemFile ifile ON ifile.NUM = i.ITEM  ---\n        JOIN [POR].dbo.ItemCategory cat ON ifile.Category = cat.Category\n        JOIN [POR].dbo.CustomerFile cust ON cust.CNUM = t.CUSN\n        LEFT JOIN [POR].dbo.CustomerJobSite j ON t.JobSite = j.Number\n        LEFT JOIN [POR].dbo.ParameterFile store ON t.[STR] = store.Store\n    WHERE \napi.NoExport = 0\nAND t.CNTR In\n(select i.CNTR From TransactionItems i JOIN Itemfile ifile ON i.ITEM= ifile.NUM  where  [KEY] = 'EQTAX' AND PRIC >0)\nAND STORE_CITY LIKE '%TX%'\nAND ifile.TYPE IN ('H','T')\n) E ON T.Contract= E.Contract\n",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.TERP_Support",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "POR_Dataset",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "TERP_Support"
								}
							}
						]
					},
					{
						"name": "TERP LINE ONLY_Updated",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Tax Recap_Updated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "SELECT distinct \n  CONVERT (varchar(10),CLDT, 101) as ClosedDate\n  ,CASE LEFT(t.CNTR,1) \n  WHEN 'c' THEN 'Credit'\n  ELSE 'Invoice'\n  END AS TransactionType,\n        t.CNTR as 'Contract'\n\t, cust.[KEY] AS 'POR Customer'\n\t, cust.APILink AS NetSuiteCustomer\n\t,[STR] AS 'Store'\n\t,t.RENT AS RentalTotal\n\t,i.PRIC AS TERPAmount\n\t,COALESCE(NULLIF(t.DeliverToCompany,''), NULLIF(cust.[NAME],'')) AS DeliverToName\n\t, t.Pickup AS custPickup\n\t\t,CASE t.Pickup \tWHEN 0 THEN \n\t COALESCE(NULLIF(j.SiteAddress,''), NULLIF(t.DeliveryAddress,''), NULLIF(store.STORE_STRT,''))\n\t ELSE (store.STORE_STRT)\n\t END AS DeliveryAddress\n\t, CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(NULLIF(LEFT(j.SiteCity, CHARINDEX(',',j.SiteCity + ',',  1) -1),''),NULLIF(LEFT(t.DeliveryCity, CHARINDEX(',',t.DeliveryCity + ',',  1) -1),''), NULLIF(LEFT(store.STORE_CITY, CHARINDEX(',',store.STORE_CITY + ',',  1) -1),'')) \n\tELSE LEFT(STORE_CITY, CHARINDEX(',',STORE_CITY + ',',  1) -1)\n\tEND AS DeliveryCity\n\t,CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(NULLIF(LEFT(j.SiteCity, CHARINDEX(',',j.SiteCity + ',',  1) -1),''),NULLIF(LEFT(t.DeliveryCity, CHARINDEX(',',t.DeliveryCity + ',',  1) -1),''), NULLIF(LEFT(store.STORE_CITY, CHARINDEX(',',store.STORE_CITY + ',',  1) -1),'')) \n\tELSE SUBSTRING(STORE_CITY,CHARINDEX(',',STORE_CITY)+1,3)\tEND AS DeliveryState\n\t,CASE t.Pickup \tWHEN 0 THEN \n\tCOALESCE(NULLIF(j.SiteZip,''), NULLIF(t.DeliveryZip,''), NULLIF(store.STORE_ZIP,'')) \n\tELSE NULLIF(store.STORE_ZIP,'') END AS DeliveryZip\n\n\t,getdate() last_refresh_date\n    FROM [POR].dbo.Transactions t\n        JOIN [POR].dbo.AccountingAPIQueueTR api ON api.ContractNumber = t.CNTR\n        JOIN [POR].dbo.TransactionItems i ON i.CNTR = t.CNTR\n        JOIN [POR].dbo.ItemFile ifile ON ifile.NUM = i.ITEM\n        JOIN [POR].dbo.ItemCategory cat ON ifile.Category = cat.Category\n        JOIN [POR].dbo.CustomerFile cust ON cust.CNUM = t.CUSN\n        LEFT JOIN [POR].dbo.CustomerJobSite j ON t.JobSite = j.Number\n        LEFT JOIN [POR].dbo.ParameterFile store ON t.[STR] = store.Store\n    WHERE \napi.NoExport = 0\nAND  ifile.[KEY] = 'EQTAX'\nAND PRIC >0\nAND STORE_CITY LIKE '%TX%'\n--AND CLDT BETWEEN DATEADD(month, DATEDIFF(month, -1, getdate()) - 2, 0) AND DATEADD(ss, -1, DATEADD(month, DATEDIFF(month, 0, getdate()), 0))\n",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.TERP",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "POR_Dataset",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "TERP"
								}
							}
						]
					},
					{
						"name": "Tax Recap_Updated",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Heavy Equipment Tax_Updated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "select distinct CLDT,\n  CONVERT (varchar(10),CLDT, 101) as ClosedDate\n  ,CASE LEFT(CNTR,1) \n  WHEN 'c' THEN 'Credit'\n  ELSE 'Invoice'\n  END AS TransactionType,\n        t.CNTR as 'Contract'\n\t, cust.[KEY] AS 'POR Customer'\n\t, cust.APILink AS NetSuiteCustomer\n\t, cust.[Name] As 'Customer Name'\n\t, [STR] AS 'Store'\n\t, t.Rent AS 'RentTotal'\n\t, t.SALE AS 'SaleTotal'\n\t, t.Rent + t.SALE AS 'RevTotal'\n\t, t.DMG AS 'Damage Waiver'\n\t, Tax\n\t, Totl AS InvoiceTotal\n\t, CASE t.Pickup \n\tWHEN 0 THEN 'Delivery'\n\tWHEN 1 THEN 'Customer Pickup'\n\tELSE 'NA'\n\tEND AS custPickup\n\t--\t, COALESCE(NULLIF(j.SiteAddress,''), NULLIF(t.DeliveryAddress,''), NULLIF(store.STORE_STRT,'')) as DeliveryAddress\n\t\n\t,CASE t.Pickup \tWHEN 0 THEN \n\t COALESCE(NULLIF(j.SiteAddress,''), NULLIF(t.DeliveryAddress,''), NULLIF(store.STORE_STRT,''))\n\t ELSE (store.STORE_STRT)\n\t END AS DeliveryAddress\n\t, CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(NULLIF(LEFT(j.SiteCity, CHARINDEX(',',j.SiteCity + ',',  1) -1),''),NULLIF(LEFT(t.DeliveryCity, CHARINDEX(',',t.DeliveryCity + ',',  1) -1),''), NULLIF(LEFT(store.STORE_CITY, CHARINDEX(',',store.STORE_CITY + ',',  1) -1),'')) \n\tELSE LEFT(STORE_CITY, CHARINDEX(',',STORE_CITY + ',',  1) -1)\n\tEND AS DeliveryCity\n\t,CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(TRIM(NULLIF(RIGHT(j.SiteCity, NULLIF(CHARINDEX(',',REVERSE(j.SiteCity)),'') -1),'')),TRIM(NULLIF(RIGHT(t.DeliveryCity, NULLIF(CHARINDEX(',',REVERSE(t.DeliveryCity)),'') -1),''))\t,\n\tTRIM(NULLIF(RIGHT(store.STORE_CITY, NULLIF(CHARINDEX(',',REVERSE(store.STORE_CITY)),'') -1),''))) \n\tELSE TRIM(SUBSTRING(STORE_CITY,CHARINDEX(',',STORE_CITY)+1,3))\tEND AS DeliveryState\n\t,CASE t.Pickup \tWHEN 0 THEN \n\tCOALESCE(NULLIF(j.SiteZip,''), NULLIF(t.DeliveryZip,''), NULLIF(store.STORE_ZIP,'')) \n\tELSE NULLIF(store.STORE_ZIP,'') END AS DeliveryZip\n\t--,store.STORE_NAME As StoreName,\n\t--store.STORE_STRT AS StoreAddress, STORE_CITY AS StoreCity, STORE_ZIP AS StoreZipCode\n    ,getdate() last_refresh_date\n\tFROM [POR].dbo.Transactions t\n        JOIN [POR].dbo.AccountingAPIQueueTR api ON api.ContractNumber = t.CNTR\n        JOIN [POR].dbo.CustomerFile cust ON cust.CNUM = t.CUSN\n        LEFT JOIN [POR].dbo.CustomerJobSite j ON t.JobSite = j.Number\n        LEFT JOIN [POR].dbo.ParameterFile store ON t.[STR] = store.Store\n\t    WHERE t.STAT IN ('C', 'CR')  AND\n api.NoExport = 0\n-- AND CLDT BETWEEN DATEADD(month, DATEDIFF(month, -1, getdate()) - 2, 0) AND DATEADD(ss, -1, DATEADD(month, DATEDIFF(month, 0, getdate()), 0))\n order by CLDT, CNTR\n",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.Tax_Summary",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "POR_Dataset",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Tax_Summary"
								}
							}
						]
					},
					{
						"name": "POR_Open_Contract",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "SELECT\n--Below are Transaction Level Items\nCASE WHEN pf.Store <> '001' THEN RIGHT(pf.STORE_NAME, LEN(pf.STORE_NAME) - 4) ELSE pf.STORE_NAME END AS [Store_Name]\n, t.[STR] AS [Store_No]\n, CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END AS Customer_Type\n--, cf.[Key] AS [Customer Number]\n, cf.[CNUM] AS [Customer_Number]\n, cf.[Name] AS [Customer_Name]\n, t.JOBN AS [Job_Name]\n, t.JBPO AS [Job_PO]\n, t.JBID AS [Job_id]\n, cjs.Description AS [Job_Site_Name]\n, ISNULL(cjs.SiteAddress,'') + ' ' + ISNULL(cjs.SiteCity,'') + ' ' + ISNULL(cjs.SiteZip,'') AS [Job_Site_Address]\n, t.DMG AS [Extended_Protection_Plan]\n, s.[Name] AS [Contract_Salesman]\n, s2.[Name] AS [Customer_Salesman]\n, o.OPNM AS [Created_by_Operator_Name]\n, o2.OPNM AS [Assigned_to_Operator_Name] -- This drives the revenue\n, t.[DATE] AS [Contract_Date]\n, t1.OriginalContractDate AS [Original_Contract_Date]\n, t.[CNTR] AS [Contract_No]\n--Below are Item level details\n/** NOTE for this case statement --IF TXTY is RR (Called Off) then we should add ti.DDT as called off date, otherwise John doesn't want to see ti.DDT. Not sure best way to go about that in PowerBI **/\n, CASE WHEN ti.TXTY = 'R' THEN 'RENT'\nWHEN ti.TXTY = 'RR' THEN 'Returned'\nWHEN ti.TXTY = 'RX' THEN 'Previously Returned'\nWHEN ti.TXTY = 'RH' THEN 'Not Returned. Item on hold for pickup'\nWHEN ti.TXTY = 'RD' THEN 'Not Returned. Demand letter sent'\nWHEN ti.TXTY = 'RM' THEN 'Not Returned. Reservation Reminder letter sent'\nWHEN ti.TXTY = 'RN' THEN 'Not Returned. Reminder letter sent'\nWHEN ti.TXTY = 'RV' THEN 'Not Returned. Reservation Verify letter sent'\nWHEN ti.TXTY = '' THEN 'Not Returned. No letters have been sent'\nELSE 'Sale Item' END AS [Item_Status]\n, ifi.Header -- John wants to see HEADER key that each ITEM belongs too for grouping/pivot/lookup purposes\n--, ti.ITEM AS [Key]\n\n, ifi.[KEY] \n, ifi.Name\n, ifi.SerialNumber AS [Serial_Number]\n, ifi.MANF AS [Make]\n, ifi.MODN AS [Model]\n, ifi.Modelyear AS [Model_Year]\n, ti.PRIC AS [Amount_Charged]\n, ti.DailyAmount AS [Daily]\n, ifi.RATE1 AS [Book_Rate_Daily]\n, ti.WeeklyAmount AS [Weekly]\n, ifi.RATE2 AS [Book_Rate_Weekly]\n, ti.MonthlyAmount AS [Monthly]\n, ifi.RATE3 AS [Book_Rate_Monthly]\n, CASE WHEN ti.Substatus = 7 THEN 'Substitute' ELSE '' END AS [Is_Substitute]\n, CASE WHEN ti.Substatus = 7 THEN ti.Comments ELSE '' END AS [Substitution_Comments]\n, ITF_OEC.OEC AS [OEC]\n, getdate() last_refresh_date\n, ti.ITEM AS [ItemNum]\n,oec\n,''[Job site zipcode]\nFROM POR.dbo.transactions t\nJOIN POR.dbo.TransactionItems ti ON ti.CNTR = t.CNTR\nJOIN POR.dbo.ItemFile ifi ON ifi.NUM = ti.ITEM\nJOIN POR.dbo.ParameterFile pf ON pf.Store = t.[STR]\nJOIN (SELECT t0.CNTR, t0.[DATE] AS OriginalContractDate FROM POR.dbo.Transactions t0 WHERE RIGHT(t0.CNTR,1) NOT LIKE '[A-Za-z]%') t1\nON t1.CNTR = CASE WHEN RIGHT(t.CNTR,1) LIKE '[A-Za-z]%' THEN LEFT(t.CNTR, LEN(t.CNTR)-1) ELSE t.CNTR END\nLEFT JOIN POR.dbo.ItemComments ic ON ic.NUM = ifi.NUM\nLEFT JOIN POR.dbo.CustomerFile cf ON cf.CNUM = t.CUSN\nLEFT JOIN POR.dbo.CustomerJobSite cjs ON cjs.Number = t.JobSite\nLEFT JOIN POR.dbo.Salesman s ON s.Number = t.Salesman\nLEFT JOIN POR.dbo.Salesman s2 ON s2.Number = cf.Salesman -- Example CNTR 103071 See GUI. Trans SM is Misha Tufkova, but Customer assigned SM is Daniel Lee\nLEFT JOIN POR.dbo.OperatorId o ON o.OPNO = t.OperatorCreated\nLEFT JOIN POR.dbo.OperatorId o2 ON o2.OPNO = t.OperatorAssigned -- Exampel CMTR 102919 See GUI.\nLEFT JOIN (SELECT [ItemNumber] ,sum(([QuantityPurchased] - [QuantitySold]) * ([PriceEach] + [ExtraCharges])) AS OEC\nFROM [ItemPurchaseDetail]\nWHERE [Disposed] = 0\nGROUP BY [ItemNumber]) AS ITF_OEC ON ifi.[NUM] = ITF_OEC.[ItemNumber]\nWHERE LEFT(t.STAT,1) = 'O'\nAND LEFT(t.CNTR,1) NOT IN ('q','r','s','t')\nAND (ifi.TYPE IN ('T','H','U','V','A','L','R','N','K','D') -- Include Rental types & delivery/pickup charges only; exclude sales, diesel, etc.\nOR ifi.Name LIKE 'Delivery%' --2. Sale items to include\nOR ifi.Name LIKE 'Pickup%' --3. Sale items to include\\\n)\nAND t.STAT NOT IN ('OH','RR','OR')\nAND ti.TXTY <> 'RR'\nORDER BY [Store_Name], cf.[NAME], t.[DATE] ASC, t.CNTR, s.[Name]",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.POR_Open_Contracts",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "Store_Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Store_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Store_No",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Store_No",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer_Type",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Customer_Type",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer_Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer_Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer_Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job_Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job_PO",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job_PO",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job_ID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job_Site_Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job_Site_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job_Site_Address",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job_Site_Address",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Extended_Protection_Plan",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Extended_Protection_Plan",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Contract_Salesman",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Contract_Salesman",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer_Salesman",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer_Salesman",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Created_by_Operator_Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Created_By_Operator_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Assigned_to_Operator_Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Assigned_To_Operator_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Contract_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Original_Contract_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Original_Contract_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Contract_No",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Contract_No",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Item_Status",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Item_Status",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "KEY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Key",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Serial_Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Serial_Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model_Year",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model_Year",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Amount_Charged",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Amount_Charged",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Daily",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Daily",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Book_Rate_Daily",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Book_Rate_Daily",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Weekly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Weekly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Book_Rate_Weekly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Book_Rate_Weekly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Monthly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Monthly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Book_Rate_Monthly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Book_Rate_Monthly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Is_Substitute",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Is_Substitute",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Substitution_Comments",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Substitution_Comments",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "last_refresh_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "last_refresh_date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "ItemNum",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemNum",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "OEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "OEC",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "Job site zipcode",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Job Site ZipCode",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "POR_Dataset",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "POR_Open_Contracts"
								}
							}
						]
					},
					{
						"name": "Inventory",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "POR_Open_Contract",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "/*\nDATA PULL_Inventory_approved_v2\nLast edit:  2022 March 22\n*/\n\n--Temp table (1/1)\tHave system generate unique dates\n--IF OBJECT_ID('tempdb..#DateRange') IS NOT NULL \n--   DROP TABLE #DateRange;  \n--GO\n--CREATE TABLE #DateRange (UniqueDate DATE PRIMARY KEY)\n--INSERT INTO #DateRange\n--SELECT TOP (10592) DATEADD(DAY,ROW_NUMBER() OVER (ORDER BY (SELECT 1)), '20201231') AS N\n--FROM master.dbo.spt_values v1, master.dbo.spt_values v2;\nwith DateRange_cte As\n(\n\tSELECT TOP (10592) DATEADD(DAY,ROW_NUMBER() OVER (ORDER BY (SELECT 1)), '20201231') AS UniqueDate\n\tFROM master.dbo.spt_values v1, master.dbo.spt_values v2\n)\n\n--CTEs:  amalgamate details and summary for scripted/automatic aggregation as needed\n--CTE (1/5)\t\tRepair info:  details and aggregates\n, repairs_cte AS\t\t--alias:  rc\n(\nSELECT\n  ti0.ITEM\n, summary.MaintenanceType\n, summary.TotalLaborHours\n, CAST(summary.LaborCost/NULLIF(summary.NumAssets,0) AS DECIMAL(18,2)) AS LaborCost\n, CAST(summary.ServicePartsCost/NULLIF(summary.NumAssets,0) AS DECIMAL(18,2)) AS ServicePartsCost\n, summary.OutDate\n, summary.CompletedDate\n, summary.CNTR\n, summary.DaysDown\nFROM POR.dbo.TransactionItems ti0\nJOIN POR.dbo.ItemFile ifi0 ON ifi0.NUM = ti0.ITEM\nJOIN (\n\tSELECT\n\t  details.CNTR\n\t, details.MaintenanceType\n\t, SUM(IIF(details.Asset = 1,1,0)) AS NumAssets\n\t, SUM(details.LaborHours) AS TotalLaborHours\n\t, SUM(IIF(details.Name LIKE 'labor', details.Pric,0)) AS LaborCost\n\t, SUM(IIF(details.Name NOT LIKE 'labor', details.Pric,0)) AS ServicePartsCost\n\t, MIN(details.OutDate) AS OutDate\n\t, MAX(details.CompletedDate) AS CompletedDate\n\t, DATEDIFF(d,details.OutDate,IIF(details.CompletedDate IS NULL, GETDATE(),details.CompletedDate)) AS DaysDown\n\tFROM (\n\t\tSELECT t.CNTR, ti.Sort, ifi.Asset, ifi.Name, ifi.NUM, IIF(ifi.Name LIKE '%labor%', ti.QTY, 0) AS LaborHours, ti.PRIC\n\t\t, CASE WHEN CF.[KEY] LIKE 'REPAIRS-MAINT%' THEN 'IMO'\n\t\t\tWHEN CF.[KEY] NOT LIKE 'REPAIRS-MAINT%' THEN 'IRO'\n\t\t\tEND AS [MaintenanceType]\n\t\t, CF.[KEY]\n\t\t, CAST(t.[DATE] AS DATE) AS OutDate\n\t\t, CAST(t.Completed AS DATE) AS CompletedDate\n\t\tFROM POR.dbo.Transactions t\n\t\tJOIN POR.dbo.TransactionItems ti ON ti.CNTR = t.CNTR\n\t\tJOIN POR.dbo.ItemFile ifi ON ifi.NUM = ti.ITEM\n\t\tJOIN POR.dbo.CustomerFile CF ON T.CUSN = CF.CNUM\n\t\tWHERE LEFT(t.CNTR,1) = 'r'\n\t\tAND LEFT(ti.Sort,4) <> 'zzzz'\n\t\tAND RIGHT(ifi.[KEY],2) <> 'RR'\n\t) details\n\tGROUP BY\n\t  details.CNTR\n\t, details.MaintenanceType\n\t, DATEDIFF(d,details.OutDate,IIF(details.CompletedDate IS NULL, GETDATE(),details.CompletedDate))\n) summary ON summary.CNTR = ti0.CNTR\nWHERE ifi0.Asset = 1\n)\n\n--CTE (2/5)\t\tRepair info:  Days since item was last down\n, lastCompletedDate_cte AS\t\t--alias:  lcd\n(\nSELECT ITEM, repairs_cte.MaintenanceType, repairs_cte.CompletedDate AS LastCompletedDate\n\t, ROW_NUMBER() OVER(PARTITION BY repairs_cte.ITEM ORDER BY (CASE WHEN repairs_cte.CompletedDate IS NULL THEN GETDATE() ELSE repairs_cte.CompletedDate END) DESC) AS [RowNumber]\nFROM repairs_cte\n)\n\n--CTE (3/5)\t\tRepair days:  Use unique days\n, repairDays_cte AS\t\t--alias:  rd\n(\n\tSELECT\n\t  a.ITEM\n\t, COUNT(DISTINCT CASE WHEN a.UniqueDate >= '2021-12-01' AND a.MaintenanceType = 'IMO' THEN a.UniqueDate ELSE NULL END) AS TotalDaysIMO\n\t, COUNT(DISTINCT CASE WHEN a.UniqueDate >= '2021-12-01' AND a.MaintenanceType = 'IRO' THEN a.UniqueDate ELSE NULL END) AS TotalDaysIRO\n\t, COUNT(DISTINCT CASE WHEN a.UniqueDate >= '2021-12-01' THEN a.UniqueDate ELSE NULL END) AS TotalDaysRepair\n\tFROM (\n\t\tSELECT\n\t\tti3.ITEM\n\t\t, CASE WHEN CF3.[KEY] LIKE 'REPAIRS-MAINT%' THEN 'IMO'\n\t\t\tWHEN CF3.[KEY] NOT LIKE 'REPAIRS-MAINT%' THEN 'IRO'\n\t\t\tEND AS [MaintenanceType]\n\t\t, dr3.UniqueDate\n\t\tFROM POR.dbo.Transactions t3\n\t\tJOIN POR.dbo.TransactionItems ti3 ON ti3.CNTR = t3.CNTR\n\t\tJOIN POR.dbo.ItemFile ifi3 ON ifi3.NUM = ti3.ITEM\n\t\tJOIN POR.dbo.CustomerFile CF3 ON T3.CUSN = CF3.CNUM\n\t\tJOIN DateRange_cte dr3 ON dr3.UniqueDate BETWEEN CAST(t3.[DATE] AS DATE) AND CAST(CASE WHEN t3.Completed IS NULL THEN GETDATE() ELSE CAST(t3.Completed AS DATE) END AS DATE)\n\t\tWHERE LEFT(t3.CNTR,1) = 'r'\n\t\tAND LEFT(ti3.Sort,4) <> 'zzzz'\n\t\tAND RIGHT(ifi3.[KEY],2) <> 'RR'\n\t\tGROUP BY\n\t\tti3.ITEM\n\t\t, CASE WHEN CF3.[KEY] LIKE 'REPAIRS-MAINT%' THEN 'IMO'\n\t\t\tWHEN CF3.[KEY] NOT LIKE 'REPAIRS-MAINT%' THEN 'IRO'\n\t\t\tEND\n\t\t, dr3.UniqueDate\n\t) a\n\tGROUP BY\n\t  a.ITEM\n)\n\n--CTE (4/5)\t\tContract info:  Aggregates by ITEM\n, contractRev_cte AS\t--alias:  cr\n(\nSELECT\n  c.ITEM\n, SUM(c.TotalContractRevenue) AS TotalRentalRevenue\n, SUM(c.[30d_ContractRevenue]) AS [30d_TotalRentalRevenue]\n, SUM(c.[60d_ContractRevenue]) AS [60d_TotalRentalRevenue]\n, SUM(c.[90d_ContractRevenue]) AS [90d_TotalRentalRevenue]\n, SUM(c.[180d_ContractRevenue]) AS [180d_TotalRentalRevenue]\n, SUM(c.[R12d_ContractRevenue]) AS [R12d_TotalRentalRevenue]\n, SUM(c.[YTD_ContractRevenue]) AS [YTD_TotalRentalRevenue]\n, CAST(MAX(c.MaxContractStartDate) AS DATE) AS [LastItemContractStartDate]\n, CAST(MAX(c.MaxContractDate) AS DATE) AS [LastItemContractDate]\n, CAST(MAX(c.MaxCurrentDate) AS DATE) AS [LastItemContractDate_current]\nFROM (\n\tSELECT\n\t  LEFT(b.CNTR,6) AS CNTR\n\t, b.ITEM\n\t, SUM(b.PRIC) AS TotalContractRevenue\n\t, SUM(CASE WHEN b.ARdays  = 30 THEN b.PRIC ELSE 0 END) AS [30d_ContractRevenue]\n\t, SUM(CASE WHEN b.ARdays <= 60 THEN b.PRIC ELSE 0 END) AS [60d_ContractRevenue]\n\t, SUM(CASE WHEN b.ARdays <= 90 THEN b.PRIC ELSE 0 END) AS [90d_ContractRevenue]\n\t, SUM(CASE WHEN b.ARdays <= 180 THEN b.PRIC ELSE 0 END) AS [180d_ContractRevenue]\n\t, SUM(CASE WHEN b.ARdays <= 365 THEN b.PRIC ELSE 0 END) AS [R12d_ContractRevenue]\n\t, SUM(IIF(YEAR(b.DATE) = YEAR(GETDATE()),b.PRIC,0)) AS [YTD_ContractRevenue]\n\t, MAX(b.DATE) AS MaxContractStartDate\n\t, MAX(b.MaxActualContractDate) AS MaxContractDate\n\t, MAX(b.MaxCurrentContractDate) AS MaxCurrentDate\n\tFROM (\n\t\tSELECT\n\t\t  ti0.CNTR\n\t\t, ti0.ITEM\n\t\t, ti0.PRIC\n\t\t, CASE WHEN DATEDIFF(d,t0.[DATE],GETDATE()) <= 30 THEN 30\n\t\t\tWHEN DATEDIFF(d,t0.[DATE],GETDATE()) > 30 AND DATEDIFF(d,t0.[DATE],GETDATE()) <= 60 THEN 60\n\t\t\tWHEN DATEDIFF(d,t0.[DATE],GETDATE()) > 60 AND DATEDIFF(d,t0.[DATE],GETDATE()) <= 90 THEN 90\n\t\t\tWHEN DATEDIFF(d,t0.[DATE],GETDATE()) > 90 AND DATEDIFF(d,t0.[DATE],GETDATE()) <= 180 THEN 180\n\t\t\tWHEN DATEDIFF(d,t0.[DATE],GETDATE()) > 180 AND DATEDIFF(d,t0.[DATE],GETDATE()) <= 365 THEN 365\n\t\t\tELSE 9999 END AS ARdays\n\t\t, t0.[DATE]\n\t\t, a.MaxActualContractDate\n\t\t, a.MaxCurrentContractDate\n\t\tFROM POR.dbo.Transactions t0\n\t\tJOIN POR.dbo.TransactionItems ti0 ON ti0.CNTR = t0.CNTR\n\t\tJOIN POR.dbo.ItemFile ifi0 ON ifi0.NUM = ti0.ITEM\n\t\tJOIN POR.dbo.ItemType it0 ON it0.[Type] = ifi0.[TYPE]\n\t\tJOIN (\n\t\t\t\tSELECT LEFT(ti1.CNTR,6) AS CNTRgroup, ti1.ITEM\n\t\t\t\t, MIN(t1.[DATE]) AS MinContractDate\n\t\t\t\t, MAX(CASE WHEN ti1.TXTY IN ('RR','RX') THEN ti1.DDT ELSE t1.CLDT END) AS MaxActualContractDate\t\t--basing on picked up date because they are partitioning at the item level\n\t\t\t\t, MAX(CASE WHEN t1.CLDT IS NULL THEN '3333-12-31' WHEN ti1.TXTY IN ('RR','RX') THEN ti1.DDT ELSE t1.CLDT END) AS MaxCurrentContractDate\n\t\t\t\tFROM POR.dbo.Transactions t1\n\t\t\t\tJOIN POR.dbo.TransactionItems ti1 ON ti1.CNTR = t1.CNTR\n\t\t\t\tJOIN POR.dbo.ItemFile ifi1 ON ifi1.NUM = ti1.ITEM\n\t\t\t\tWHERE ((ifi1.UserDefined1 <> '' AND t1.[DATE] >= '2021-12-01') OR ifi1.UserDefined1 = '')\n\t\t\t\tAND t1.[DATE] <= GETDATE()\n\t\t\t\tGROUP BY LEFT(ti1.CNTR,6), ti1.ITEM\n\t\t) a ON a.CNTRgroup = LEFT(ti0.CNTR,6) AND a.ITEM = ifi0.NUM\n\t\tWHERE LEFT(t0.CNTR,1) NOT IN ('q','r','s','t','w','c') \n\t\tAND LEFT(it0.TypeDescrip,6) = 'Rental'\n\t\tAND RIGHT(ifi0.[KEY],2) <> 'RR'\n\t\tAND ((ifi0.UserDefined1 <> '' AND t0.[DATE] >= '2021-12-01') OR ifi0.UserDefined1 = '')\n\t\tAND t0.[DATE] <= GETDATE()\n\t) b\n\tGROUP BY\n\t  LEFT(b.CNTR,6)\n\t, b.ITEM\n) c\nGROUP BY\n  c.ITEM\n)\n\n--CTE (5/5)\t\tTimeUt by Item info:  uses temp table at beginning of query\n, timeUt_cte AS (\t--alias:  tu\nSELECT\n  a.ITEM\n, SUM(IIF(a.UniqueDate >= CAST(IIF(DATEADD(DAY,-30,GETDATE()) < '2021-12-01', '2021-12-01',DATEADD(DAY,-30,GETDATE()+1)) AS DATE), 1, 0)) AS [30dDistinct_OnRent]\n, SUM(IIF(a.UniqueDate >= CAST(IIF(DATEADD(DAY,-90,GETDATE()) < '2021-12-01', '2021-12-01',DATEADD(DAY,-90,GETDATE()+1)) AS DATE), 1, 0)) AS [90dDistinct_OnRent]\n, SUM(IIF(a.UniqueDate >= CAST(IIF(DATEADD(DAY,-180,GETDATE()) < '2021-12-01', '2021-12-01',DATEADD(DAY,-180,GETDATE()+1)) AS DATE), 1, 0)) AS [180dDistinct_OnRent]\n, SUM(IIF(a.UniqueDate >= CAST(IIF(DATEADD(DAY,-365,GETDATE()) < '2021-12-01', '2021-12-01',DATEADD(DAY,-365,GETDATE()+1)) AS DATE), 1, 0)) AS [R12dDistinct_OnRent]\n, SUM(IIF(a.UniqueDate >= DATEADD(yy, DATEDIFF(yy, 0, GETDATE()), 0), 1, 0)) AS [YTDdistinct_OnRent]\n, SUM(IIF(a.UniqueDate >= '2021-12-01', 1, 0)) AS [TotalDistinct_UT]\nFROM (\n\tSELECT ti2.ITEM, dr.UniqueDate\n\tFROM POR.dbo.Transactions t2\n\tJOIN POR.dbo.TransactionItems ti2 ON ti2.CNTR = t2.CNTR\n\tJOIN POR.dbo.ItemFile ifi2 ON ifi2.NUM = ti2.ITEM\n\tJOIN POR.dbo.ItemPurchaseDetail ipd2 ON ipd2.ItemNumber = ifi2.NUM\n\tJOIN DateRange_cte dr ON dr.UniqueDate BETWEEN CAST(t2.[DATE] AS DATE) AND CAST(CASE WHEN t2.CLDT IS NULL THEN GETDATE() ELSE ti2.DDT END AS DATE)\n\tWHERE LEFT(t2.CNTR,1) NOT IN ('q','r','s','t','w','c')\n\tAND ifi2.SerialNumber <> ''\n\tAND t2.DATE < CAST(GETDATE() AS DATE)\n\tAND dr.UniqueDate <= GETDATE()\n\tAND dr.UniqueDate >= ipd2.PurchaseDate\n\tGROUP BY ti2.ITEM, dr.UniqueDate\n) a\nGROUP BY a.ITEM\n)\n\n\n\n--MAIN QUERY:\n--Expected approximation:  3.4k results\nSELECT\nifi.[KEY], ifi.Header, ifi.[Name], ic.[Name] AS Category, ifi.MANF AS Make, ifi.MODN AS Model\n, ifi.ModelYear AS [Model_Year], ifi.SerialNumber AS [Serial_Number]\n, DATEDIFF(m,ipd.PurchaseDate,GETDATE()) AS [Age_In_Months]\n, CAST(ipd.PurchaseDate AS DATE) AS [Original_DOP], ipd.OEC, ifi.CURV AS NBV, ifi.DEPA AS [Accum_Depr]\n, ifi.PURP AS [Acquisition_Cost], ipd.PONumber AS [PO_Number], ipd.ExtraCost AS [Extra_Cost], ifi.CurrentStore AS [Current_Store]\n, CASE WHEN pf.Store <> '001' THEN RIGHT(pf.STORE_NAME, LEN(pf.STORE_NAME) - 4) ELSE pf.STORE_NAME END AS [Store_Name]\n, it.TypeDescrip AS [Type], ifi.MTOT AS [Hours], ifi.UserDefined1 AS [Legacy_ID]\n\n--Time utilization\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[30dDistinct_OnRent] AS DECIMAL(18,2))/30.00 *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [30d_TU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[90dDistinct_OnRent] AS DECIMAL(18,2))/90.00 *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [90d_TU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[180dDistinct_OnRent] AS DECIMAL(18,2))/180.00 *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [180d_TU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[R12dDistinct_OnRent] AS DECIMAL(18,2))/365.00 *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [R12_TU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[YTDdistinct_OnRent] AS DECIMAL(18,2))/(DATEDIFF(d,DATEADD(yy, DATEDIFF(yy, 0, GETDATE()), 0),GETDATE()+1)) *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [YTD_TU]\n\n--Dollar utilization\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[30d_TotalRentalRevenue]/NULLIF(ipd.OEC,0))*12) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [30d_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[90d_TotalRentalRevenue]/NULLIF(ipd.OEC,0))*4) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [90d_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[180d_TotalRentalRevenue]/NULLIF(ipd.OEC,0))*2) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [180d_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[R12d_TotalRentalRevenue]/NULLIF(ipd.OEC,0))) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [R12_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[YTD_TotalRentalRevenue]/NULLIF(ipd.OEC,0))*(365/DATEDIFF(d,DATEADD(yy, DATEDIFF(yy, 0, GETDATE()), 0),GETDATE()))) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [YTD_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN ISNULL(cr.TotalRentalRevenue,0) ELSE NULL END AS [LTD_Revenue]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL(CAST(CAST(tu.[TotalDistinct_UT] AS DECIMAL(18,2)) / NULLIF(DATEDIFF(d,IIF(ifi.UserDefined1 <> '','2021-12-01',CAST(ipd.PurchaseDate AS DATE)),CAST(GETDATE()+1 AS DATE)),0)*100 AS DECIMAL(18,2)),0) AS VARCHAR(10)) + '%' ELSE NULL END AS [SP%_LTDTU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN ISNULL(CAST(MAX(CAST(CAST(rd.TotalDaysRepair AS DECIMAL(18,2)) / NULLIF(DATEDIFF(d,IIF(ifi.UserDefined1 <> '','2021-12-01',CAST(ipd.PurchaseDate AS DATE)),GETDATE()+1),0)*100 AS DECIMAL(18,2))) AS VARCHAR(10)),0) + '%' ELSE NULL END AS [SP%_Life_Down]\n, IIF((cr.LastItemContractDate_current = '3333-12-31' OR GETDATE() BETWEEN cr.LastItemContractStartDate AND cr.LastItemContractDate_current),'On rent', CAST(DATEDIFF(d,cr.LastItemContractDate,GETDATE())AS VARCHAR(20)) ) AS [Last_Rent_In_Days]\n\n--Maintenance/Repair\n, SUM(IIF(rc.ITEM IS NOT NULL,ISNULL(rc.TotalLaborHours,0),NULL)) AS [Total_Labor_Hours]\n, SUM(rc.LaborCost) AS [Total_Labor_Cost]\n, CASE WHEN rc.ITEM IS NOT NULL AND lcd.RowNumber = 1 AND lcd.LastCompletedDate IS NOT NULL THEN CAST(DATEDIFF(d, lcd.LastCompletedDate,GETDATE()) AS VARCHAR(20))\n\tWHEN rc.ITEM IS NOT NULL AND lcd.LastCompletedDate IS NULL THEN CAST('Down' AS VARCHAR(5))\n\tELSE NULL END AS [Days_Since_Last_Down]\n, lcd.MaintenanceType AS [Last_Down_Type]\n, SUM(IIF(rc.ITEM IS NOT NULL,IIF(rc.MaintenanceType = 'IRO',1,0),NULL)) AS [IRO_Totals]\n, rd.TotalDaysIRO AS [IRO_Days_Down]\n, SUM(IIF(rc.ITEM IS NOT NULL,IIF(rc.MaintenanceType = 'IRO',rc.LaborCost + rc.ServicePartsCost,0),NULL)) AS [IRO_Labor_Parts_Cost]\n, SUM(IIF(rc.ITEM IS NOT NULL,IIF(rc.MaintenanceType = 'IMO',1,0),NULL)) AS [IMO_Totals]\n, rd.TotalDaysIMO AS [IMO_Days_Down]\n, SUM(IIF(rc.ITEM IS NOT NULL,IIF(rc.MaintenanceType = 'IMO',rc.LaborCost + rc.ServicePartsCost,0),NULL)) AS [IMO_Labor_PartsCost]\n, GETDATE() [last_refresh_date]\nFROM POR.dbo.ItemFile ifi\nLEFT JOIN POR.dbo.ItemCategory ic ON ic.Category = ifi.Category\nJOIN POR.dbo.ItemType it ON it.[Type] = ifi.[TYPE]\nJOIN (SELECT\n\t\tipd0.ItemNumber, CASE WHEN ipd0.PONumber = 0 THEN NULL ELSE ipd0.PONumber END AS PONumber, ipd0.PurchaseDate, ipd0.ExtraCharges AS ExtraCost\n\t\t, SUM(([QuantityPurchased] - [QuantitySold]) * ([PriceEach] + [ExtraCharges])) AS OEC\n\t\t, ROW_NUMBER() OVER(PARTITION BY ipd0.ItemNumber ORDER BY ipd0.PurchaseDate) AS [RowNumber]\n\t\tFROM POR.dbo.ItemPurchaseDetail ipd0\n\t\tWHERE ipd0.QuantityPurchased > 0\n\t\tGROUP BY ipd0.ItemNumber, CASE WHEN ipd0.PONumber = 0 THEN NULL ELSE ipd0.PONumber END, ipd0.PurchaseDate, ipd0.ExtraCharges\n\t) ipd ON ipd.ItemNumber = ifi.NUM\nLEFT JOIN POR.dbo.ParameterFile pf ON pf.Store = ifi.CurrentStore\nLEFT JOIN repairs_cte rc ON rc.ITEM = ifi.NUM\nLEFT JOIN lastCompletedDate_cte lcd ON lcd.ITEM = ifi.NUM AND lcd.RowNumber = 1\nLEFT JOIN contractRev_cte cr ON cr.ITEM = ifi.NUM\nLEFT JOIN timeUt_cte tu ON tu.ITEM = ifi.NUM\nLEFT JOIN repairDays_cte rd ON rd.ITEM = ifi.NUM\n\nWHERE ifi.SerialNumber <> ''\nAND ifi.QTY > 0\nAND ipd.RowNumber = 1\nAND RIGHT(ifi.[KEY],2) <> 'RR'\n\nGROUP BY\n  ifi.[KEY], ifi.Header, ifi.NUM, ifi.[Name], ic.[Name], ifi.MANF, ifi.MODN, ifi.ModelYear, ifi.SerialNumber, ipd.PurchaseDate, ipd.PONumber, ipd.OEC, ipd.ExtraCost, ifi.CurrentStore, CASE WHEN pf.Store <> '001' THEN RIGHT(pf.STORE_NAME, LEN(pf.STORE_NAME) - 4) ELSE pf.STORE_NAME END  \n, it.TypeDescrip, ifi.MTOT, ifi.CURV, ifi.DEPA, ifi.PURP, ifi.UserDefined1\n, CASE WHEN rc.ITEM IS NOT NULL AND lcd.RowNumber = 1 AND lcd.LastCompletedDate IS NOT NULL THEN CAST(DATEDIFF(d, lcd.LastCompletedDate,GETDATE()) AS VARCHAR(20))\n\tWHEN rc.ITEM IS NOT NULL AND lcd.LastCompletedDate IS NULL THEN CAST('Down' AS VARCHAR(5))\n\tELSE NULL END, lcd.MaintenanceType\n, cr.TotalRentalRevenue\n, tu.[TotalDistinct_UT]\n, IIF((cr.LastItemContractDate_current = '3333-12-31' OR GETDATE() BETWEEN cr.LastItemContractStartDate AND cr.LastItemContractDate_current),'On rent', CAST(DATEDIFF(d,cr.LastItemContractDate,GETDATE())AS VARCHAR(20)) )\n, rd.TotalDaysIRO, rd.TotalDaysIMO\n\nORDER BY RTRIM(LTRIM(ifi.Num))\n\n--DROP TABLE #DateRange",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.Inventory",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "KEY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "KEY",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Serial_Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Serial_Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model_Year",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model_Year",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Age_In_Months",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "Age_In_Months",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Original_DOP",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "Original_DOP",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "OEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "OEC",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "NBV",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "NBV",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Accum_Depr",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Accum_Depr",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Acquisition_Cost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Acquisition_Cost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "PO_Number",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "PO_Number",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Extra_Cost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Extra_Cost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Current_Store",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Current_Store",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Category",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Category",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Type",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Type",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Hours",
											"type": "Single",
											"physicalType": "real"
										},
										"sink": {
											"name": "Hours",
											"type": "Single",
											"physicalType": "real"
										}
									},
									{
										"source": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Legacy_ID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Legacy_ID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "30d_TU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "30d_TU",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "90d_TU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "90d_TU",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "180d_TU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "180d_TU",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "R12_TU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "R12_TU",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "YTD_TU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "YTD_TU",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "30d_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "30d_$Ut%",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "90d_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "90d_$Ut%",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "180d_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "180d_$Ut%",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "R12_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "R12_$Ut%",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "YTD_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "YTD_$Ut%",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "LTD_Revenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "LTD_Revenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "SP%_LTDTU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "SP%_LTDTU",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "SP%_Life_Down",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "SP%_Life_Down",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Last_Rent_In_Days",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Last_Rent_In_Days",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Total_Labor_Hours",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "Total_Labor_Hours",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "Total_Labor_Cost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 38
										},
										"sink": {
											"name": "Total_Labor_Cost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Days_Since_Last_Down",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Days_Since_Last_Down",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Last_Down_Type",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Last_Down_Type",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "IRO_Totals",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IRO_Totals",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IRO_Days_Down",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IRO_Days_Down",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IRO_Labor_Parts_Cost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 38
										},
										"sink": {
											"name": "IRO_Labor_Parts_Cost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "IMO_Totals",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IMO_Totals",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IMO_Days_Down",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IMO_Days_Down",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IMO_Labor_PartsCost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 38
										},
										"sink": {
											"name": "IMO_Labor_PartsCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "last_refresh_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "last_refresh_date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Store_Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Store_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "POR_Dataset",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Inventory"
								}
							}
						]
					},
					{
						"name": "Purchase_Orders",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Inventory",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "--IF OBJECT_ID('tempdb..##POStatus') IS NOT NULL\n--   DROP TABLE #POStatus;\n\n--CREATE TABLE #POStatus (POStatusID VARCHAR(1) PRIMARY KEY, POStatus VARCHAR(15))\n\nDeclare @POStatus as TABLE (POStatusID VARCHAR(1) PRIMARY KEY, POStatus VARCHAR(15))\nINSERT INTO @POStatus VALUES\n('O', 'Open')\n,('B', 'BackOrdered')\n,('C', 'Closed')\n,('V', 'Voided')\n,('P', 'Requisition');\n\n --CTE (1/1)  ShipTo column - clean and normalize\n\nWITH storeName_cte AS (\nSELECT\npo.PONumber, po.Sequence, pod.LineNumber, post.Company\n, CASE WHEN post.Company LIKE '%Reserve%' THEN 'Reserve'\n       WHEN po.Notes LIKE '%Ship to%#%' THEN IIF(ISNUMERIC(LEFT(LTRIM(SUBSTRING(po.Notes,CHARINDEX('#',po.Notes)+1,LEN(po.Notes))),3))=1, LEFT(LTRIM(SUBSTRING(po.Notes,CHARINDEX('#',po.Notes)+1,LEN(po.Notes))),3), 'Reserve')\n       WHEN po.Notes LIKE '%Ship to %' THEN IIF(ISNUMERIC(LTRIM(RTRIM(SUBSTRING(post.Company, PATINDEX('%[0-9]%', post.Company), PATINDEX('%[0-9][^0-9]%', post.Company + 't') - PATINDEX('%[0-9]%', post.Company) + 1))))=1,LTRIM(RTRIM(SUBSTRING(post.Company, PATINDEX('%[0-9]%', post.Company), PATINDEX('%[0-9][^0-9]%', post.Company + 't') - PATINDEX('%[0-9]%', post.Company) + 1))) ,'Reserve')\n       WHEN po.Notes LIKE '%Reserve%' THEN 'Reserve'\n       WHEN ISNUMERIC(LTRIM(RTRIM(LEFT(post.Company,3))))=1 THEN LTRIM(RTRIM(LEFT(post.Company,3)))\n       WHEN ISNUMERIC(LEFT(LTRIM(RTRIM(SUBSTRING(post.Company, PATINDEX('%[0-9]%', post.Company), PATINDEX('%[0-9][^0-9]%', post.Company + 't') - PATINDEX('%[0-9]%', post.Company) + 1))),3)) =1 THEN CAST(LEFT(LTRIM(RTRIM(SUBSTRING(post.Company, PATINDEX('%[0-9]%', post.Company), PATINDEX('%[0-9][^0-9]%', post.Company + 't') - PATINDEX('%[0-9]%', post.Company) + 1))),3) AS VARCHAR(MAX))\n       WHEN ifi.CurrentStore > 0 THEN ifi.CurrentStore\n       ELSE 'Unknown' END AS StoreNumber\nFROM POR.dbo.PurchaseOrder po\nJOIN POR.dbo.PurchaseOrderDetail pod ON pod.PONumber = po.PONumber AND pod.[Sequence] = po.[Sequence]\nLEFT JOIN POR.dbo.PurchaseOrderShipTo post ON post.PONumber = po.PONumber AND post.[Sequence] = po.[Sequence]\nLEFT JOIN POR.dbo.ItemFile ifi ON ifi.NUM = pod.ItemNumber\nLEFT JOIN POR.dbo.ParameterFile pf ON pf.Store = ifi.CurrentStore\n)\n\n--Main select\n\nSELECT\n  po.PONumber AS [PO_Number]\n, po.Store\n, COALESCE(pf.STORE_NAME, IIF(LEN(sn.StoreNumber)=3, sn.Company,sn.StoreNumber)) AS [Ship_To]\n, po.[Sequence]\n, pod.LineNumber AS [Line_Number]\n, CASE WHEN po.[Status] <> 'C' THEN pos.POStatus WHEN po.[Status] = 'C' THEN IIF(LEN(po.InvoiceNumber)>0,'Posted','Closed') END AS [PO_Status]\n, CAST(po.[Date] AS DATE) AS [PO_Date]\n, COALESCE(NULLIF(SUBSTRING(SUBSTRING(REPLACE(pod.Comments,'EST ',''),CHARINDEX('<',pod.Comments)+1,LEN(pod.Comments)),0,CHARINDEX('>',SUBSTRING(REPLACE(pod.Comments,'EST ',''),CHARINDEX('<',pod.Comments)+1,LEN(pod.Comments)))),''),IIF(pod.QuantityOrdered = pod.QuantityReceived,CAST(pod.DateReceived AS DATE),NULL)) AS [Est_Arrival]\n, oi.OPNM AS [PO_By]\n, vh.VendorName AS [Vendor_Name]\n, pod.Comments AS [Line_Comments]\n, po.Notes AS [PO_Notes]\n, pod.ItemNumber AS [PO_Item_Num]\n, COALESCE(ifi.Header,ic.Name) AS [Header]\n, SUBSTRING(ic.[Name],0,CHARINDEX('-',ic.[Name])) AS Category\n, SUBSTRING(ic.[Name],CHARINDEX('-',ic.[Name])+1,LEN(ic.[Name])) AS [Category_Description]\n, pod.ItemName AS [Item_Name]\n, pod.QuantityOrdered AS [Quantity_Ordered]\n, pod.PriceEach AS [Price_Each]\n, pod.ExtendedPrice AS [Extended_Price]\n, CAST((pod.QuantityOrdered * pod.FreightEach) AS DECIMAL(18,2)) AS [Extended_Freight]\n, CAST((pod.QuantityOrdered * pod.TaxEach) AS DECIMAL(18,2)) AS [Extended_Tax]\n, CAST((pod.QuantityOrdered * pod.MiscEach) AS DECIMAL(18,2)) AS [Extended_Misc]\n, CAST(SUM(pod.ExtendedPrice + (pod.QuantityOrdered * pod.FreightEach) + (pod.QuantityOrdered * pod.TaxEach) + (pod.QuantityOrdered * pod.MiscEach)) AS DECIMAL(18,2)) AS [Total_Line_Amt]\n, IIF(pod.QuantityOrdered = pod.QuantityReceived,'Y','N') AS Received\n, po.InvoiceNumber AS [Invoice_Number]\n, IIF(pod.QuantityOrdered = pod.QuantityReceived, CAST(pod.DateReceived AS DATE), NULL) AS [Received_Date]\n, IIF(pod.QuantityOrdered = pod.QuantityReceived, ifi.NUM, NULL) AS [Item_Num]\n, IIF(pod.QuantityOrdered = pod.QuantityReceived, ifi.SerialNumber, NULL) AS [Serial_Number]\n, pogl.Number AS [GL_Number]\n, pogl.GLAccountNumber AS [GL_Account_Number]\n, GETDATE() [Last_Refresh_Date]\nFROM POR.dbo.PurchaseOrder po\nJOIN POR.dbo.PurchaseOrderDetail pod ON pod.PONumber = po.PONumber AND pod.[Sequence] = po.[Sequence]\nJOIN @POStatus pos ON pos.POStatusID = po.[Status]\nJOIN storeName_cte sn ON sn.PONumber = pod.PONumber AND sn.[Sequence] = pod.[Sequence] AND sn.LineNumber = pod.LineNumber\nLEFT JOIN POR.dbo.PurchaseOrderGL pogl ON pogl.Number = pod.GLNumber\nLEFT JOIN POR.dbo.VendorFile vh ON vh.VendorNumber = po.VendorNumber\nLEFT JOIN POR.dbo.ItemFile ifi ON ifi.NUM = pod.ItemNumber\nLEFT JOIN POR.dbo.ItemCategory ic ON ic.Category = ifi.Category\nLEFT JOIN POR.dbo.ParameterFile pf ON pf.Store = sn.StoreNumber\nLEFT JOIN POR.dbo.OperatorId oi ON oi.OPNO = po.Opr\nWHERE pod.GLAccount = 'Equipment ASSET Purchases'\nAND pod.QuantityOrdered > 0\nAND (LEFT(ifi.[KEY],7) <> 'SpclOrd' OR ifi.[KEY] IS NULL)\nGROUP BY\n  po.PONumber\n  , po.Store\n, COALESCE(pf.STORE_NAME, IIF(LEN(sn.StoreNumber)=3, sn.Company,sn.StoreNumber))\n, po.[Sequence]\n, pod.LineNumber\n, CASE WHEN po.[Status] <> 'C' THEN pos.POStatus WHEN po.[Status] = 'C' THEN IIF(LEN(po.InvoiceNumber)>0,'Posted','Closed') END\n, CAST(po.[Date] AS DATE)\n, COALESCE(NULLIF(SUBSTRING(SUBSTRING(REPLACE(pod.Comments,'EST ',''),CHARINDEX('<',pod.Comments)+1,LEN(pod.Comments)),0,CHARINDEX('>',SUBSTRING(REPLACE(pod.Comments,'EST ',''),CHARINDEX('<',pod.Comments)+1,LEN(pod.Comments)))),''),IIF(pod.QuantityOrdered = pod.QuantityReceived,CAST(pod.DateReceived AS DATE),NULL))\n, oi.OPNM\n, vh.VendorName\n, pod.Comments\n, po.Notes\n, pod.ItemNumber\n, COALESCE(ifi.Header,ic.Name)\n, SUBSTRING(ic.[Name],0,CHARINDEX('-',ic.[Name]))\n, SUBSTRING(ic.[Name],CHARINDEX('-',ic.[Name])+1,LEN(ic.[Name]))\n, pod.ItemName\n, pod.QuantityOrdered\n, pod.PriceEach\n, pod.ExtendedPrice\n, CAST((pod.QuantityOrdered * pod.FreightEach) AS DECIMAL(18,2))\n, CAST((pod.QuantityOrdered * pod.TaxEach) AS DECIMAL(18,2))\n, CAST((pod.QuantityOrdered * pod.MiscEach) AS DECIMAL(18,2))\n, IIF(pod.QuantityOrdered = pod.QuantityReceived,'Y','N')\n, po.InvoiceNumber\n, IIF(pod.QuantityOrdered = pod.QuantityReceived, CAST(pod.DateReceived AS DATE), NULL)\n, IIF(pod.QuantityOrdered = pod.QuantityReceived, ifi.NUM, NULL)\n, IIF(pod.QuantityOrdered = pod.QuantityReceived, ifi.SerialNumber, NULL)\n, pogl.Number\n, pogl.GLAccountNumber\n\nORDER BY po.PONumber, po.[Sequence], pod.LineNumber\n\n--DROP TABLE #POStatus\n",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.Purchase_Orders",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "PO_Number",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "PO_Number",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Store",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Store",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Ship_To",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Ship_To",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Sequence",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "Sequence",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Line_Number",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "Line_Number",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "PO_Status",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "PO_Status",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "PO_Date",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "PO_Date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "Est_Arrival",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "Est_Arrival",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "PO_By",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PO_By",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Vendor_Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Vendor_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Line_Comments",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Line_Comments",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "PO_Notes",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PO_Notes",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "PO_Item_Num",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PO_Item_Num",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Category",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Category",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Category_Description",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Category_Description",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Quantity_Ordered",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "Quantity_Ordered",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "Price_Each",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Price_Each",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Extended_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Extended_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Extended_Freight",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										},
										"sink": {
											"name": "Extended_Freight",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										}
									},
									{
										"source": {
											"name": "Extended_Tax",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										},
										"sink": {
											"name": "Extended_Tax",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										}
									},
									{
										"source": {
											"name": "Extended_Misc",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										},
										"sink": {
											"name": "Extended_Misc",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										}
									},
									{
										"source": {
											"name": "Total_Line_Amt",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										},
										"sink": {
											"name": "Total_Line_Amt",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										}
									},
									{
										"source": {
											"name": "Received",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Received",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Received_Date",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "Received_Date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "Item_Num",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Item_Num",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Serial_Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Serial_Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "GL_Number",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "GL_Number",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "GL_Account_Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "GL_Account_Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Last_Refresh_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Last_Refresh_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Item_Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Item_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Invoice_Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Invoice_Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "POR_Dataset",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Purchase_Orders"
								}
							}
						]
					},
					{
						"name": "Texas_Heavy_Equipment",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Purchase_Orders",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "SELECT\n\n  ifi.ModelYear\n\n, cat.[Name] AS CategoryName\n\n, ifi.[Name] AS ItemName\n\n, ifi.[KEY]\n\n, ifi.MANF\n\n, ifi.FUEL\n\n, ifi.PURD PurchaseDate\n\n, ifi.PURP AS purchasePrice\n\n, ifi.CURV CurrentValue\n\n, ifi.HomeStore\n\n, ifi.CurrentStore\n\n, pf.STORE_CITY\n, getdate() Refresh_DateTime\n\nFROM POR.dbo.ItemFile ifi\n\nJOIN POR.dbo.ParameterFile pf ON pf.Store = ifi.HomeStore\n\nJOIN POR.dbo.ItemCategory cat ON cat.Category = ifi.Category\n\nWHERE ifi.GVWR = 1\n\nAND ifi.Asset = 1\n\nAND pf.STORE_CITY LIKE '%TX'\n\nAND ifi.[KEY] NOT LIKE '%RR%'\n\nAND ifi.[TYPE] NOT IN ( 'A' )\n\nAND ifi.SOLD IS NULL\n\nORDER BY ifi.[KEY];",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.Texas_Heavy_Equipment",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "ModelYear",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ModelYear",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CategoryName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CategoryName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "KEY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "KEY",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "MANF",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "MANF",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "FUEL",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "FUEL",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "PurchaseDate",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "PurchaseDate",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "purchasePrice",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "PurchasePrice",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "CurrentValue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "CurrentValue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "HomeStore",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "HomeStore",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CurrentStore",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CurrentStore",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "STORE_CITY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "STORE_CITY",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Refresh_DateTime",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Refresh_DateTime",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "POR_Dataset",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Texas_Heavy_Equipment"
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "To be Deleted"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-22T14:42:29Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/POR_Dataset')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/MetTel')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "GetBearerToken",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": "https://id.bruin.com/identity/connect/token",
							"connectVia": {
								"referenceName": "AutoResolveIntegrationRuntime",
								"type": "IntegrationRuntimeReference"
							},
							"method": "POST",
							"headers": {
								"content-type": "application/x-www-form-urlencoded"
							},
							"body": "client_id=1QuQH0gebBW96Gjxs2uUn0HqKmV6LGSE&client_secret=1RNGDOBTwECQVUbgcSts52B6IcDlm6PmZkWybfqZdBGXVaRLRR7e9p1A62myJzRm&grant_type=client_credentials&scope=public_api"
						}
					},
					{
						"name": "Get raw data to csv",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "GetBearerToken",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "RestSource",
								"httpRequestTimeout": "00:01:40",
								"requestInterval": "00.00:00:00.010",
								"requestMethod": "GET",
								"additionalHeaders": {
									"Authorization": {
										"value": "@{concat('bearer ',activity('GetBearerToken').output.access_token)}",
										"type": "Expression"
									}
								},
								"paginationRules": {
									"supportRFC5988": "true"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobStorageWriteSettings"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".txt"
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"path": "['userID']"
										},
										"sink": {
											"name": "userID",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['username']"
										},
										"sink": {
											"name": "username",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['dirID']"
										},
										"sink": {
											"name": "dirID",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['firstName']"
										},
										"sink": {
											"name": "firstName",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['lastName']"
										},
										"sink": {
											"name": "lastName",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['clientID']"
										},
										"sink": {
											"name": "clientID",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['title']"
										},
										"sink": {
											"name": "title",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['phoneNumber']"
										},
										"sink": {
											"name": "phoneNumber",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['role']"
										},
										"sink": {
											"name": "role",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['address']"
										},
										"sink": {
											"name": "address",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['status']"
										},
										"sink": {
											"name": "status",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['employeeID']"
										},
										"sink": {
											"name": "employeeID",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['mobileNumber']"
										},
										"sink": {
											"name": "mobileNumber",
											"type": "String"
										}
									}
								],
								"collectionReference": "$['documents']",
								"mapComplexValuesToString": false
							}
						},
						"inputs": [
							{
								"referenceName": "Bruin_RestDataset",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_ABS_CSV",
								"type": "DatasetReference",
								"parameters": {
									"ContainerName": "main",
									"Path": "Data/Sammons Industrial/Sammons Industrial/MetTel",
									"FileName": {
										"value": "@concat('MetTel_UsersAPI_',formatDateTime(convertFromUtc(utcNow(),'Central Standard Time'), 'yyyyMMddHHmmss'),'.csv')",
										"type": "Expression"
									}
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "annie"
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]",
				"[concat(variables('workspaceId'), '/datasets/Bruin_RestDataset')]",
				"[concat(variables('workspaceId'), '/datasets/DS_ABS_CSV')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Ceridian_Import')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "GetBearerToken",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "CreateTempStaging",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": "https://dfid.dayforcehcm.com/connect/token",
							"connectVia": {
								"referenceName": "AutoResolveIntegrationRuntime",
								"type": "IntegrationRuntimeReference"
							},
							"method": "POST",
							"headers": {
								"content-type": "application/x-www-form-urlencoded"
							},
							"body": "grant_type=password&companyId=siteprorentals&username=SiteProReportingUser&password=hG!m42AD&client_id=Dayforce.HCMAnywhere.Client"
						}
					},
					{
						"name": "Copy raw data to JSON",
						"description": "stores just one day, in case of data dispute.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "GetBearerToken",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "RestSource",
								"httpRequestTimeout": "00:01:40",
								"requestInterval": "00.00:00:00.010",
								"requestMethod": "GET",
								"additionalHeaders": {
									"Authorization": {
										"value": "@{concat('bearer ',activity('GetBearerToken').output.access_token)}",
										"type": "Expression"
									}
								},
								"paginationRules": {
									"supportRFC5988": "true"
								}
							},
							"sink": {
								"type": "JsonSink",
								"storeSettings": {
									"type": "AzureBlobStorageWriteSettings"
								},
								"formatSettings": {
									"type": "JsonWriteSettings"
								}
							},
							"enableStaging": false
						},
						"inputs": [
							{
								"referenceName": "GetCeridianToken",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_ADLS_JSON_1",
								"type": "DatasetReference",
								"parameters": {
									"ContainerName": "main",
									"Path": "Data/Sammons Industrial/SiteProRentals/POR/Ceridian/APIDataLakeReport",
									"FileName": "APIDataLakeReport"
								}
							}
						]
					},
					{
						"name": "TransformToSink_staging",
						"description": "sink to mdw",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Copy raw data to JSON",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "GetDataToEncrypt",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"GetDataToEncrypt": {
										"ContainerName": "main",
										"Path": "Data/Sammons Industrial/SiteProRentals/POR/Ceridian/APIDataLakeReport",
										"FileName": "APIDataLakeReport"
									},
									"SinkThis": {}
								}
							},
							"staging": {
								"linkedService": {
									"referenceName": "AzureBlobStorage_Parquet",
									"type": "LinkedServiceReference"
								},
								"folderPath": "main/Data/Sammons Industrial/SiteProRentals/POR/Ceridian"
							},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "ExecuteSP",
						"description": "[POR].[Load_Ceridian_EmployeeInformation]",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "TransformToSink_staging",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[POR].[Load_Ceridian_EmployeeInformation]"
						},
						"linkedServiceName": {
							"referenceName": "briggs-b-wus-syn-01-WorkspaceDefaultSqlServer",
							"type": "LinkedServiceReference",
							"parameters": {
								"DBName": "briggsbetamdw"
							}
						}
					},
					{
						"name": "CreateTempStaging",
						"type": "Script",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"linkedServiceName": {
							"referenceName": "briggs-b-wus-syn-01-WorkspaceDefaultSqlServer",
							"type": "LinkedServiceReference",
							"parameters": {
								"DBName": "briggsbetamdw"
							}
						},
						"typeProperties": {
							"scripts": [
								{
									"type": "Query",
									"text": "SET ANSI_NULLS ON\r\n\r\n\r\nSET QUOTED_IDENTIFIER ON\r\n\r\nIF OBJECT_ID (N'POR.Ceridian_EmployeeInformation_staging', N'U') IS NOT NULL\r\nDROP TABLE POR.Ceridian_EmployeeInformation_staging;\r\n\r\nCREATE TABLE [POR].[Ceridian_EmployeeInformation_staging]\r\n(\r\n\t[EmployeeNumber] [NVARCHAR](10) NULL,\r\n\t[EmployeeLastName] [NVARCHAR](100) NULL,\r\n\t[EmployeeFirstName] [NVARCHAR](100) NULL,\r\n\t[EmployeeMiddleName] [NVARCHAR](50) NULL,\r\n\t[EmploymentStatus] [NVARCHAR](100) NULL,\r\n\t[EmployeeHireDate] [DATE] NULL,\r\n\t[EmployeeTerminationDate] [DATE] NULL,\r\n\t[JobName] [NVARCHAR](100) NULL,\r\n\t[JobTitle] [NVARCHAR](100) NULL,\r\n\t[OrgUnit] [NVARCHAR](100) NULL,\r\n\t[DepartmentName] [NVARCHAR](100) NULL,\r\n\t[ManagerName] [NVARCHAR](100) NULL,\r\n\t[PayType] [NVARCHAR](100) NULL,\r\n\t[PayClass] [NVARCHAR](100) NULL,\r\n\t[EmployeeGender] [NVARCHAR](10) NULL,\r\n\t[SSN4] [NVARCHAR](10) NULL,\r\n\t[LastLoadDate] [DATE] NULL\r\n)\r\nWITH\r\n(\r\n\tDISTRIBUTION = ROUND_ROBIN,\r\n\tCLUSTERED COLUMNSTORE INDEX\r\n)"
								}
							]
						}
					},
					{
						"name": "DB_CreateTableFailure",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "CreateTempStaging",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": "https://prod-24.centralus.logic.azure.com:443/workflows/ce605247ec3d441aa49633355f8cfd9a/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=4u7EFMoueVGeSUWsCQdMuUhNkpMSirU6tk7w8wDfS-Y",
							"connectVia": {
								"referenceName": "AutoResolveIntegrationRuntime",
								"type": "IntegrationRuntimeReference"
							},
							"method": "POST",
							"headers": {
								"content-type": "application/json"
							},
							"body": {
								"value": "{\n    \"Pipeline\":\"@{pipeline().Pipeline}\",\n    \"DataFactoryName\" : \"@{pipeline().DataFactory}\",\n    \"ActivityType\" : \"@{activity('CreateTempStaging').ActivityType}\",\n    \"Runid\" : \"@{pipeline().RunId}\"\n}",
								"type": "Expression"
							}
						}
					},
					{
						"name": "GetBearerTokenFailure",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "GetBearerToken",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": "https://prod-24.centralus.logic.azure.com:443/workflows/ce605247ec3d441aa49633355f8cfd9a/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=4u7EFMoueVGeSUWsCQdMuUhNkpMSirU6tk7w8wDfS-Y",
							"connectVia": {
								"referenceName": "AutoResolveIntegrationRuntime",
								"type": "IntegrationRuntimeReference"
							},
							"method": "POST",
							"headers": {
								"content-type": "application/json"
							},
							"body": {
								"value": "{\n    \"Pipeline\":\"@{pipeline().Pipeline}\",\n    \"DataFactoryName\" : \"@{pipeline().DataFactory}\",\n    \"ActivityType\" : \"@{activity('GetBearerToken').ActivityType}\",\n    \"Runid\" : \"@{pipeline().RunId}\"\n}",
								"type": "Expression"
							}
						}
					},
					{
						"name": "CopyRawDataToJSON_Failure",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "Copy raw data to JSON",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": "https://prod-24.centralus.logic.azure.com:443/workflows/ce605247ec3d441aa49633355f8cfd9a/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=4u7EFMoueVGeSUWsCQdMuUhNkpMSirU6tk7w8wDfS-Y",
							"connectVia": {
								"referenceName": "AutoResolveIntegrationRuntime",
								"type": "IntegrationRuntimeReference"
							},
							"method": "POST",
							"headers": {
								"content-type": "application/json"
							},
							"body": {
								"value": "{\n    \"Pipeline\":\"@{pipeline().Pipeline}\",\n    \"DataFactoryName\" : \"@{pipeline().DataFactory}\",\n    \"ActivityType\" : \"@{activity('Copy raw data to JSON').ActivityType}\",\n    \"Runid\" : \"@{pipeline().RunId}\"\n}",
								"type": "Expression"
							}
						}
					},
					{
						"name": "TransformToSink_stagingFailure",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "TransformToSink_staging",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": "https://prod-24.centralus.logic.azure.com:443/workflows/ce605247ec3d441aa49633355f8cfd9a/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=4u7EFMoueVGeSUWsCQdMuUhNkpMSirU6tk7w8wDfS-Y",
							"connectVia": {
								"referenceName": "AutoResolveIntegrationRuntime",
								"type": "IntegrationRuntimeReference"
							},
							"method": "POST",
							"headers": {
								"content-type": "application/json"
							},
							"body": {
								"value": "{\n    \"Pipeline\":\"@{pipeline().Pipeline}\",\n    \"DataFactoryName\" : \"@{pipeline().DataFactory}\",\n    \"ActivityType\" : \"@{activity('TransformToSink_staging').ActivityType}\",\n    \"Runid\" : \"@{pipeline().RunId}\"\n}",
								"type": "Expression"
							}
						}
					},
					{
						"name": "ExecuteSPFailure",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "ExecuteSP",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": "https://prod-24.centralus.logic.azure.com:443/workflows/ce605247ec3d441aa49633355f8cfd9a/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=4u7EFMoueVGeSUWsCQdMuUhNkpMSirU6tk7w8wDfS-Y",
							"connectVia": {
								"referenceName": "AutoResolveIntegrationRuntime",
								"type": "IntegrationRuntimeReference"
							},
							"method": "POST",
							"headers": {
								"content-type": "application/json"
							},
							"body": {
								"value": "{\n    \"Pipeline\":\"@{pipeline().Pipeline}\",\n    \"DataFactoryName\" : \"@{pipeline().DataFactory}\",\n    \"ActivityType\" : \"@{activity('ExecuteSP').ActivityType}\",\n    \"Runid\" : \"@{pipeline().RunId}\"\n}",
								"type": "Expression"
							}
						}
					},
					{
						"name": "ExecuteSPSuccess",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "ExecuteSP",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": "https://prod-05.centralus.logic.azure.com:443/workflows/dd38bc8975b24c73a8f69bf80e9036ca/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=GeLqWhOvtSho-lGrx1-BgSGweXdln7o7PQBl54-_f1g",
							"connectVia": {
								"referenceName": "AutoResolveIntegrationRuntime",
								"type": "IntegrationRuntimeReference"
							},
							"method": "POST",
							"headers": {
								"content-type": "application/json"
							},
							"body": {
								"value": "{\n    \"Pipeline\":\"@{pipeline().Pipeline}\",\n    \"DataFactoryName\" : \"@{pipeline().DataFactory}\",\n    \"ActivityType\" : \"@{activity('ExecuteSP').ActivityType}\",\n    \"Runid\" : \"@{pipeline().RunId}\"\n}",
								"type": "Expression"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "Other Vendors"
				},
				"annotations": [],
				"lastPublishTime": "2022-08-19T19:12:43Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]",
				"[concat(variables('workspaceId'), '/datasets/GetCeridianToken')]",
				"[concat(variables('workspaceId'), '/datasets/DS_ADLS_JSON_1')]",
				"[concat(variables('workspaceId'), '/dataflows/GetDataToEncrypt')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureBlobStorage_Parquet')]",
				"[concat(variables('workspaceId'), '/linkedServices/briggs-b-wus-syn-01-WorkspaceDefaultSqlServer')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Ceridian_Import_old')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "GetBearerToken",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": "https://dfid.dayforcehcm.com/connect/token",
							"connectVia": {
								"referenceName": "AutoResolveIntegrationRuntime",
								"type": "IntegrationRuntimeReference"
							},
							"method": "POST",
							"headers": {
								"content-type": "application/x-www-form-urlencoded"
							},
							"body": "grant_type=password&companyId=siteprorentals&username=SiteProReportingUser&password=hG!m42AD&client_id=Dayforce.HCMAnywhere.Client"
						}
					},
					{
						"name": "Copy data",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "GetBearerToken",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "RestSource",
								"httpRequestTimeout": "00:01:40",
								"requestInterval": "00.00:00:00.010",
								"requestMethod": "GET",
								"additionalHeaders": {
									"Authorization": {
										"value": "@{concat('bearer ',activity('GetBearerToken').output.access_token)}",
										"type": "Expression"
									}
								},
								"paginationRules": {
									"supportRFC5988": "true"
								}
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table POR.Ceridian_EmployeeInformation_staging_old;",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"path": "['Employee_LastName']"
										},
										"sink": {
											"name": "Employee_LastName",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['Employee_MiddleName']"
										},
										"sink": {
											"name": "Employee_MiddleName",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['Employee_FirstName']"
										},
										"sink": {
											"name": "Employee_First",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['EmployeeEmploymentStatus_EmployeeNumber']"
										},
										"sink": {
											"name": "EmployeeEmploymentStatus_EmployeeNumber",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['Employee_HireDate']"
										},
										"sink": {
											"name": "Employee_HireDate",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['Employee_TerminationDate']"
										},
										"sink": {
											"name": "Employee_TerminationDate",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['Job_ShortName']"
										},
										"sink": {
											"name": "Job_ShortName",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['DeptJob_ShortName']"
										},
										"sink": {
											"name": "DeptJob_ShortName",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['OrgUnit_ShortName']"
										},
										"sink": {
											"name": "OrgUnit_ShortName",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['Department_ShortName']"
										},
										"sink": {
											"name": "Department_ShortName",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['EmployeeManager_ManagerDisplayName']"
										},
										"sink": {
											"name": "EmployeeManager_ManagerDisplayName",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['EmploymentStatus_ShortName']"
										},
										"sink": {
											"name": "EmploymentStatus_ShortName",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['PayType_ShortName']"
										},
										"sink": {
											"name": "PayType_ShortName",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['PayClass_ShortName']"
										},
										"sink": {
											"name": "PayClass_ShortName",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['Employee_SocialSecurityNumber']"
										},
										"sink": {
											"name": "Employee_SocialSecurityNumber",
											"type": "String"
										}
									},
									{
										"source": {
											"path": "['Employee_Gender']"
										},
										"sink": {
											"name": "Employee_Gender",
											"type": "String"
										}
									}
								],
								"collectionReference": "$['Data']['Rows']"
							}
						},
						"inputs": [
							{
								"referenceName": "GetCeridianToken",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Ceridian_EmployeeInformation_staging_old"
								}
							}
						]
					},
					{
						"name": "Copy raw data to JSON",
						"description": "stores just one day, in case of data dispute.",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "GetBearerToken",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "RestSource",
								"httpRequestTimeout": "00:01:40",
								"requestInterval": "00.00:00:00.010",
								"requestMethod": "GET",
								"additionalHeaders": {
									"Authorization": {
										"value": "@{concat('bearer ',activity('GetBearerToken').output.access_token)}",
										"type": "Expression"
									}
								},
								"paginationRules": {
									"supportRFC5988": "true"
								}
							},
							"sink": {
								"type": "JsonSink",
								"storeSettings": {
									"type": "AzureBlobStorageWriteSettings"
								},
								"formatSettings": {
									"type": "JsonWriteSettings"
								}
							},
							"enableStaging": false
						},
						"inputs": [
							{
								"referenceName": "GetCeridianToken",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_ADLS_JSON_1",
								"type": "DatasetReference",
								"parameters": {
									"ContainerName": "main",
									"Path": "Data/Sammons Industrial/SiteProRentals/POR/Ceridian/APIDataLakeReport",
									"FileName": "APIDataLakeReport"
								}
							}
						]
					},
					{
						"name": "TransformToSink",
						"description": "sink to mdw",
						"type": "ExecuteDataFlow",
						"dependsOn": [
							{
								"activity": "Copy raw data to JSON",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "TransformToSink",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"GetData": {
										"ContainerName": "main",
										"Path": "Data/Sammons Industrial/SiteProRentals/POR/Ceridian/APIDataLakeReport",
										"FileName": "APIDataLakeReport"
									},
									"sinkIt": {}
								}
							},
							"staging": {
								"linkedService": {
									"referenceName": "AzureBlobStorage_Parquet",
									"type": "LinkedServiceReference"
								},
								"folderPath": "main/Data/Sammons Industrial/SiteProRentals/POR/Ceridian/APIDataLakeReport_Der"
							},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					},
					{
						"name": "Execute EmailSendFailure",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "TransformToSink",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "EmailSendFailure",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"EmailTo": "annie.gutreuter@sammonsindustrial.com",
								"ActivityType": "TransformToSink",
								"ErrorMessage": {
									"value": "@activity('TransformToSink').Error.Message",
									"type": "Expression"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "annie"
				},
				"annotations": [],
				"lastPublishTime": "2022-08-19T19:13:47Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]",
				"[concat(variables('workspaceId'), '/datasets/GetCeridianToken')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/datasets/DS_ADLS_JSON_1')]",
				"[concat(variables('workspaceId'), '/dataflows/TransformToSink')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureBlobStorage_Parquet')]",
				"[concat(variables('workspaceId'), '/pipelines/EmailSendFailure')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Generic_Copy_POR_New')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "POR_Lookup",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID,sourceDB,SourcetableName From dbo.control_table_por Where ProcessName = 'AzSQL_ADLS'  and sourcedb in ('POR','master') \nand EnableAction = 1  and table_added='Old' order by ID",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_POR_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "POR_Lookup",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('POR_Lookup').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_POR",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,targetstagetableschema,targetstagetablename\nfrom dbo.control_table_por\nwhere ID= ',item().ID)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_POR_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_POR').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('truncate table ',activity('Lookup_POR').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_POR').output.firstRow.TargetStageTableName)}\n",
												"type": "Expression"
											},
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "POR_Dataset",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_POR').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_POR').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit1",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_POR",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": true
									}
								},
								{
									"name": "Failure_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLogg]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"ReportType": {
												"value": "POR",
												"type": "String"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											},
											"Type_of_Load": {
												"value": "POR Source Table",
												"type": "String"
											},
											"DataLakePath": {
												"value": {
													"value": "@activity('Lookup_POR').output.firstRow.TargetPath",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_POR_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('Copy_POR_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Update_control_por1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Sp_ExecSuccessAudit11",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_POR_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Sp_ExecSuccessAudit11",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_POR_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLogg]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"ReportType": {
												"value": "POR",
												"type": "String"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_POR_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											},
											"Type_of_Load": {
												"value": "POR Source Table",
												"type": "String"
											},
											"DataLakePath": {
												"value": {
													"value": "@activity('Lookup_POR').output.firstRow.TargetPath",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "POR_Lookup_New",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID1,sourceDB,SourcetableName From dbo.control_table_por Where ProcessName = 'AzSQL_ADLS'  and sourcedb in ('POR','master')\nand EnableAction = 1  and table_added='New' order by ID",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_POR_Load_New",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "POR_Lookup_New",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('POR_Lookup_New').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_POR_New",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,targetstagetableschema,targetstagetablename\nfrom dbo.control_table_por\nwhere ID= ',item().ID1)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_POR_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_POR_New').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "POR_Dataset",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_POR_New').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_POR_New').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit1_New",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_POR_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID1",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID1",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": true
									}
								},
								{
									"name": "Failure_Audit_Log2_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLogg]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID1",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"ReportType": {
												"value": "POR",
												"type": "String"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg1')",
													"type": "Expression"
												},
												"type": "String"
											},
											"Type_of_Load": {
												"value": "POR Source Table",
												"type": "String"
											},
											"DataLakePath": {
												"value": {
													"value": "@activity('Lookup_POR_New').output.firstRow.TargetPath",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_POR_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg1",
										"value": {
											"value": "@activity('Copy_POR_ADLS_New').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Update_control_por1_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Sp_ExecSuccessAudit_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_POR_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID1",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Sp_ExecSuccessAudit_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_POR_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLogg]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID1",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"ReportType": {
												"value": "POR",
												"type": "String"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_POR_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											},
											"Type_of_Load": {
												"value": "POR Source Table",
												"type": "String"
											},
											"DataLakePath": {
												"value": {
													"value": "@activity('Lookup_POR_New').output.firstRow.TargetPath",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsg": {
						"type": "String"
					},
					"ErrorMsg1": {
						"type": "String"
					}
				},
				"folder": {
					"name": "MDP POR DataLoad_New"
				},
				"annotations": [],
				"lastPublishTime": "2022-08-03T15:33:16Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/datasets/POR_Dataset')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Generic_Proc_New')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Lookup_Stage_Procs",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ForEach_Dimension",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select id,sourcetablename, sourcedb from dbo.control_table_por \nwhere SubjectArea='Report Stage POR SP' and processsequence=2 and enableaction=1\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Stage_Procs",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup_Stage_Procs",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup_Stage_Procs').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Staging_Proc1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Staging_AuditLogStart1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Staging_AuditLogStart1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().id",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"DataFactoryName": {
												"value": {
													"value": "@pipeline().DataFactory",
													"type": "Expression"
												},
												"type": "String"
											},
											"ParentAuditID": {
												"value": {
													"value": "@item().id",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"PipelineName": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerID": {
												"value": {
													"value": "@pipeline().TriggerId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerName": {
												"value": {
													"value": "@pipeline().TriggerName",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerType": {
												"value": {
													"value": "@pipeline().TriggerType",
													"type": "Expression"
												},
												"type": "String"
											},
											"Sourcedb": {
												"value": {
													"value": "@item().sourcedb",
													"type": "Expression"
												},
												"type": "String"
											},
											"sourcetable": {
												"value": {
													"value": "@item().sourcetablename",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Staging_SuccessAuditLog1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Staging_Proc1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLogg]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().id",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"DataLakePath": {
												"value": null,
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"ReportType": {
												"value": "POR",
												"type": "String"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											},
											"Type_of_Load": {
												"value": null,
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Staging_ErrorVar1",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Staging_Proc1",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMessage",
										"value": {
											"value": "@activity('Staging_Proc1').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Staging_FailureAuditLog1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Staging_ErrorVar1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLogg]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().id",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"DataLakePath": {
												"value": null,
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"ReportType": {
												"value": "POR",
												"type": "String"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMessage')",
													"type": "Expression"
												},
												"type": "String"
											},
											"Type_of_Load": {
												"value": null,
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Staging_Update_control_por1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Staging_SuccessAuditLog1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_POR_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().id",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "Inventory",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "/*\nDATA PULL_Inventory_approved_v2\nLast edit:  2022 March 22\n*/\n\n--Temp table (1/1)\tHave system generate unique dates\n--IF OBJECT_ID('tempdb..#DateRange') IS NOT NULL \n--   DROP TABLE #DateRange;  \n--GO\n--CREATE TABLE #DateRange (UniqueDate DATE PRIMARY KEY)\n--INSERT INTO #DateRange\n--SELECT TOP (10592) DATEADD(DAY,ROW_NUMBER() OVER (ORDER BY (SELECT 1)), '20201231') AS N\n--FROM master.dbo.spt_values v1, master.dbo.spt_values v2;\nwith DateRange_cte As\n(\n\tSELECT TOP (10592) DATEADD(DAY,ROW_NUMBER() OVER (ORDER BY (SELECT 1)), '20201231') AS UniqueDate\n\tFROM master.dbo.spt_values v1, master.dbo.spt_values v2\n)\n\n--CTEs:  amalgamate details and summary for scripted/automatic aggregation as needed\n--CTE (1/5)\t\tRepair info:  details and aggregates\n, repairs_cte AS\t\t--alias:  rc\n(\nSELECT\n  ti0.ITEM\n, summary.MaintenanceType\n, summary.TotalLaborHours\n, CAST(summary.LaborCost/NULLIF(summary.NumAssets,0) AS DECIMAL(18,2)) AS LaborCost\n, CAST(summary.ServicePartsCost/NULLIF(summary.NumAssets,0) AS DECIMAL(18,2)) AS ServicePartsCost\n, summary.OutDate\n, summary.CompletedDate\n, summary.CNTR\n, summary.DaysDown\nFROM POR.dbo.TransactionItems ti0\nJOIN POR.dbo.ItemFile ifi0 ON ifi0.NUM = ti0.ITEM\nJOIN (\n\tSELECT\n\t  details.CNTR\n\t, details.MaintenanceType\n\t, SUM(IIF(details.Asset = 1,1,0)) AS NumAssets\n\t, SUM(details.LaborHours) AS TotalLaborHours\n\t, SUM(IIF(details.Name LIKE 'labor', details.Pric,0)) AS LaborCost\n\t, SUM(IIF(details.Name NOT LIKE 'labor', details.Pric,0)) AS ServicePartsCost\n\t, MIN(details.OutDate) AS OutDate\n\t, MAX(details.CompletedDate) AS CompletedDate\n\t, DATEDIFF(d,details.OutDate,IIF(details.CompletedDate IS NULL, GETDATE(),details.CompletedDate)) AS DaysDown\n\tFROM (\n\t\tSELECT t.CNTR, ti.Sort, ifi.Asset, ifi.Name, ifi.NUM, IIF(ifi.Name LIKE '%labor%', ti.QTY, 0) AS LaborHours, ti.PRIC\n\t\t, CASE WHEN CF.[KEY] LIKE 'REPAIRS-MAINT%' THEN 'IMO'\n\t\t\tWHEN CF.[KEY] NOT LIKE 'REPAIRS-MAINT%' THEN 'IRO'\n\t\t\tEND AS [MaintenanceType]\n\t\t, CF.[KEY]\n\t\t, CAST(t.[DATE] AS DATE) AS OutDate\n\t\t, CAST(t.Completed AS DATE) AS CompletedDate\n\t\tFROM POR.dbo.Transactions t\n\t\tJOIN POR.dbo.TransactionItems ti ON ti.CNTR = t.CNTR\n\t\tJOIN POR.dbo.ItemFile ifi ON ifi.NUM = ti.ITEM\n\t\tJOIN POR.dbo.CustomerFile CF ON T.CUSN = CF.CNUM\n\t\tWHERE LEFT(t.CNTR,1) = 'r'\n\t\tAND LEFT(ti.Sort,4) <> 'zzzz'\n\t\tAND RIGHT(ifi.[KEY],2) <> 'RR'\n\t) details\n\tGROUP BY\n\t  details.CNTR\n\t, details.MaintenanceType\n\t, DATEDIFF(d,details.OutDate,IIF(details.CompletedDate IS NULL, GETDATE(),details.CompletedDate))\n) summary ON summary.CNTR = ti0.CNTR\nWHERE ifi0.Asset = 1\n)\n\n--CTE (2/5)\t\tRepair info:  Days since item was last down\n, lastCompletedDate_cte AS\t\t--alias:  lcd\n(\nSELECT ITEM, repairs_cte.MaintenanceType, repairs_cte.CompletedDate AS LastCompletedDate\n\t, ROW_NUMBER() OVER(PARTITION BY repairs_cte.ITEM ORDER BY (CASE WHEN repairs_cte.CompletedDate IS NULL THEN GETDATE() ELSE repairs_cte.CompletedDate END) DESC) AS [RowNumber]\nFROM repairs_cte\n)\n\n--CTE (3/5)\t\tRepair days:  Use unique days\n, repairDays_cte AS\t\t--alias:  rd\n(\n\tSELECT\n\t  a.ITEM\n\t, COUNT(DISTINCT CASE WHEN a.UniqueDate >= '2021-12-01' AND a.MaintenanceType = 'IMO' THEN a.UniqueDate ELSE NULL END) AS TotalDaysIMO\n\t, COUNT(DISTINCT CASE WHEN a.UniqueDate >= '2021-12-01' AND a.MaintenanceType = 'IRO' THEN a.UniqueDate ELSE NULL END) AS TotalDaysIRO\n\t, COUNT(DISTINCT CASE WHEN a.UniqueDate >= '2021-12-01' THEN a.UniqueDate ELSE NULL END) AS TotalDaysRepair\n\tFROM (\n\t\tSELECT\n\t\tti3.ITEM\n\t\t, CASE WHEN CF3.[KEY] LIKE 'REPAIRS-MAINT%' THEN 'IMO'\n\t\t\tWHEN CF3.[KEY] NOT LIKE 'REPAIRS-MAINT%' THEN 'IRO'\n\t\t\tEND AS [MaintenanceType]\n\t\t, dr3.UniqueDate\n\t\tFROM POR.dbo.Transactions t3\n\t\tJOIN POR.dbo.TransactionItems ti3 ON ti3.CNTR = t3.CNTR\n\t\tJOIN POR.dbo.ItemFile ifi3 ON ifi3.NUM = ti3.ITEM\n\t\tJOIN POR.dbo.CustomerFile CF3 ON T3.CUSN = CF3.CNUM\n\t\tJOIN DateRange_cte dr3 ON dr3.UniqueDate BETWEEN CAST(t3.[DATE] AS DATE) AND CAST(CASE WHEN t3.Completed IS NULL THEN GETDATE() ELSE CAST(t3.Completed AS DATE) END AS DATE)\n\t\tWHERE LEFT(t3.CNTR,1) = 'r'\n\t\tAND LEFT(ti3.Sort,4) <> 'zzzz'\n\t\tAND RIGHT(ifi3.[KEY],2) <> 'RR'\n\t\tGROUP BY\n\t\tti3.ITEM\n\t\t, CASE WHEN CF3.[KEY] LIKE 'REPAIRS-MAINT%' THEN 'IMO'\n\t\t\tWHEN CF3.[KEY] NOT LIKE 'REPAIRS-MAINT%' THEN 'IRO'\n\t\t\tEND\n\t\t, dr3.UniqueDate\n\t) a\n\tGROUP BY\n\t  a.ITEM\n)\n\n--CTE (4/5)\t\tContract info:  Aggregates by ITEM\n, contractRev_cte AS\t--alias:  cr\n(\nSELECT\n  c.ITEM\n, SUM(c.TotalContractRevenue) AS TotalRentalRevenue\n, SUM(c.[30d_ContractRevenue]) AS [30d_TotalRentalRevenue]\n, SUM(c.[60d_ContractRevenue]) AS [60d_TotalRentalRevenue]\n, SUM(c.[90d_ContractRevenue]) AS [90d_TotalRentalRevenue]\n, SUM(c.[180d_ContractRevenue]) AS [180d_TotalRentalRevenue]\n, SUM(c.[R12d_ContractRevenue]) AS [R12d_TotalRentalRevenue]\n, SUM(c.[YTD_ContractRevenue]) AS [YTD_TotalRentalRevenue]\n, CAST(MAX(c.MaxContractStartDate) AS DATE) AS [LastItemContractStartDate]\n, CAST(MAX(c.MaxContractDate) AS DATE) AS [LastItemContractDate]\n, CAST(MAX(c.MaxCurrentDate) AS DATE) AS [LastItemContractDate_current]\nFROM (\n\tSELECT\n\t  LEFT(b.CNTR,6) AS CNTR\n\t, b.ITEM\n\t, SUM(b.PRIC) AS TotalContractRevenue\n\t, SUM(CASE WHEN b.ARdays  = 30 THEN b.PRIC ELSE 0 END) AS [30d_ContractRevenue]\n\t, SUM(CASE WHEN b.ARdays <= 60 THEN b.PRIC ELSE 0 END) AS [60d_ContractRevenue]\n\t, SUM(CASE WHEN b.ARdays <= 90 THEN b.PRIC ELSE 0 END) AS [90d_ContractRevenue]\n\t, SUM(CASE WHEN b.ARdays <= 180 THEN b.PRIC ELSE 0 END) AS [180d_ContractRevenue]\n\t, SUM(CASE WHEN b.ARdays <= 365 THEN b.PRIC ELSE 0 END) AS [R12d_ContractRevenue]\n\t, SUM(IIF(YEAR(b.DATE) = YEAR(GETDATE()),b.PRIC,0)) AS [YTD_ContractRevenue]\n\t, MAX(b.DATE) AS MaxContractStartDate\n\t, MAX(b.MaxActualContractDate) AS MaxContractDate\n\t, MAX(b.MaxCurrentContractDate) AS MaxCurrentDate\n\tFROM (\n\t\tSELECT\n\t\t  ti0.CNTR\n\t\t, ti0.ITEM\n\t\t, ti0.PRIC\n\t\t, CASE WHEN DATEDIFF(d,t0.[DATE],GETDATE()) <= 30 THEN 30\n\t\t\tWHEN DATEDIFF(d,t0.[DATE],GETDATE()) > 30 AND DATEDIFF(d,t0.[DATE],GETDATE()) <= 60 THEN 60\n\t\t\tWHEN DATEDIFF(d,t0.[DATE],GETDATE()) > 60 AND DATEDIFF(d,t0.[DATE],GETDATE()) <= 90 THEN 90\n\t\t\tWHEN DATEDIFF(d,t0.[DATE],GETDATE()) > 90 AND DATEDIFF(d,t0.[DATE],GETDATE()) <= 180 THEN 180\n\t\t\tWHEN DATEDIFF(d,t0.[DATE],GETDATE()) > 180 AND DATEDIFF(d,t0.[DATE],GETDATE()) <= 365 THEN 365\n\t\t\tELSE 9999 END AS ARdays\n\t\t, t0.[DATE]\n\t\t, a.MaxActualContractDate\n\t\t, a.MaxCurrentContractDate\n\t\tFROM POR.dbo.Transactions t0\n\t\tJOIN POR.dbo.TransactionItems ti0 ON ti0.CNTR = t0.CNTR\n\t\tJOIN POR.dbo.ItemFile ifi0 ON ifi0.NUM = ti0.ITEM\n\t\tJOIN POR.dbo.ItemType it0 ON it0.[Type] = ifi0.[TYPE]\n\t\tJOIN (\n\t\t\t\tSELECT LEFT(ti1.CNTR,6) AS CNTRgroup, ti1.ITEM\n\t\t\t\t, MIN(t1.[DATE]) AS MinContractDate\n\t\t\t\t, MAX(CASE WHEN ti1.TXTY IN ('RR','RX') THEN ti1.DDT ELSE t1.CLDT END) AS MaxActualContractDate\t\t--basing on picked up date because they are partitioning at the item level\n\t\t\t\t, MAX(CASE WHEN t1.CLDT IS NULL THEN '3333-12-31' WHEN ti1.TXTY IN ('RR','RX') THEN ti1.DDT ELSE t1.CLDT END) AS MaxCurrentContractDate\n\t\t\t\tFROM POR.dbo.Transactions t1\n\t\t\t\tJOIN POR.dbo.TransactionItems ti1 ON ti1.CNTR = t1.CNTR\n\t\t\t\tJOIN POR.dbo.ItemFile ifi1 ON ifi1.NUM = ti1.ITEM\n\t\t\t\tWHERE ((ifi1.UserDefined1 <> '' AND t1.[DATE] >= '2021-12-01') OR ifi1.UserDefined1 = '')\n\t\t\t\tAND t1.[DATE] <= GETDATE()\n\t\t\t\tGROUP BY LEFT(ti1.CNTR,6), ti1.ITEM\n\t\t) a ON a.CNTRgroup = LEFT(ti0.CNTR,6) AND a.ITEM = ifi0.NUM\n\t\tWHERE LEFT(t0.CNTR,1) NOT IN ('q','r','s','t','w','c') \n\t\tAND LEFT(it0.TypeDescrip,6) = 'Rental'\n\t\tAND RIGHT(ifi0.[KEY],2) <> 'RR'\n\t\tAND ((ifi0.UserDefined1 <> '' AND t0.[DATE] >= '2021-12-01') OR ifi0.UserDefined1 = '')\n\t\tAND t0.[DATE] <= GETDATE()\n\t) b\n\tGROUP BY\n\t  LEFT(b.CNTR,6)\n\t, b.ITEM\n) c\nGROUP BY\n  c.ITEM\n)\n\n--CTE (5/5)\t\tTimeUt by Item info:  uses temp table at beginning of query\n, timeUt_cte AS (\t--alias:  tu\nSELECT\n  a.ITEM\n, SUM(IIF(a.UniqueDate >= CAST(IIF(DATEADD(DAY,-30,GETDATE()) < '2021-12-01', '2021-12-01',DATEADD(DAY,-30,GETDATE()+1)) AS DATE), 1, 0)) AS [30dDistinct_OnRent]\n, SUM(IIF(a.UniqueDate >= CAST(IIF(DATEADD(DAY,-90,GETDATE()) < '2021-12-01', '2021-12-01',DATEADD(DAY,-90,GETDATE()+1)) AS DATE), 1, 0)) AS [90dDistinct_OnRent]\n, SUM(IIF(a.UniqueDate >= CAST(IIF(DATEADD(DAY,-180,GETDATE()) < '2021-12-01', '2021-12-01',DATEADD(DAY,-180,GETDATE()+1)) AS DATE), 1, 0)) AS [180dDistinct_OnRent]\n, SUM(IIF(a.UniqueDate >= CAST(IIF(DATEADD(DAY,-365,GETDATE()) < '2021-12-01', '2021-12-01',DATEADD(DAY,-365,GETDATE()+1)) AS DATE), 1, 0)) AS [R12dDistinct_OnRent]\n, SUM(IIF(a.UniqueDate >= DATEADD(yy, DATEDIFF(yy, 0, GETDATE()), 0), 1, 0)) AS [YTDdistinct_OnRent]\n, SUM(IIF(a.UniqueDate >= '2021-12-01', 1, 0)) AS [TotalDistinct_UT]\nFROM (\n\tSELECT ti2.ITEM, dr.UniqueDate\n\tFROM POR.dbo.Transactions t2\n\tJOIN POR.dbo.TransactionItems ti2 ON ti2.CNTR = t2.CNTR\n\tJOIN POR.dbo.ItemFile ifi2 ON ifi2.NUM = ti2.ITEM\n\tJOIN POR.dbo.ItemPurchaseDetail ipd2 ON ipd2.ItemNumber = ifi2.NUM\n\tJOIN DateRange_cte dr ON dr.UniqueDate BETWEEN CAST(t2.[DATE] AS DATE) AND CAST(CASE WHEN t2.CLDT IS NULL THEN GETDATE() ELSE ti2.DDT END AS DATE)\n\tWHERE LEFT(t2.CNTR,1) NOT IN ('q','r','s','t','w','c')\n\tAND ifi2.SerialNumber <> ''\n\tAND t2.DATE < CAST(GETDATE() AS DATE)\n\tAND dr.UniqueDate <= GETDATE()\n\tAND dr.UniqueDate >= ipd2.PurchaseDate\n\tGROUP BY ti2.ITEM, dr.UniqueDate\n) a\nGROUP BY a.ITEM\n)\n\n\n\n--MAIN QUERY:\n--Expected approximation:  3.4k results\nSELECT\nifi.[KEY], ifi.Header, ifi.[Name], ic.[Name] AS Category, ifi.MANF AS Make, ifi.MODN AS Model\n, ifi.ModelYear AS [Model_Year], ifi.SerialNumber AS [Serial_Number]\n, DATEDIFF(m,ipd.PurchaseDate,GETDATE()) AS [Age_In_Months]\n, CAST(ipd.PurchaseDate AS DATE) AS [Original_DOP], ipd.OEC, ifi.CURV AS NBV, ifi.DEPA AS [Accum_Depr]\n, ifi.PURP AS [Acquisition_Cost], ipd.PONumber AS [PO_Number], ipd.ExtraCost AS [Extra_Cost], ifi.CurrentStore AS [Current_Store]\n, CASE WHEN pf.Store <> '001' THEN RIGHT(pf.STORE_NAME, LEN(pf.STORE_NAME) - 4) ELSE pf.STORE_NAME END AS [Store_Name]\n, it.TypeDescrip AS [Type], ifi.MTOT AS [Hours], ifi.UserDefined1 AS [Legacy_ID],ifi.QTY AS Item_Qty            \n\n--Time utilization\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[30dDistinct_OnRent] AS DECIMAL(18,2))/30.00 *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [30d_TU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[90dDistinct_OnRent] AS DECIMAL(18,2))/90.00 *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [90d_TU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[180dDistinct_OnRent] AS DECIMAL(18,2))/180.00 *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [180d_TU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[R12dDistinct_OnRent] AS DECIMAL(18,2))/365.00 *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [R12_TU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[YTDdistinct_OnRent] AS DECIMAL(18,2))/(DATEDIFF(d,DATEADD(yy, DATEDIFF(yy, 0, GETDATE()), 0),GETDATE()+1)) *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [YTD_TU]\n\n--Dollar utilization\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[30d_TotalRentalRevenue]/NULLIF(ipd.OEC,0))*12) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [30d_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[90d_TotalRentalRevenue]/NULLIF(ipd.OEC,0))*4) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [90d_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[180d_TotalRentalRevenue]/NULLIF(ipd.OEC,0))*2) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [180d_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[R12d_TotalRentalRevenue]/NULLIF(ipd.OEC,0))) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [R12_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[YTD_TotalRentalRevenue]/NULLIF(ipd.OEC,0))*(365/DATEDIFF(d,DATEADD(yy, DATEDIFF(yy, 0, GETDATE()), 0),GETDATE()))) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [YTD_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN ISNULL(cr.TotalRentalRevenue,0) ELSE NULL END AS [LTD_Revenue]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL(CAST(CAST(tu.[TotalDistinct_UT] AS DECIMAL(18,2)) / NULLIF(DATEDIFF(d,IIF(ifi.UserDefined1 <> '','2021-12-01',CAST(ipd.PurchaseDate AS DATE)),CAST(GETDATE()+1 AS DATE)),0)*100 AS DECIMAL(18,2)),0) AS VARCHAR(10)) + '%' ELSE NULL END AS [SP%_LTDTU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN ISNULL(CAST(MAX(CAST(CAST(rd.TotalDaysRepair AS DECIMAL(18,2)) / NULLIF(DATEDIFF(d,IIF(ifi.UserDefined1 <> '','2021-12-01',CAST(ipd.PurchaseDate AS DATE)),GETDATE()+1),0)*100 AS DECIMAL(18,2))) AS VARCHAR(10)),0) + '%' ELSE NULL END AS [SP%_Life_Down]\n, IIF((cr.LastItemContractDate_current = '3333-12-31' OR GETDATE() BETWEEN cr.LastItemContractStartDate AND cr.LastItemContractDate_current),'On rent', CAST(DATEDIFF(d,cr.LastItemContractDate,GETDATE())AS VARCHAR(20)) ) AS [Last_Rent_In_Days]\n\n--Maintenance/Repair\n, SUM(IIF(rc.ITEM IS NOT NULL,ISNULL(rc.TotalLaborHours,0),NULL)) AS [Total_Labor_Hours]\n, SUM(rc.LaborCost) AS [Total_Labor_Cost]\n, CASE WHEN rc.ITEM IS NOT NULL AND lcd.RowNumber = 1 AND lcd.LastCompletedDate IS NOT NULL THEN CAST(DATEDIFF(d, lcd.LastCompletedDate,GETDATE()) AS VARCHAR(20))\n\tWHEN rc.ITEM IS NOT NULL AND lcd.LastCompletedDate IS NULL THEN CAST('Down' AS VARCHAR(5))\n\tELSE NULL END AS [Days_Since_Last_Down]\n, lcd.MaintenanceType AS [Last_Down_Type]\n, SUM(IIF(rc.ITEM IS NOT NULL,IIF(rc.MaintenanceType = 'IRO',1,0),NULL)) AS [IRO_Totals]\n, rd.TotalDaysIRO AS [IRO_Days_Down]\n, SUM(IIF(rc.ITEM IS NOT NULL,IIF(rc.MaintenanceType = 'IRO',rc.LaborCost + rc.ServicePartsCost,0),NULL)) AS [IRO_Labor_Parts_Cost]\n, SUM(IIF(rc.ITEM IS NOT NULL,IIF(rc.MaintenanceType = 'IMO',1,0),NULL)) AS [IMO_Totals]\n, rd.TotalDaysIMO AS [IMO_Days_Down]\n, SUM(IIF(rc.ITEM IS NOT NULL,IIF(rc.MaintenanceType = 'IMO',rc.LaborCost + rc.ServicePartsCost,0),NULL)) AS [IMO_Labor_PartsCost]\n, GETDATE() [last_refresh_date]\nFROM POR.dbo.ItemFile ifi\nLEFT JOIN POR.dbo.ItemCategory ic ON ic.Category = ifi.Category\nJOIN POR.dbo.ItemType it ON it.[Type] = ifi.[TYPE]\nJOIN (SELECT\n\t\tipd0.ItemNumber, CASE WHEN ipd0.PONumber = 0 THEN NULL ELSE ipd0.PONumber END AS PONumber, ipd0.PurchaseDate, ipd0.ExtraCharges AS ExtraCost\n\t\t, SUM(([QuantityPurchased] - [QuantitySold]) * ([PriceEach] + [ExtraCharges])) AS OEC\n\t\t, ROW_NUMBER() OVER(PARTITION BY ipd0.ItemNumber ORDER BY ipd0.PurchaseDate) AS [RowNumber]\n\t\tFROM POR.dbo.ItemPurchaseDetail ipd0\n\t\tWHERE ipd0.QuantityPurchased > 0\n\t\tGROUP BY ipd0.ItemNumber, CASE WHEN ipd0.PONumber = 0 THEN NULL ELSE ipd0.PONumber END, ipd0.PurchaseDate, ipd0.ExtraCharges\n\t) ipd ON ipd.ItemNumber = ifi.NUM\nLEFT JOIN (\n\t\tSELECT ti.ITEM\n\t\tFROM POR.dbo.Transactions t\n\t\tJOIN POR.dbo.TransactionItems ti ON ti.CNTR = t.CNTR\n\t\tWHERE ti.TXTY IN ('SA')\n\t\tAND LEFT(t.STAT,1) = 'O'\n\t\tAND ti.QTY = 1\n\t) sa ON sa.ITEM = ifi.NUM\nLEFT JOIN POR.dbo.ParameterFile pf ON pf.Store = ifi.CurrentStore\nLEFT JOIN repairs_cte rc ON rc.ITEM = ifi.NUM\nLEFT JOIN lastCompletedDate_cte lcd ON lcd.ITEM = ifi.NUM AND lcd.RowNumber = 1\nLEFT JOIN contractRev_cte cr ON cr.ITEM = ifi.NUM\nLEFT JOIN timeUt_cte tu ON tu.ITEM = ifi.NUM\nLEFT JOIN repairDays_cte rd ON rd.ITEM = ifi.NUM\n\nWHERE ifi.SerialNumber <> ''\nAND (ifi.QTY > 0 OR sa.ITEM IS NOT NULL)\nAND ipd.RowNumber = 1\nAND RIGHT(ifi.[KEY],2) <> 'RR'\n\nGROUP BY\n  ifi.[KEY], ifi.Header, ifi.NUM, ifi.[Name], ic.[Name], ifi.MANF, ifi.MODN, ifi.ModelYear, ifi.SerialNumber, ipd.PurchaseDate, ipd.PONumber, ipd.OEC, ipd.ExtraCost, ifi.CurrentStore, CASE WHEN pf.Store <> '001' THEN RIGHT(pf.STORE_NAME, LEN(pf.STORE_NAME) - 4) ELSE pf.STORE_NAME END  \n, it.TypeDescrip, ifi.MTOT, ifi.CURV, ifi.DEPA, ifi.PURP, ifi.UserDefined1\n, CASE WHEN rc.ITEM IS NOT NULL AND lcd.RowNumber = 1 AND lcd.LastCompletedDate IS NOT NULL THEN CAST(DATEDIFF(d, lcd.LastCompletedDate,GETDATE()) AS VARCHAR(20))\n\tWHEN rc.ITEM IS NOT NULL AND lcd.LastCompletedDate IS NULL THEN CAST('Down' AS VARCHAR(5))\n\tELSE NULL END, lcd.MaintenanceType\n, cr.TotalRentalRevenue\n, tu.[TotalDistinct_UT]\n, IIF((cr.LastItemContractDate_current = '3333-12-31' OR GETDATE() BETWEEN cr.LastItemContractStartDate AND cr.LastItemContractDate_current),'On rent', CAST(DATEDIFF(d,cr.LastItemContractDate,GETDATE())AS VARCHAR(20)) )\n, rd.TotalDaysIRO, rd.TotalDaysIMO,ifi.QTY\n\n\nORDER BY RTRIM(LTRIM(ifi.Num))\n\n--DROP TABLE #DateRange\n\n\n",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.Inventory",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "KEY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "KEY",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Serial_Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Serial_Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model_Year",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model_Year",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Age_In_Months",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "Age_In_Months",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Original_DOP",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "Original_DOP",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "OEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "OEC",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "NBV",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "NBV",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Accum_Depr",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Accum_Depr",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Acquisition_Cost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Acquisition_Cost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "PO_Number",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "PO_Number",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Extra_Cost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Extra_Cost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Current_Store",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Current_Store",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Category",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Category",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Type",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Type",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Hours",
											"type": "Single",
											"physicalType": "real"
										},
										"sink": {
											"name": "Hours",
											"type": "Single",
											"physicalType": "real"
										}
									},
									{
										"source": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Legacy_ID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Legacy_ID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "30d_TU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "30d_TU",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "90d_TU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "90d_TU",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "180d_TU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "180d_TU",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "R12_TU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "R12_TU",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "YTD_TU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "YTD_TU",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "30d_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "30d_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "90d_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "90d_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "180d_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "180d_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "R12_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "R12_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "YTD_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "YTD_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "LTD_Revenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "LTD_Revenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "SP%_LTDTU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "SP%_LTDTU",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "SP%_Life_Down",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "SP%_Life_Down",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "Last_Rent_In_Days",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Last_Rent_In_Days",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "Total_Labor_Hours",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "Total_Labor_Hours",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "Total_Labor_Cost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 38
										},
										"sink": {
											"name": "Total_Labor_Cost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 38
										}
									},
									{
										"source": {
											"name": "Days_Since_Last_Down",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Days_Since_Last_Down",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "Last_Down_Type",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Last_Down_Type",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "IRO_Totals",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IRO_Totals",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IRO_Days_Down",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IRO_Days_Down",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IRO_Labor_Parts_Cost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 38
										},
										"sink": {
											"name": "IRO_Labor_Parts_Cost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 38
										}
									},
									{
										"source": {
											"name": "IMO_Totals",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IMO_Totals",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IMO_Days_Down",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IMO_Days_Down",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IMO_Labor_PartsCost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 38
										},
										"sink": {
											"name": "IMO_Labor_PartsCost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 38
										}
									},
									{
										"source": {
											"name": "last_refresh_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "last_refresh_date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Store_Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Store_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Item_Qty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "Item_Qty",
											"type": "Double",
											"physicalType": "float"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "POR_Dataset",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Inventory"
								}
							}
						]
					},
					{
						"name": "Dimension_Lookup",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "SELECT id,sourcetablename,sourcedb FROM dbo.control_table_por where SubjectArea='Dimension POR SP' and enableaction=1 order by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Dimension",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Dimension_Lookup",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Dimension_Lookup').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "AuditLogStart",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "AuditLogStart",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().id",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"DataFactoryName": {
												"value": {
													"value": "@pipeline().DataFactory",
													"type": "Expression"
												},
												"type": "String"
											},
											"ParentAuditID": {
												"value": {
													"value": "@item().id",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"PipelineName": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerID": {
												"value": {
													"value": "@pipeline().TriggerId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerName": {
												"value": {
													"value": "@pipeline().TriggerName",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerType": {
												"value": {
													"value": "@pipeline().TriggerType",
													"type": "Expression"
												},
												"type": "String"
											},
											"Sourcedb": {
												"value": {
													"value": "@item().sourcedb",
													"type": "Expression"
												},
												"type": "String"
											},
											"sourcetable": {
												"value": {
													"value": "@item().sourcetablename",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "SuccessAuditLog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLogg]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().id",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"DataLakePath": {
												"value": null,
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"ReportType": {
												"value": "POR",
												"type": "String"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											},
											"Type_of_Load": {
												"value": null,
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "ErrorVar",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMessage",
										"value": {
											"value": "@activity('Stored procedure').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "FailureAuditLog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "ErrorVar",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLogg]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().id",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"DataLakePath": {
												"value": null,
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"ReportType": {
												"value": "POR",
												"type": "String"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMessage')",
													"type": "Expression"
												},
												"type": "String"
											},
											"Type_of_Load": {
												"value": null,
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Update_control_por",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "SuccessAuditLog",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_POR_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().id",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "Fact_Table_Lookup",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ForEach_Stage_Procs",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select ID,Sourcetablename,sourcedb from dbo.control_table_por \nwhere SubjectArea='Report Fact POR SP' and processsequence=3 and enableaction=1\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Fact_Tables",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Fact_Table_Lookup",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Fact_Table_Lookup').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Fact Stored Proc",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Fact_AuditLogStart",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().Sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Fact_AuditLogStart",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().id",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"DataFactoryName": {
												"value": {
													"value": "@pipeline().DataFactory",
													"type": "Expression"
												},
												"type": "String"
											},
											"ParentAuditID": {
												"value": {
													"value": "@item().id",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"PipelineName": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerID": {
												"value": {
													"value": "@pipeline().TriggerId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerName": {
												"value": {
													"value": "@pipeline().TriggerName",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerType": {
												"value": {
													"value": "@pipeline().TriggerType",
													"type": "Expression"
												},
												"type": "String"
											},
											"Sourcedb": {
												"value": {
													"value": "@item().sourcedb",
													"type": "Expression"
												},
												"type": "String"
											},
											"sourcetable": {
												"value": {
													"value": "@item().sourcetablename",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Fact_SuccessAuditLog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Fact Stored Proc",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLogg]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().id",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"DataLakePath": {
												"value": null,
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"ReportType": {
												"value": "POR",
												"type": "String"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											},
											"Type_of_Load": {
												"value": null,
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Fact_ErrorVar",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Fact Stored Proc",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMessage",
										"value": {
											"value": "@activity('Fact Stored Proc').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Fact_FailureAuditLog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Fact_ErrorVar",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLogg]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().id",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"DataLakePath": {
												"value": null,
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"ReportType": {
												"value": "POR",
												"type": "String"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMessage')",
													"type": "Expression"
												},
												"type": "String"
											},
											"Type_of_Load": {
												"value": null,
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Fact_Update_control_por",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Fact_SuccessAuditLog",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_POR_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().id",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "Lookup_Stage_Procs_Fleet_And_OECNA",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ForEach_Fact_Tables",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select id,sourcetablename, sourcedb from dbo.control_table_por \nwhere SubjectArea='Report Stage POR SP' and processsequence=4 and enableaction=1\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Stage_Procs_Fleet_And_OECNA",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup_Stage_Procs_Fleet_And_OECNA",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup_Stage_Procs_Fleet_And_OECNA').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Staging_Proc",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Staging_AuditLogStart",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Staging_AuditLogStart",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().id",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"DataFactoryName": {
												"value": {
													"value": "@pipeline().DataFactory",
													"type": "Expression"
												},
												"type": "String"
											},
											"ParentAuditID": {
												"value": {
													"value": "@item().id",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"PipelineName": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerID": {
												"value": {
													"value": "@pipeline().TriggerId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerName": {
												"value": {
													"value": "@pipeline().TriggerName",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerType": {
												"value": {
													"value": "@pipeline().TriggerType",
													"type": "Expression"
												},
												"type": "String"
											},
											"Sourcedb": {
												"value": {
													"value": "@item().sourcedb",
													"type": "Expression"
												},
												"type": "String"
											},
											"sourcetable": {
												"value": {
													"value": "@item().sourcetablename",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Staging_SuccessAuditLog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Staging_Proc",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLogg]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().id",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"DataLakePath": {
												"value": null,
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"ReportType": {
												"value": "POR",
												"type": "String"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											},
											"Type_of_Load": {
												"value": null,
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Staging_ErrorVar",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Staging_Proc",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMessage",
										"value": {
											"value": "@activity('Staging_Proc').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Staging_FailureAuditLog",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Staging_ErrorVar",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLogg]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().id",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"DataLakePath": {
												"value": null,
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"ReportType": {
												"value": "POR",
												"type": "String"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMessage')",
													"type": "Expression"
												},
												"type": "String"
											},
											"Type_of_Load": {
												"value": null,
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Staging_Update_control_por",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Staging_SuccessAuditLog",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_POR_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().id",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "Fact_Table_Lookup_Fleet_And_OECNA",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ForEach_Stage_Procs_Fleet_And_OECNA",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select ID,Sourcetablename from dbo.control_table_por \nwhere SubjectArea='Report Fact POR SP' and processsequence=5 and enableaction=1\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Fact_Tables_Fact_And_OECNA",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Fact_Table_Lookup_Fleet_And_OECNA",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Fact_Table_Lookup_Fleet_And_OECNA').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Fact Stored Proc1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().Sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMessage": {
						"type": "String"
					}
				},
				"folder": {
					"name": "MDP POR DataLoad_New"
				},
				"annotations": [],
				"lastPublishTime": "2022-08-03T09:28:04Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/datasets/POR_Dataset')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_MASTER_LOAD_POR_New')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "PL_Generic_Copy_POR",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Generic_Copy_POR_New",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "PL_Generic_Proc",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "PL_Generic_Copy_POR",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "PL_Generic_Proc",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "PL_Generic_Proc",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_Generic_Copy_POR",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Generic_Proc_New",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "MDP POR DataLoad_New"
				},
				"annotations": [],
				"lastPublishTime": "2022-08-03T09:28:39Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Generic_Copy_POR_New')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/pipelines/PL_Generic_Proc_New')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Master_Netsuite_Source')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Lookup1",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select   * from dbo.control_table_por where sourcedb='Netsuite'  and table_added='Old' and enableaction=1\nand (last_refresh_date is null or format(last_refresh_date,'dd-MM-yyyy')<>format(getdate(),'dd-MM-yyyy'))\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "Table Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Copy data",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "OdbcSource",
											"query": {
												"value": "@activity('Lookup2').output.firstRow.SourceQuery",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('truncate table ',activity('Lookup2').output.firstRow.TargetStageTableSchema,'.[',activity('Lookup2').output.firstRow.TargetStageTableName,']')}",
												"type": "Expression"
											},
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "Netsuite",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup2').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup2').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Lookup2",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('Select Distinct SourceDB , SourceQuery = ''Select ''+ColumnList+'' From ''+SourceTableName, TargetContainer, TargetPath, TargetFile, FileFormat,TargetStageTableSchema,\tTargetStageTableName\nFrom [dbo].[control_table_por]\nWhere ID = ',item().ID)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": true
									}
								},
								{
									"name": "Start_Table_Audit1",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup2",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": true
									}
								},
								{
									"name": "Failure_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLogg]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"ReportType": {
												"value": "Netsuite",
												"type": "String"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											},
											"Type_of_Load": {
												"value": "Netsuite Source Table",
												"type": "String"
											},
											"DataLakePath": {
												"value": {
													"value": "@activity('Lookup2').output.firstRow.TargetPath",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy data",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('Copy data').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Update_control_por1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Sp_ExecSuccessAudit11",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_POR_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Sp_ExecSuccessAudit11",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy data",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLogg]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"ReportType": {
												"value": "Netsuite",
												"type": "String"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy data').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											},
											"Type_of_Load": {
												"value": "Netsuite Source Table",
												"type": "String"
											},
											"DataLakePath": {
												"value": {
													"value": "@activity('Lookup2').output.firstRow.TargetPath",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@concat(pipeline().Pipeline,' ')",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Table Load",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "New Table Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Table Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Table Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "New_Table_Lookup",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  id ID1,sourcedb,sourcetablename from dbo.control_table_por where sourcedb='Netsuite'  and enableaction=1\nand (last_refresh_date is null or format(last_refresh_date,'dd-MM-yyyy')<>format(getdate(),'dd-MM-yyyy'))\nand table_added='New'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "New Table Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "New_Table_Lookup",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('New_Table_Lookup').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup3",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('Select Distinct SourceDB , SourceQuery = ''Select ''+ColumnList+'' From ''+SourceTableName, TargetContainer, TargetPath, TargetFile, FileFormat,TargetStageTableSchema,\tTargetStageTableName\nFrom [dbo].[control_table_por]\nWhere ID = ',item().ID1)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": true
									}
								},
								{
									"name": "Copy data_New1",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit2",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "OdbcSource",
											"query": {
												"value": "@activity('Lookup3').output.firstRow.SourceQuery",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "Netsuite",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup3').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup3').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit2",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup3",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID1",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID1",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Failure_Audit_Log3",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable2",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLogg]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID1",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"ReportType": {
												"value": "Netsuite",
												"type": "String"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy data_New1').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg1')",
													"type": "Expression"
												},
												"type": "String"
											},
											"Type_of_Load": {
												"value": "Netsuite Source Table",
												"type": "String"
											},
											"DataLakePath": {
												"value": {
													"value": "@activity('Lookup3').output.firstRow.TargetPath",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable2",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy data_New1",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg1",
										"value": {
											"value": "@activity('Copy data_New1').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Update_control_por",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Sp_ExecSuccessAudit1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_POR_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID1",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Sp_ExecSuccessAudit1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy data_New1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLogg]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID1",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"ReportType": {
												"value": "Netsuite",
												"type": "String"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy data_New1').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											},
											"Type_of_Load": {
												"value": "Netsuite Source Table",
												"type": "String"
											},
											"DataLakePath": {
												"value": {
													"value": "@activity('Lookup3').output.firstRow.TargetPath",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "Sp_ExecFailureAudit1",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "New Table Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "New Table Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsg": {
						"type": "String"
					},
					"ErrorMsg1": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Netsuite"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-08T06:01:33Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/datasets/Netsuite')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_POR_EXECUTIVE_STAGE_TABLES_LOAD')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "EXECUTIVE_DASHBOARD_STAGE",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "EXECUTIVE_DASHBOARD_STAGE_TRANSACTIONDETAILS",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "with [BI_VW_Items_SerializedFleet_CTE] as  (SELECT\nITF.BoughtUsed\n,ITF.[Qty]\n,ItemQty.DDT\n,ItemQty.Trans_Date\n, ItemQty.TypeName\n,CustomerType,[Customer Number],[Contract No],[Contract Date]\n,ItemQty.[KEY]\n,ItemQty.[TXTY]\n,ItemQty.TransContract\n, ItemQty.[OnRent]\n, ItemQty.[OffRent]\n, ItemQty.[IRO]\n, ItemQty.[IMO]\n, ItemQty.[ISO]\n, iif(ITF.QTY - (ItemQty.[OnRent] + ItemQty.[OffRent] + ItemQty.[IRO]) is null, ITF.Qty, ITF.QTY - (ItemQty.[OnRent] + ItemQty.[OffRent] + ItemQty.[IRO])) AS [Ready]\n, ITF.[KEY] AS [ItemKey]\n, ITF.[Name] AS [ItemName]\n, ITF.[Qty] AS [ItemQty]\n, ITF.[QYOT] AS [QtyOut]\n, ITF.[Type] AS [ItemType]\n, ITF.[Num] AS [ItemNum]\n, ITF.[CNTR] AS [ItemCntr]\n, ITF.[PURP] AS [ItemPurp]\n, ITF.[CurrentStore]\n, ITF.[HomeStore]\n, ITF.[Header] AS [ItemHeader]\n, ITF.[ReplacementCost] AS [ItemReplaceCost]\n, ITF.[BulkItem]\n, ITF.[Inactive]\n, ITF_h.[KEY] AS [HeaderKey]\n, ITF_h.[Name] AS [HeaderName]\n, ITF_h.[Num] AS [HeaderNum]\n, ITF_h.[ReplacementCost] AS [HeaderReplaceCost]\n, PF.[STORE_NAME] AS [CurrentStoreName]\n, ITC.[Name] AS [CategoryName]\n, ITF.[Category] AS [CategoryNumber]\n, ITD.[DivisionName]\n, ITC.[DivisionNumber] as [DivisionNumber]\n, ITF_OEC.OEC AS [OEC]\n\nFROM (((((ItemFile ITF\nLEFT JOIN ItemFile AS ITF_h ON ITF.[Header] = ITF_h.[KEY])\nLEFT JOIN ParameterFile PF ON ITF.[CurrentStore] = PF.[Store])\nLEFT JOIN ItemCategory ITC ON ITF.[Category] = ITC.[Category])\nLEFT JOIN ItemDivision ITD on ITC.[DivisionNumber] = ITD.[DivisionNumber])\nLEFT JOIN (\n\nSELECT  CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END AS CustomerType\n, cf.[CNUM] AS [Customer Number]\n, cf.[Name] AS [Customer Name]\n, t.[CNTR] AS [Contract No]\n, t.[DATE] AS [Contract Date]\n,TI.[TXTY]\n,TI.[ITEM],TI.DDT,T.[Date] as Trans_Date,ItemType.TypeDescrip as TypeName,CF.[KEY],T.CNTR AS TransContract,\n--SUM(iif(Left(TI.[CNTR],1)<>'r' and (not(TI.[TXTY] In ('RR','RX')) or TI.[TXTY] = 'RH' and TI.[DDT] > getdate()),[TI].[Qty],0)) AS OnRent,\nSUM(IIF(LEFT(TI.[CNTR],1)<>'r' AND (NOT(TI.[TXTY] IN ('RR','RX','RH')) OR (TI.txty = 'RH' AND TI.DDT > GETDATE())) ,[TI].[Qty],0)) AS OnRent,\nsum(iif(Left(TI.[CNTR],1)<>'r' and TI.[TXTY] = 'RH' and TI.[DDT] <= getdate(),[TI].[Qty],0)) AS OffRent,\nsum(iif(Left(TI.[CNTR],1)='r' and Not(TI.[TXTY] In ('RR','RX')),[TI].[Qty],0)) AS IRO,\nsum(iif(Left(TI.[CNTR],1)='r' and TI.[TXTY] In ('RR','RX'),[TI].[Qty],0)) AS IMO,\nsum(iif(cf.[KEY] LIKE 'REPAIRS-SERV%' and TI.SUBF = 1,TI.Qty,0)) AS ISO\nFROM ((TransactionItems TI\nINNER JOIN Transactions T ON TI.[CNTR] = T.[CNTR])\nINNER JOIN ItemFile ITF ON TI.[Item] = ITF.[Num]\nLEFT JOIN ItemType  ON ITF.TYPE = ItemType.Type)\nINNER JOIN CustomerFile CF ON T.[CUSN] = CF.[CNUM]\nWHERE Left(TI.[CNTR],1) Not In ('c','f','l','q','t','w') AND\nLeft(TI.[TXTY],1) = 'R' and\nLeft(T.[STAT],1) = 'O' and\nITF.Qty < 99000\nGROUP BY TI.[ITEM],TI.DDT,ItemType.TypeDescrip,CF.[CNUM],T.CNTR,T.[Date], \nt.PYMT \n, cf.[Key]\n, cf.[Name]\n, t.[CNTR]\n, t.[DATE] \n,TI.[TXTY]\n) AS ItemQty ON ITF.[Num] = ItemQty.[Item])\nLEFT JOIN (SELECT [ItemNumber] ,sum(([QuantityPurchased] - [QuantitySold]) * ([PriceEach] + [ExtraCharges])) AS OEC\nFROM [ItemPurchaseDetail]\nWHERE [Disposed] = 0\nGROUP BY [ItemNumber]) AS ITF_OEC ON ITF.[NUM] = ITF_OEC.[ItemNumber]\nWHERE not(ITF.[TYPE] in ('b','e','f','i','k','m','n','o','p','s','v','w'))\nAND ITF.Qty < 90000)\n\n\n-- select top 10 * from TransactionItems\n\n, final as (\nSELECT \nDDT,\nTrans_Date,\nitemkey\n,ItemName\n,CurrentStore\n,CurrentStoreName\n,CategoryName\n,CASE WHEN left(TypeName,5) = 'Sales' then '' \nWHEN [KEY] like 'Repairs-Maint' then '  *In Maint'\nWHEN trim(TransContract) = '' or (TransContract) IS NULL then '  Ready to Rent'\nWHEN left(TransContract,1) = 'r' then '  *In Repair'\nWHEN left(TransContract,1) = 't' then '  *In Transfer'\nELSE '  *On Rent' END AS [Status]\n\n\n,sum(OEC) as OEC\n,sum(OnRent) as OnRent\n, SUM(Ready * OEC) AS [AvailableOEC]\n, SUM(IRO * OEC) AS [InRepairOEC]\n, SUM(OffRent * OEC) AS [OffRentOEC]\n, SUM(OnRent * OEC) AS [OnRentOEC]\n, SUM(ItemQty * OEC) AS [TotalQtyOEC]\n, SUM(Ready) AS [AvailableQty]\n, SUM(IRO) AS [InRepairQty]\n, SUM(OffRent) AS [OffRentQty]\n, SUM(OnRent) AS [OnRentQty]\n, SUM(ItemQty) AS TotalItemQty\n,sum( case when VW.BoughtUsed = 0 then (Ready * OEC) else 0 end ) as New_Equipment\n,sum( case when VW.BoughtUsed = 1 then (Ready * OEC) else 0 end ) as Used_Equipment\n--,getdate()\n, switchoffset(sysdatetimeoffset(),'-05:00') AS [Snapshot_Date]\n,CustomerType,[Customer Number],[Contract No],[Contract Date]\n,[TXTY]\nFROM\n[BI_VW_Items_SerializedFleet_CTE] AS VW \nLEFT OUTER JOIN [ItemFile_TR] AS ITF_TR ON VW.[ItemNum] = ITF_TR.[NUM] AND ITF_TR.[Inactive] = 0\nLEFT OUTER JOIN [ItemCategory_TR] ITC_TR ON VW.[CategoryNumber] = ITC_TR.[Category] AND ITC_TR.[Inactive] = 0 \nLEFT OUTER JOIN [ItemDivision_TR] ITD_TR on VW.[DivisionNumber] = ITD_TR.[DivisionNumber] AND ITD_TR.[Inactive] = 0 \nWHERE\nVW.[Inactive] = 0 AND VW.[BulkItem] = 0\n--and CurrentStore=106\ngroup by DDT,itemkey,Trans_Date\n,ItemName\n,CurrentStore\n,CurrentStoreName\n,CategoryName,CustomerType,[Customer Number],[Contract No],[Contract Date]\n,CASE WHEN left(TypeName,5) = 'Sales' then '' \nWHEN [KEY] like 'Repairs-Maint' then '  *In Maint'\nWHEN trim(TransContract) = '' or (TransContract) IS NULL then '  Ready to Rent'\nWHEN left(TransContract,1) = 'r' then '  *In Repair'\nWHEN left(TransContract,1) = 't' then '  *In Transfer'\nELSE '  *On Rent' END\n,[TXTY]\n)\n\nselect  * from final",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "delete from [POR].[Executive_Dashboard_Stage] where snapshot_date = cast(switchoffset(sysdatetimeoffset(),'-05:00') as date);",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"tableOption": "autoCreate",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "DDT",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "DDT",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "itemkey",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "itemkey",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CurrentStore",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CurrentStore",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CurrentStoreName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CurrentStoreName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CategoryName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CategoryName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Status",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Status",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "OEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "OEC",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "OnRent",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "OnRent",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "AvailableOEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "AvailableOEC",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "InRepairOEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "InRepairOEC",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "OffRentOEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "OffRentOEC",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "OnRentOEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "OnRentOEC",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "TotalQtyOEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "TotalQtyOEC",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "AvailableQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "AvailableQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "InRepairQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "InRepairQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "OffRentQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "OffRentQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "OnRentQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "OnRentQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "TotalItemQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "TotalItemQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "New_Equipment",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "New_Equipment",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "Used_Equipment",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "Used_Equipment",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "Snapshot_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Snapshot_Date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "Trans_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Trans_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "POR_Dataset",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Executive_Dashboard_Stage"
								}
							}
						]
					},
					{
						"name": "EXECUTIVE_DASHBOARD_EQUIPMENT_STAGE",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "EXECUTIVE_DASHBOARD_STAGE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "--USED Equipment\nSELECT\n  saf.Store\n, CAST(saf.DATE AS DATE) AS [Date]\n, CAST(ABS(ti.PRIC - ti.DiscountAmount)*ti.QTY AS DECIMAL(18,2)) AS UsedEquipmentRevenue\n, CAST(ABS(saf.PurchaseCost - saf.Depreciation)*ti.QTY AS DECIMAL(18,3)) AS UsedEquipmentCost\n, NULL AS NewEquipmentRevenue\n, NULL AS NewEquipmentCost\n, CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END AS CustomerType\n, cf.[CNUM] AS [Customer Number]\n, cf.[Name] AS [Customer Name]\n, t.[CNTR] AS [Contract No]\n, t.[DATE] AS [Contract Date]\n, ti.[TXTY]\n, ifi.[Name] AS ItemName\n, ifi.[Key] As [ItemKey]\n, ifi.MANF As [Make]\n, ifi.MODN As [Model]\n, ifi.ModelYear\n, ic.[Name] AS CategoryName\n\nFROM POR.dbo.SoldAssetFile saf\nJOIN POR.dbo.Transactions t ON t.CNTR = saf.CNTR\nJOIN POR.dbo.TransactionItems ti ON ti.CNTR = saf.CNTR AND saf.ItemNo = ti.ITEM\nJOIN POR.dbo.ItemFile ifi ON ifi.[NUM] = ti.ITEM\nJOIN POR.dbo.ItemCategory ic ON ic.Category = ifi.Category\nJOIN POR.dbo.CustomerFile cf ON cf.CNUM = saf.CustNo\nWHERE ti.TXTY = 'SA'\nAND ti.QTY <> 0\n\nUNION ALL\n\n--NEW Equipment\nSELECT\n  tca.Store\n, CAST(tca.Date AS DATE) AS [Date]\n, NULL AS UsedEquipmentRevenue\n, NULL AS UsedEquipmentCost\n, CAST(ABS((ti.PRIC - ti.DiscountAmount))*ti.QTY AS DECIMAL(18,2)) AS NewEquipmentRevenue\n, CAST(ABS((ipd.PriceEach + ipd.ExtraCharges))*ti.QTY AS DECIMAL(18,3)) AS NewEquipmentCost\n, CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END AS CustomerType\n, cf.[CNUM] AS [Customer Number]\n, cf.[Name] AS [Customer Name]\n, t.[CNTR] AS [Contract No]\n, t.[DATE] AS [Contract Date]\n, TI.[TXTY]\n, ifi.[Name] AS ItemName\n, ifi.[Key] As [ItemKey]\n, ifi.MANF As [Make]\n, ifi.MODN As [Model]\n, ifi.ModelYear\n, ic.[Name] AS CategoryName\n\nFROM POR.dbo.TotalsContractsAccrual tca\nJOIN POR.dbo.Transactions t ON t.CNTR = tca.CNTR\nJOIN POR.dbo.TransactionItems ti ON ti.CNTR = tca.CNTR\nJOIN POR.dbo.ItemFile ifi ON ifi.[NUM] = ti.ITEM\nJOIN POR.dbo.ItemCategory ic ON ic.Category = ifi.Category\nJOIN POR.dbo.CustomerFile cf ON cf.CNUM = tca.Cusn\nJOIN POR.dbo.ItemPurchaseDetail ipd ON ipd.[ItemNumber] = ifi.NUM AND ipd.QuantitySold >0\nWHERE ti.TXTY = 'SS'\nAND ifi.Asset=0\nAND (ifi.SerialNumber <> '')\nAND (tca.SaleTx <> 0 OR tca.SaleNT <> 0)\nAND ti.QTY <> 0",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table [POR].[Executive_Dashboard_Equipment_Stage];",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "Store",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Store",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Date",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "Date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "UsedEquipmentRevenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "UsedEquipmentRevenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "UsedEquipmentCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "UsedEquipmentCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "NewEquipmentRevenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "NewEquipmentRevenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "NewEquipmentCost",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "NewEquipmentCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemKey",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemKey",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ModelYear",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ModelYear",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CategoryName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CategoryName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "POR_Dataset",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Executive_Dashboard_Equipment_Stage"
								}
							}
						]
					},
					{
						"name": "EXECUTIVE_DASHBOARD_RENT_STAGE",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "EXECUTIVE_DASHBOARD_EQUIPMENT_STAGE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "WITH v_CTE AS (\n\nSELECT store,sum([TCA].[RentTX] + [TCA].[RentNT]) AS Rent,\n\n       sum([TCA].[SaleTX] + [TCA].[SaleNT] - ISNULL(dp.DelPUamt,0)) AS Sale,  --subtract out Delivery/PU type 4 transactionitems\n\ntca.[Date] AS PostedDate, sum(dp.Purchase_Price) as Purchase_Price, sum(dp.Current_Book_Price) as Current_Book_Price, dp.CustomerType, dp.[Customer Number],\ndp.[Contract No], dp.[Contract Date],dp.[TXTY]\n\nFROM POR.dbo.TotalsContractsAccrual tca\n\nLEFT JOIN (\n\n       SELECT ti.CNTR, SUM(ti.PRIC) AS DelPUamt, SUM(ifi.PURP) as Purchase_Price, \n\t   SUM(ifi.CURV) as Current_Book_Price,CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END AS CustomerType\n, cf.[CNUM] AS [Customer Number]\n, cf.[Name] AS [Customer Name]\n, t.[CNTR] AS [Contract No]\n, t.[DATE] AS [Contract Date]\n,TI.[TXTY]\n\n       FROM POR.dbo.TransactionItems ti\n\t   JOIN POR.dbo.Transactions t ON ti.CNTR = t.CNTR\n       INNER JOIN CustomerFile CF ON T.[CUSN] = CF.[CNUM]\n       JOIN POR.dbo.ItemFile ifi ON ifi.NUM = ti.ITEM\n\n       WHERE (ifi.Category = 4 --Delivery/PU\n\n         OR (ifi.SerialNumber <> '' AND ifi.Asset = 0))  --non-asset with serialnumber <-- ******** Not sure this works, see CNTR 103027A ** NEED TO ASK MICHAEL\n\n                      --Select * from POR.dbo.Itemfile where [key] = '6965'\n\n                       --SELECT * from POR.dbo.Itemfile where SerialNumber <> '' AND Asset = 0  <-- these 47 just might be marked incorrectly\n\n          GROUP BY ti.CNTR,CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END \n, cf.[CNUM]\n, cf.[Name]\n, t.[CNTR]\n, t.[DATE] \n,TI.[TXTY]\n\n) dp ON dp.CNTR = tca.CNTR\n\ngroup by store, tca.Date, dp.CustomerType, dp.[Customer Number],\ndp.[Contract No], dp.[Contract Date],dp.[TXTY]\n\n)\n\nSELECT store,SUM(Rent) AS RentSum, SUM(Sale) AS SaleSum, \ncast(PostedDate as date) as Posted_Date,isnull(sum(Purchase_Price),0) as Purchase_Price,\nisnull(sum(Current_Book_Price),0) as Current_Book_Price,CustomerType, [Customer Number],\n[Contract No], [Contract Date],[TXTY]\n\nFROM v_CTE\ngroup by store,PostedDate,CustomerType, [Customer Number],\n[Contract No], [Contract Date],[TXTY]",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table  [POR].[Executive_Dashboard_Rent_Stage];",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"tableOption": "autoCreate",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "store",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "store",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "RentSum",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "RentSum",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "SaleSum",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "SaleSum",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Posted_Date",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "Posted_Date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "Purchase_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Purchase_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Current_Book_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Current_Book_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "POR_Dataset",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Executive_Dashboard_Rent_Stage"
								}
							}
						]
					},
					{
						"name": "EXECUTIVE_DASHBOARD_SALES_STAGE",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "EXECUTIVE_DASHBOARD_RENT_STAGE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "SELECT SoldItems.Batch,SoldItems.[Date], SoldItems.CNTR, SoldItems.ItemNo, SoldItems.CustNo, SoldItems.Amount, SoldItems.Qty, SoldItems.[Name], SoldItems.PurchaseCost,\n\n       SoldItems.Depreciation, SoldItems.PurchaseDate, SoldItems.Store, SoldItems.Asset, SoldItems.Header, SoldItems.CustomerName,\n\n          SoldItems.[KEY],\n\n           iif(ItemTL.ItemName is Null, SoldItems.ItemName,ItemTL.ItemName) as ItemName,\n\t\t   SoldItems.BoughtUsed,\n\n\n           SoldItems.ItemQty, SoldItems.PartNumber, SoldItems.ItemNum, SoldItems.MANF, SoldItems.MODN,\n\n          iif(ItemTL.UserDefined1 is Null, SoldItems.UserDefined1,ItemTL.UserDefined1) as UserDefined1,\n\n          SoldItems.INC3, SoldItems.REPC2, SoldItems.GLAccount, SoldItems.HomeStore, SoldItems.CurrentStore, SoldItems.SerialNumber,\n\n         iif(CatTL.CatName is Null,SoldItems.CategoryName,CatTL.CatName) as CategoryName,\n\n          SoldItems.AssetGL,\n\n          iif(DivTL.DivisionName is Null, SoldItems.DivisionName,DivTL.DivisionName) as DivisionName,\n\n           SoldItems.NoPrintItemNo,\n\n          SoldItems.GLEquip, SoldItems.Category, SoldItems.DivisionNumber,\n\t\t -- getdate() \n\t\t  switchoffset(sysdatetimeoffset(),'-05:00')  as Snapshot_Date, \n\t\t  SoldItems.CustomerType, SoldItems.[Contract Date], SoldItems.[TXTY]\n\nfrom (\n\n \n\nSELECT SA.Batch,SA.[Date], SA.CNTR, SA.ItemNo,ITF.BoughtUsed ,SA.CustNo, SA.Amount, SA.Qty, SA.[Name], SA.PurchaseCost,\n\n       SA.Depreciation, SA.PurchaseDate, SA.Store, SA.Asset, ITF.Header, CF.[Name] AS CustomerName,\n\n          ITF.[KEY], ITF.[Name] as ItemName, ITF.QTY as ItemQty, ITF.PartNumber, ITF.NUM as ItemNum, ITF.MANF, ITF.MODN,\n\n          ITF.UserDefined1, ITF.INC3, ITF.REPC2, ITF.GLAccount, ITF.HomeStore, ITF.CurrentStore, ITF.SerialNumber,\n\n          CAT.[Name] as CategoryName, CAT.AssetGL, ID.DivisionName, PF.NoPrintItemNo,\n\n          AC.Equipment as GLEquip, ITF.Category, ID.DivisionNumber, CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END AS CustomerType\n, t.[DATE] AS [Contract Date]\n,TI.[TXTY]\n\n         \n\n \n\nFROM SoldAssetFile SA\n\n      LEFT JOIN ItemFile ITF ON SA.ItemNo = ITF.NUM\n\n         LEFT JOIN ItemCategory CAT ON ITF.Category = CAT.Category \n\n         LEFT JOIN ItemDivision ID ON CAT.DivisionNumber = ID.DivisionNumber\n\n      LEFT JOIN CustomerFile CF ON SA.CustNo = CF.CNUM\n\t  JOIN POR.dbo.Transactions t ON CF.CNUM = t.CUSN\n\t  join POR.dbo.TransactionItems ti on t.CNTR = ti.CNTR\n\n         LEFT JOIN ParameterFile PF ON ITF.HomeStore = PF.[Store]\n\n         LEFT JOIN AccountNumbers AC ON SA.Store = AC.Store  ) as SoldItems\n\n \n\n--WHERE Batch >={?BegBatch} and\n\n--      Batch <= {?EndBatch} and\n\n--      ('{?CustNo}' = '*' OR SA.CustNo = '{?CustNo}')  AND\n\n--      ('{?Header}' = '*' OR ITF.Header = '{?Header}' ) AND\n\n--      ('{?ItemNo}' = '*' OR SA.ItemNo = '{?ItemNo}')\n\n--\n\n--) as SoldItems\n\n \n\nLeft Join\n\n \n\n(SELECT TL.[NUM], TL.[Name] as ItemName, TL.INST, TL.Style1 , TL.Style2, TL.Style3 , TL.WebLink ,TL.VehicleType ,\n\nTL.[DescriptionLong],TL.WebGroup , TL.[Group] as ItemGroup,TL.[LOOKUP]  ,TL.[UserDefined1] , TL.[UserDefined2]\n\nFROM TranslationNames TN \n\nLEFT JOIN ItemFile_Tr TL on TN.LanguageCode = TL.Languagecode\n\n--WHERE TN.LanguageCode IS NULL OR TN.LanguageCode = '{?LanguageCode}'\n\n) AS ItemTL ON SoldItems.ItemNum = ItemTL.Num\n\nLeft Join\n\n \n\n(SELECT TL.Category,  TL.[Name] as CatName,TL.WebTags, TL.Style1 as CatStyle1 ,TL.Style2 as CatStyle2, TL.Style3 as CatStyle3 \n\nFROM TranslationNames TN\n\nLEFT JOIN ItemCategory_Tr TL ON TN.LanguageCode  = TL.Languagecode \n\n--WHERE TN.LanguageCode IS NULL OR TN.LanguageCode = '{?LanguageCode}' \n\n) AS CatTL ON SoldItems.Category = CatTL.Category\n\nLeft Join\n\n \n\n(  SELECT  TL.DivisionNumber,  TL.DivisionName   \n\nFROM TranslationNames TN  \n\nLEFT JOIN ItemDivision_Tr TL ON TN.LanguageCode  = TL.Languagecode\n\n--WHERE TN.LanguageCode IS NULL OR TN.LanguageCode = '{?LanguageCode}'\n\n) AS DivTL ON SoldItems.DivisionNumber = DivTL.DivisionNumber",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "delete from [POR].[Executive_Dashboard_Sales_Stage] where snapshot_date=cast(switchoffset(sysdatetimeoffset(),'-05:00') as date);",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"tableOption": "autoCreate",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "Batch",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "Batch",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "CNTR",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CNTR",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemNo",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemNo",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CustNo",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CustNo",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Amount",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Amount",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Qty",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "Qty",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "PurchaseCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "PurchaseCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Depreciation",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Depreciation",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "PurchaseDate",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "PurchaseDate",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Store",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Store",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Asset",
											"type": "Boolean",
											"physicalType": "bit"
										},
										"sink": {
											"name": "Asset",
											"type": "Boolean",
											"physicalType": "bit"
										}
									},
									{
										"source": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CustomerName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CustomerName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "KEY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "KEY",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "BoughtUsed",
											"type": "Boolean",
											"physicalType": "bit"
										},
										"sink": {
											"name": "BoughtUsed",
											"type": "Boolean",
											"physicalType": "bit"
										}
									},
									{
										"source": {
											"name": "ItemQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "ItemQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "PartNumber",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PartNumber",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemNum",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemNum",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "MANF",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "MANF",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "MODN",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "MODN",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "UserDefined1",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "UserDefined1",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "INC3",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "INC3",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "REPC2",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "REPC2",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "GLAccount",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "GLAccount",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "HomeStore",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "HomeStore",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CurrentStore",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CurrentStore",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "SerialNumber",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "SerialNumber",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CategoryName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CategoryName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "AssetGL",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "AssetGL",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "DivisionName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "DivisionName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "NoPrintItemNo",
											"type": "Boolean",
											"physicalType": "bit"
										},
										"sink": {
											"name": "NoPrintItemNo",
											"type": "Boolean",
											"physicalType": "bit"
										}
									},
									{
										"source": {
											"name": "GLEquip",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "GLEquip",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Category",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "Category",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "DivisionNumber",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "DivisionNumber",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Snapshot_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Snapshot_Date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "POR_Dataset",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Executive_Dashboard_Sales_Stage"
								}
							}
						]
					},
					{
						"name": "EXECUTIVE_DASHBOARD_EQUIPMENT_DELIVERY_STAGE",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "EXECUTIVE_DASHBOARD_SALES_STAGE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "SELECT \n\n--Below are Transaction Level Items\n\n  CASE WHEN pf.Store <> '001' THEN RIGHT(pf.STORE_NAME, LEN(pf.STORE_NAME) - 4) ELSE pf.STORE_NAME END AS [Store Name]\n\n, t.[STR] AS [Store No]\n\n, CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END AS CustomerType\n\n, cf.[CNUM] AS [Customer Number]\n\n, cf.[Name] AS [Customer Name]\n\n, t.JOBN AS [Job Name]\n\n, t.JBPO AS [Job PO#] \n\n, t.JBID AS [Job #]\n\n, cjs.Description AS [Job Site Name]\n\n, ISNULL(cjs.SiteAddress,'') + ' ' + ISNULL(cjs.SiteCity,'') + ' ' + ISNULL(cjs.SiteZip,'') AS [Job Site Address]\n\n, t.DMG AS [Extended Protection Plan]\n\n, s.[Name] AS [Contract Salesman]\n\n, s2.[Name] AS [Customer Salesman]\n\n, o.OPNM AS [Created by Operator Name]\n\n, o2.OPNM AS [Assigned to Operator Name]\n\n, t.[DATE] AS [Contract Date]\n\n, t1.OriginalContractDate AS [Original Contract Date]\n\n, t.[CNTR] AS [Contract No]\n\n--Below are Item level details\n\n, CASE WHEN ti.TXTY = 'R' THEN 'RENT'\n\n       WHEN ti.TXTY = 'RR' THEN 'Returned'\n\n       WHEN ti.TXTY = 'RX' THEN 'Previously Returned'\n\n       WHEN ti.TXTY = 'RH' THEN 'Not Returned. Item on hold for pickup'\n\n       WHEN ti.TXTY = 'RD' THEN 'Not Returned. Demand letter sent'\n\n       WHEN ti.TXTY = 'RM' THEN 'Not Returned. Reservation Reminder letter sent'\n\n       WHEN ti.TXTY = 'RN' THEN 'Not Returned. Reminder letter sent'\n\n       WHEN ti.TXTY = 'RV' THEN 'Not Returned. Reservation Verify letter sent'\n\n       WHEN ti.TXTY = '' THEN 'Not Returned. No letters have been sent'\n\nELSE 'Sale Item' END AS [Item Status]\n\n, ifi.Header \n\n, ti.ITEM AS [Key] \n\n, ifi.Name\n\n, ifi.SerialNumber AS [Serial Number]\n\n, ifi.MANF AS [Make]\n\n, ifi.MODN AS [Model]\n\n, ifi.Modelyear AS [Model Year]\n\n, ti.PRIC AS [Amount Charged]\n\n, ti.DailyAmount AS [Daily]\n\n, ifi.RATE1 AS [Book Rate Daily]\n\n, ti.WeeklyAmount AS [Weekly]\n\n, ifi.RATE2 AS [Book Rate Weekly]\n\n, ti.MonthlyAmount AS [Monthly]\n\n, ifi.RATE3 AS [Book Rate Monthly]\n\n, CASE WHEN ti.Substatus = 7 THEN 'Substitute' ELSE '' END AS [Is Substitute]\n\n, CASE WHEN ti.Substatus = 7 THEN ti.Comments ELSE '' END AS [Substitution Comments]\n--,getdate() \n,switchoffset(sysdatetimeoffset(),'-05:00')  Report_Refresh_Date\n\n\n \n\nFROM POR.dbo.transactions t\n\nJOIN POR.dbo.TransactionItems ti ON ti.CNTR = t.CNTR\n\nJOIN POR.dbo.ItemFile ifi ON ifi.NUM = ti.ITEM\n\nJOIN POR.dbo.ParameterFile pf ON pf.Store = t.[STR]\n\nJOIN (SELECT t0.CNTR, t0.[DATE] AS OriginalContractDate FROM POR.dbo.Transactions t0 WHERE RIGHT(t0.CNTR,1) NOT LIKE '[A-Za-z]%') t1\n\n              ON t1.CNTR = CASE WHEN RIGHT(t.CNTR,1) LIKE '[A-Za-z]%' THEN LEFT(t.CNTR, LEN(t.CNTR)-1) ELSE t.CNTR END\n\nLEFT JOIN POR.dbo.ItemComments ic ON ic.NUM = ifi.NUM\n\nLEFT JOIN POR.dbo.CustomerFile cf ON cf.CNUM = t.CUSN\n\nLEFT JOIN POR.dbo.CustomerJobSite cjs ON cjs.Number = t.JobSite\n\nLEFT JOIN POR.dbo.Salesman s ON s.Number = t.Salesman\n\nLEFT JOIN POR.dbo.Salesman s2 ON s2.Number = cf.Salesman\n\nLEFT JOIN POR.dbo.OperatorId o ON o.OPNO = t.OperatorCreated\n\nLEFT JOIN POR.dbo.OperatorId o2 ON o2.OPNO = t.OperatorAssigned\n\n \n\nWHERE LEFT(t.STAT,1) = 'O'\n\nAND LEFT(t.CNTR,1) NOT IN ('q','r','s','t')\n\nAND (ifi.TYPE IN ('T','H','U','V','A','L','R','N','K','D') -- Include Rental types & delivery/pickup charges only; exclude sales, diesel, etc.\n\nOR ifi.Name LIKE 'Delivery%' --2. Sale items to include\n\nOR ifi.Name LIKE 'Pickup%' --3. Sale items to include\n\n)\n\nAND t.STAT NOT IN ('OJ','OH','RR','OR')\n\nAND ti.TXTY <> 'RR'\n\nORDER BY [Store Name], cf.[NAME], t.[DATE] ASC, t.CNTR, s.[Name]",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table  [POR].[Executive_Dashboard_Equipment_Delivery_Stage];",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"tableOption": "autoCreate",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "Store Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Store Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Store No",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Store No",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job PO#",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job PO#",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job #",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job #",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job Site Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job Site Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job Site Address",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job Site Address",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Extended Protection Plan",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Extended Protection Plan",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Contract Salesman",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Contract Salesman",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer Salesman",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer Salesman",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Created by Operator Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Created by Operator Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Assigned to Operator Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Assigned to Operator Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Original Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Original Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Item Status",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Item Status",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Key",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Key",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Serial Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Serial Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model Year",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model Year",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Amount Charged",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Amount Charged",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Daily",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Daily",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Book Rate Daily",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Book Rate Daily",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Weekly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Weekly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Book Rate Weekly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Book Rate Weekly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Monthly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Monthly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Book Rate Monthly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Book Rate Monthly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Is Substitute",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Is Substitute",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "Substitution Comments",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Substitution Comments",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Report_Refresh_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Report_Refresh_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "POR_Dataset",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Executive_Dashboard_Equipment_Delivery_Stage"
								}
							}
						]
					},
					{
						"name": "PROC_LOAD_EXECUTIVE_DASHBOARD_FLEET",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "EXECUTIVE_DASHBOARD_EQUIPMENT_DELIVERY_STAGE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[por].[proc_load_executive_dashboard_fleet]"
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "PROC_LOAD_EXECUTIVE_DASHBOARD_OECNA",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "EXECUTIVE_DASHBOARD_EQUIPMENT_DELIVERY_STAGE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[por].[proc_load_executive_dashboard_oecna]"
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "EXECUTIVE_DASHBOARD_RENT_STAGE_Detail",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "WITH v_CTE AS (\n\nSELECT store,sum([TCA].[RentTX] + [TCA].[RentNT]) AS Rent,\n\n       sum([TCA].[SaleTX] + [TCA].[SaleNT] - ISNULL(dp.DelPUamt,0)) AS Sale,  --subtract out Delivery/PU type 4 transactionitems\n\ntca.[Date] AS PostedDate, sum(dp.Purchase_Price) as Purchase_Price, sum(dp.Current_Book_Price) as Current_Book_Price, dp.CustomerType, dp.[Customer Number],\ndp.[Contract No], dp.[Contract Date],dp.[TXTY],dp.ItemKey,dp.ItemName,dp.Make,dp.Model,dp.ModelYear,dp.categoryname\n\nFROM POR.dbo.TotalsContractsAccrual tca\n\nLEFT JOIN (\n\n       SELECT ti.CNTR, SUM(ti.PRIC) AS DelPUamt, SUM(ifi.PURP) as Purchase_Price, \n\t   SUM(ifi.CURV) as Current_Book_Price,CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END AS CustomerType\n, cf.[CNUM] AS [Customer Number]\n, cf.[Name] AS [Customer Name]\n, t.[CNTR] AS [Contract No]\n, t.[DATE] AS [Contract Date]\n,TI.[TXTY],ifi.[Name] ItemName,ifi.[Key] As [ItemKey],ifi.MANF As [Make],\nifi.MODN As [Model],\nifi.ModelYear,ic.[Name] categoryname\n       FROM POR.dbo.TransactionItems ti\n\t   JOIN POR.dbo.Transactions t ON ti.CNTR = t.CNTR\n       INNER JOIN CustomerFile CF ON T.[CUSN] = CF.[CNUM]\n       JOIN POR.dbo.ItemFile ifi ON ifi.NUM = ti.ITEM\n\t   JOIN POR.dbo.ItemCategory ic ON ifi.Category = ic.Category\n       WHERE (ifi.Category = 4 --Delivery/PU\n\n         OR (ifi.SerialNumber <> '' AND ifi.Asset = 0))  --non-asset with serialnumber <-- ******** Not sure this works, see CNTR 103027A ** NEED TO ASK MICHAEL\n\n                      --Select * from POR.dbo.Itemfile where [key] = '6965'\n\n                       --SELECT * from POR.dbo.Itemfile where SerialNumber <> '' AND Asset = 0  <-- these 47 just might be marked incorrectly\n\n          GROUP BY ti.CNTR,CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END \n, cf.[CNUM]\n, cf.[Name]\n, t.[CNTR]\n, t.[DATE] \n,TI.[TXTY],ifi.[Name] ,ifi.[Key] ,ifi.MANF ,ic.[Name],\nifi.MODN ,ifi.ModelYear\n\n) dp ON dp.CNTR = tca.CNTR\n\ngroup by store, tca.Date, dp.CustomerType, dp.[Customer Number],\ndp.[Contract No], dp.[Contract Date],dp.[TXTY],dp.ItemKey,dp.ItemName,dp.Make,dp.Model,dp.ModelYear,dp.categoryname\n\n)\n\nSELECT store,SUM(Rent) AS RentSum, SUM(Sale) AS SaleSum, \ncast(PostedDate as date) as Posted_Date,isnull(sum(Purchase_Price),0) as Purchase_Price,\nisnull(sum(Current_Book_Price),0) as Current_Book_Price,CustomerType, [Customer Number],\n[Contract No], [Contract Date],[TXTY],ItemKey,ItemName,Make,Model,ModelYear,categoryname\n\nFROM v_CTE\ngroup by store,PostedDate,CustomerType, [Customer Number],\n[Contract No], [Contract Date],[TXTY],ItemKey,ItemName,Make,Model,ModelYear,categoryname\n\n\n\n--select * from [POR]..[ItemCategory]",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table  [POR].[Executive_Dashboard_Rent_Stage_Detail];",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"tableOption": "autoCreate",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "store",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "store",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "RentSum",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "RentSum",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "SaleSum",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "SaleSum",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Posted_Date",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "Posted_Date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "Purchase_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Purchase_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Current_Book_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Current_Book_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemKey",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemKey",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ModelYear",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ModelYear",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "categoryname",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CategoryName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "POR_Dataset",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Executive_Dashboard_Rent_Stage_Detail"
								}
							}
						]
					},
					{
						"name": "EXECUTIVE_DASHBOARD_EQUIPMENT_STAGE_Detail",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "EXECUTIVE_DASHBOARD_RENT_STAGE_Detail",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "SELECT \nstore,cast(tca.[date] as date) as date,\n  ISNULL(SUM(CASE WHEN ti.TXTY = 'SA' AND ifi.Asset = 1 AND (tca.AssetTx <> 0 OR tca.AssetNT <> 0) THEN ti.PRIC  END), '')\n  AS UsedEquipmentRevenue,\n  --   ISNULL(SUM(CASE WHEN ti.TXTY = 'SA' AND ifi.Asset = 1 AND (tca.AssetTx <> 0 OR tca.AssetNT <> 0) THEN ifi.PURP  END), '')\n  --AS UsedEquipmentCost\n\n   ISNULL(SUM(CASE WHEN ti.TXTY = 'SA' AND ifi.Asset = 1 AND (tca.AssetTx <> 0 OR tca.AssetNT <> 0) THEN ipd.PriceEach+ipd.ExtraCharges  END), '')\n  AS UsedEquipmentCost\n  ,\n  ISNULL(SUM(CASE WHEN ti.TXTY = 'SS' AND \nifi.Asset = 0 AND ifi.SerialNumber <> '' AND (tca.SaleTx <> 0 OR tca.SaleNT <> 0) THEN ti.PRIC  END), '')\nAS NewEquipmentRevenue,\n\n-- ISNULL(SUM(CASE WHEN ti.TXTY = 'SS' AND \n--ifi.Asset = 0 AND ifi.SerialNumber <> '' AND (tca.SaleTx <> 0 OR tca.SaleNT <> 0) THEN ifi.PURP  END), '')\n--AS NewEquipmentCost,\n\n ISNULL(SUM(CASE WHEN ti.TXTY = 'SS' AND \nifi.Asset = 0 AND ifi.SerialNumber <> '' AND (tca.SaleTx <> 0 OR tca.SaleNT <> 0) THEN ipd.PriceEach+ipd.ExtraCharges  END), '')\nAS NewEquipmentCost,\n\nsum(ifi.purp) as Purchase_Price, sum(ifi.curv) as Current_Book_Price\n,CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END AS CustomerType\n, cf.[CNUM] AS [Customer Number]\n, cf.[Name] AS [Customer Name]\n, t.[CNTR] AS [Contract No]\n, t.[DATE] AS [Contract Date]\n,TI.[TXTY]\n, ifi.[Name] ItemName,ifi.[Key] As [ItemKey],ifi.MANF As [Make],\nifi.MODN As [Model],\nifi.ModelYear,ic.[Name] categoryname\nFROM POR.dbo.TotalsContractsAccrual tca\nJOIN POR.dbo.Transactions t ON t.CNTR = tca.CNTR\nJOIN POR.dbo.TransactionItems ti ON ti.CNTR = t.CNTR\nJOIN POR.dbo.ItemFile ifi ON ifi.NUM = ti.ITEM\nINNER JOIN por.dbo.CustomerFile CF ON T.[CUSN] = CF.[CNUM]\nJOIN POR.dbo.ItemCategory ic ON ifi.Category = ic.Category\nJOIN POR.dbo.ItemPurchaseDetail ipd ON ipd.[ItemNumber] = ifi.NUM\ngroup by store,cast(tca.[date] as date)  \n,CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END \n, cf.[CNUM]\n, cf.[Name]\n, t.[CNTR]\n, t.[DATE] \n,TI.[TXTY],ifi.[Name] ,ifi.[Key] ,ifi.MANF ,ic.[Name],\nifi.MODN ,ifi.ModelYear",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table [POR].[Executive_Dashboard_Equipment_Stage_Detail];",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "store",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "store",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "date",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "UsedEquipmentRevenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "UsedEquipmentRevenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "UsedEquipmentCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "UsedEquipmentCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "NewEquipmentRevenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "NewEquipmentRevenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "NewEquipmentCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "NewEquipmentCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Purchase_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Purchase_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Current_Book_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Current_Book_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemKey",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemKey",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ModelYear",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ModelYear",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "categoryname",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CategoryName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "POR_Dataset",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Executive_Dashboard_Equipment_Stage_Detail"
								}
							}
						]
					},
					{
						"name": "PROC_LOAD_EXECUTIVE_DASHBOARD_FLEET_SUMMARY",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "EXECUTIVE_DASHBOARD_EQUIPMENT_DELIVERY_STAGE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[por].[proc_load_executive_dashboard_fleet_summary]"
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "PROC_LOAD_EXECUTIVE_DASHBOARD_OECNA_SUMMARY",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "EXECUTIVE_DASHBOARD_EQUIPMENT_DELIVERY_STAGE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[por].[proc_load_executive_dashboard_oecna_summary]"
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "EXECUTIVE_DASHBOARD_STAGE_SUMMARY",
						"description": "match POR system dashboard.  \nuse view query behind widget.",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "SELECT\n  a.ItemKey\n, a.ItemNum\n, a.ItemName\n, a.ItemType\n, a.Asset\n, a.ItemQty\n, a.QtyOut\n, a.OnRentQty\n, a.OffRentQty\n, a.CalledOffRentQty\n, a.PickUpOffRentQty\n, a.IROQty\n, a.IMOQty\n, a.ISOQty\n, IIF(a.ItemQty - (a.OnRentQty + a.OffRentQty + a.IROQty) IS NULL, a.ItemQty, a.ItemQty - (a.OnRentQty + a.OffRentQty + a.IROQty)) AS [AvailableQty]\n, a.ItemCntr\n, a.ItemPurp\n, a.HomeStore\n, a.CurrentStore\n, a.CurrentStoreName\n, a.ItemHeader\n, a.ItemReplaceCost\n, a.BulkItem\n, a.Inactive\n, a.BoughtUsed\n, a.HeaderKey\n, a.HeaderName\n, a.HeaderNum\n, a.HeaderReplaceCost\n, a.CategoryNumber\n, a.CategoryName\n, a.OEC\n, SUM(a.ItemQty * a.OEC) AS [TotalOEC]\n, SUM(a.OnRentQty * a.OEC) AS [TotalOnRentOEC]\n, SUM(a.OffRentQty * a.OEC) AS [TotalOffRentOEC]\n, SUM(a.CalledOffRentQty * a.OEC) AS [TotalOffRentOECCalledOff]\n, SUM(a.PickUpOffRentQty * a.OEC) AS [TotalOffRentOECPickUp]\n--Inspect = TotalNotAvailable - (TotalOffRentOEC + TotalInRepair)\n, (SUM(a.ItemQty * a.OEC) - (SUM(a.OnRentQty * a.OEC) + (SUM((IIF(a.ItemQty - (a.OnRentQty + a.OffRentQty + a.IROQty) IS NULL, a.ItemQty, a.ItemQty - (a.OnRentQty + a.OffRentQty + a.IROQty))) * a.OEC)))\n\t\t- ((SUM(a.OffRentQty * OEC)) + (SUM(a.IROQty * a.OEC)))) AS [TotalInspectOEC]\n--TotalNotAvailableOEC = TotalOEC - (TotalOnRentOEC + TotalAvailableOEC)\n, ((SUM(a.ItemQty * a.OEC)) - ((SUM(a.OnRentQty * a.OEC)) + (SUM((IIF(a.ItemQty - (a.OnRentQty + a.OffRentQty + a.IROQty) IS NULL, a.ItemQty, a.ItemQty - (a.OnRentQty + a.OffRentQty + a.IROQty))) * a.OEC)))) AS [TotalNotAvailableOEC]\n, SUM((IIF(a.ItemQty - (a.OnRentQty + a.OffRentQty + a.IROQty) IS NULL, a.ItemQty, a.ItemQty - (a.OnRentQty + a.OffRentQty + a.IROQty))) * a.OEC) AS [TotalAvailableOEC]\n, SUM(a.IROQty * a.OEC) AS [TotalInRepairOEC]\n, a.Snapshot_Date\nFROM (\nSELECT\n        ITF.[KEY] AS ItemKey\n\t  , ITF.[Num] AS ItemNum\n      , ITF.[Name] AS ItemName\n\t  , ITF.[Type] AS ItemType\n\t  , ITF.Asset      \n      , ITF.[Qty] AS ItemQty\n      , ITF.[QYOT] AS QtyOut\n\t  --Adjusted quantities in case of multiple out asset issue:\n\t  --OnRent\n\t  , CASE WHEN ITF.Asset=1 AND ITF.[QYOT]>1 AND ItemQty.[OnRent]>0 THEN 1\n\t\tWHEN ITF.Asset=1 AND ITF.[QYOT]>1 AND ItemQty.[OnRent]=0 THEN 0\n\t\tELSE ItemQty.[OnRent] END AS [OnRentQty]\n\t  --OffRent\n\t  , CASE WHEN ITF.Asset=1 AND ITF.[QYOT]>1 AND ItemQty.[OnRent]>0 THEN 0\n\t\tWHEN ITF.Asset=1 AND ITF.[QYOT]>1 AND ItemQty.[OffRent]>0 THEN 1\n\t\tELSE ItemQty.[OffRent] END AS [OffRentQty]\n\t  --CalledOff\n\t  , CASE WHEN ITF.Asset=1 AND ITF.[QYOT]>1 AND ItemQty.[OnRent]>0 THEN 0\n\t\tWHEN ITF.Asset=1 AND ITF.[QYOT]>1 AND ItemQty.OffRentCalledOffQty>0 THEN 1\n\t\tELSE ItemQty.OffRentCalledOffQty END AS [CalledOffRentQty]\n\t  --PickUp\n\t  , CASE WHEN ITF.Asset=1 AND ITF.[QYOT]>1 AND ItemQty.[OnRent]>0 THEN 0\n\t\tWHEN ITF.Asset=1 AND ITF.[QYOT]>1 AND ItemQty.OffRentPickUpQty>0 THEN 1\n\t\tELSE ItemQty.OffRentPickUpQty END AS [PickUpOffRentQty]\n\t  --IRO\n\t  , CASE WHEN ITF.Asset=1 AND ITF.[QYOT]>1 AND ItemQty.[OnRent]=0 AND ItemQty.[OffRent]=0 THEN 1\n\t\tWHEN ITF.Asset=1 AND ITF.[QYOT]>1 AND (ItemQty.[OnRent]=1 OR ItemQty.[OffRent]=1) THEN 0\n\t\tELSE ItemQty.[IRO] END AS [IROQty]\n      , ItemQty.[IMO] AS [IMOQty]\n      , ItemQty.[ISO] AS [ISOQty]\n\t  , ItemQty.OffRentCalledOffQty\n\t  , ItemQty.OffRentPickUpQty\n      , ITF.[CNTR] AS ItemCntr\n      , ITF.[PURP] AS ItemPurp\n\t  , ITF.[HomeStore]\n      , ITF.[CurrentStore]\n\t  , PF.[STORE_NAME] AS CurrentStoreName      \n      , ITF.[Header] AS ItemHeader\n      , ITF.[ReplacementCost] AS ItemReplaceCost\n      , ITF.[BulkItem]\n      , ITF.[Inactive]\n\t  , ITF.BoughtUsed\n      , ITF_h.[KEY] AS HeaderKey\n      , ITF_h.[Name] AS HeaderName\n      , ITF_h.[Num] AS HeaderNum\n      , ITF_h.[ReplacementCost] AS HeaderReplaceCost\n      , ITF.[Category] AS CategoryNumber\n      , ITC.[Name] AS CategoryName\n      , ITF_OEC.OEC AS OEC\n      --, GETDATE() \n\t  ,switchoffset(sysdatetimeoffset(),'-05:00') AS [Snapshot_Date]\n\nFROM (((((POR.dbo.ItemFile ITF\n    LEFT JOIN POR.dbo.ItemFile AS ITF_h ON ITF.[Header] = ITF_h.[KEY])\n    LEFT JOIN POR.dbo.ParameterFile PF ON ITF.[CurrentStore] = PF.[Store])\n    LEFT JOIN POR.dbo.ItemCategory ITC ON ITF.[Category] = ITC.[Category])\n    LEFT JOIN POR.dbo.ItemDivision ITD ON ITC.[DivisionNumber] = ITD.[DivisionNumber])\n    LEFT JOIN (SELECT TI.[ITEM],\n\n                      SUM(IIF(LEFT(TI.[CNTR],1)<>'r' AND (NOT(TI.[TXTY] IN ('RR','RX','RH')) OR (TI.txty = 'RH' AND TI.DDT > GETDATE())) ,[TI].[Qty],0)) AS OnRent,\n                      SUM(IIF(LEFT(TI.[CNTR],1)<>'r' AND TI.[TXTY] = 'RH' AND TI.[DDT] <= GETDATE(),[TI].[Qty],0)) AS OffRent,\n\t\t\t\t\t  SUM(IIF(LEFT(TI.[CNTR],1)<>'r' AND TI.[TXTY] = 'RH' AND TI.[DDT] <= GETDATE() AND T.Pickup=0,[TI].[Qty],0)) AS OffRentCalledOffQty,\n\t\t\t\t\t  SUM(IIF(LEFT(TI.[CNTR],1)<>'r' AND TI.[TXTY] = 'RH' AND TI.[DDT] <= GETDATE() AND T.Pickup=1,[TI].[Qty],0)) AS OffRentPickUpQty,\n                      SUM(IIF(LEFT(TI.[CNTR],1)='r' AND NOT(TI.[TXTY] IN ('RR','RX')),[TI].[Qty],0)) AS IRO,\n                      SUM(IIF(LEFT(TI.[CNTR],1)='r' AND TI.[TXTY] IN ('RR','RX'),[TI].[Qty],0)) AS IMO,\n                      SUM(IIF(cf.[KEY] LIKE 'REPAIRS-SERV%' AND TI.SUBF = 1,TI.Qty,0)) AS ISO\n               FROM ((POR.dbo.TransactionItems TI\n                      INNER JOIN POR.dbo.Transactions T ON TI.[CNTR] = T.[CNTR])\n                      INNER JOIN POR.dbo.ItemFile ITF ON TI.[Item] = ITF.[Num])\n                      INNER JOIN POR.dbo.CustomerFile CF ON T.[CUSN] = CF.[CNUM]\n               WHERE LEFT(TI.[CNTR],1) <> 'c' AND\n                     LEFT(TI.[CNTR],1) <> 'f' AND\n                     LEFT(TI.[CNTR],1) <> 'l' AND\n                     LEFT(TI.[CNTR],1) <> 'q' AND\n                     LEFT(TI.[CNTR],1) <> 't' AND\n                     LEFT(TI.[CNTR],1) <> 'w' AND\n                     LEFT(TI.[TXTY],1) = 'R' AND\n                     LEFT(T.[STAT],1) = 'O' AND\n                     ITF.Qty < 99000\n               GROUP BY TI.[Item]\n                      ) AS ItemQty ON ITF.[Num] = ItemQty.[Item])\n\t\t\t\t\t  \n    LEFT JOIN (SELECT [ItemNumber] ,SUM(([QuantityPurchased] - [QuantitySold]) * ([PriceEach] + [ExtraCharges])) AS OEC\n               FROM POR.dbo.[ItemPurchaseDetail]\n               WHERE [Disposed] = 0\n               GROUP BY [ItemNumber]) AS ITF_OEC ON ITF.[NUM] = ITF_OEC.[ItemNumber]\nWHERE\n   ITF.[Type] <> 'b' AND\n   ITF.[Type] <> 'e' AND\n   ITF.[Type] <> 'f' AND\n   ITF.[Type] <> 'i' AND\n   ITF.[Type] <> 'k' AND\n   ITF.[Type] <> 'm' AND\n   ITF.[Type] <> 'n' AND\n   ITF.[Type] <> 'o' AND\n   ITF.[Type] <> 'p' AND\n   ITF.[Type] <> 's' AND\n   ITF.[Type] <> 'v' AND\n   ITF.[Type] <> 'w' AND\n   ITF.Qty < 90000\n   AND ITF.Inactive = 0 AND ITF.BulkItem = 0\n\t  ) a\nGROUP BY\n  a.ItemKey\n, a.ItemNum\n, a.ItemName\n, a.ItemType\n, a.Asset\n, a.ItemQty\n, a.QtyOut\n, a.OnRentQty\n, a.OffRentQty\n, a.CalledOffRentQty\n, a.PickUpOffRentQty\n, a.IROQty\n, a.IMOQty\n, a.ISOQty\n, IIF(a.ItemQty - (a.OnRentQty + a.OffRentQty + a.IROQty) IS NULL, a.ItemQty, a.ItemQty - (a.OnRentQty + a.OffRentQty + a.IROQty))\n, a.ItemCntr\n, a.ItemPurp\n, a.HomeStore\n, a.CurrentStore\n, a.CurrentStoreName\n, a.ItemHeader\n, a.ItemReplaceCost\n, a.BulkItem\n, a.Inactive\n, a.BoughtUsed\n, a.HeaderKey\n, a.HeaderName\n, a.HeaderNum\n, a.HeaderReplaceCost\n, a.CategoryNumber\n, a.CategoryName\n, a.OEC\n, a.Snapshot_Date;",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "delete from [POR].[Executive_Dashboard_Stage_Summary] where snapshot_date = cast(switchoffset(sysdatetimeoffset(),'-05:00') as date);",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"tableOption": "autoCreate",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "ItemKey",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemKey",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemNum",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemNum",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemType",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemType",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Asset",
											"type": "Boolean",
											"physicalType": "bit"
										},
										"sink": {
											"name": "Asset",
											"type": "Boolean",
											"physicalType": "bit"
										}
									},
									{
										"source": {
											"name": "ItemQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "ItemQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "QtyOut",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "QtyOut",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "OnRentQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "OnRentQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "OffRentQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "OffRentQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "CalledOffRentQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "CalledOffRentQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "PickUpOffRentQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "PickUpOffRentQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "IROQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "IROQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "IMOQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "IMOQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "ISOQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "ISOQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "AvailableQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "AvailableQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "ItemCntr",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemCntr",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemPurp",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "ItemPurp",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "HomeStore",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "HomeStore",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CurrentStore",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CurrentStore",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CurrentStoreName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CurrentStoreName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemHeader",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemHeader",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemReplaceCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "ItemReplaceCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "BulkItem",
											"type": "Boolean",
											"physicalType": "bit"
										},
										"sink": {
											"name": "BulkItem",
											"type": "Boolean",
											"physicalType": "bit"
										}
									},
									{
										"source": {
											"name": "Inactive",
											"type": "Boolean",
											"physicalType": "bit"
										},
										"sink": {
											"name": "Inactive",
											"type": "Boolean",
											"physicalType": "bit"
										}
									},
									{
										"source": {
											"name": "BoughtUsed",
											"type": "Boolean",
											"physicalType": "bit"
										},
										"sink": {
											"name": "BoughtUsed",
											"type": "Boolean",
											"physicalType": "bit"
										}
									},
									{
										"source": {
											"name": "HeaderKey",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "HeaderKey",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "HeaderName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "HeaderName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "HeaderNum",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "HeaderNum",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "HeaderReplaceCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "HeaderReplaceCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "CategoryNumber",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "CategoryNumber",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "CategoryName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CategoryName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "OEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "OEC",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "TotalOEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "TotalOEC",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "TotalOnRentOEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "TotalOnRentOEC",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "TotalOffRentOEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "TotalOffRentOEC",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "TotalOffRentOECCalledOff",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "TotalOffRentOECCalledOff",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "TotalOffRentOECPickUp",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "TotalOffRentOECPickUp",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "TotalInspectOEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "TotalInspectOEC",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "TotalNotAvailableOEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "TotalNotAvailableOEC",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "TotalAvailableOEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "TotalAvailableOEC",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "TotalInRepairOEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "TotalInRepairOEC",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Snapshot_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Snapshot_Date",
											"type": "DateTime",
											"physicalType": "date"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "POR_Dataset",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Executive_Dashboard_Stage_Summary"
								}
							}
						]
					},
					{
						"name": "EXECUTIVE_DASHBOARD_STAGE_TRANSACTIONDETAILS",
						"description": "clean transaction details",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "EXECUTIVE_DASHBOARD_STAGE_SUMMARY",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "SELECT t.CNTR, t.STAT AS CNTRStatus, FORMAT(t.[DATE],N'yyyy-MM-dd HH:mm') AS CNTRStartDate, FORMAT(t1.OriginalContractDate,N'yyyy-MM-dd HH:mm') AS OriginalCNTRStartDate--, FORMAT(t.CLDT,N'yyyy-MM-dd HH:mm') AS CNTRClosedDate_delete\n, CASE WHEN t.CONT = '' THEN FORMAT(t.CLDT,N'yyyy-MM-dd HH:mm') WHEN t.CLDT IS NULL THEN NULL ELSE FORMAT(ti.DDT,N'yyyy-MM-dd HH:mm') END AS CNTRClosedDate\n, FORMAT(t.DeliveryDate,N'yyyy-MM-dd HH:mm') AS DeliveryDate_sys, FORMAT(t.PickupDate,N'yyyy-MM-dd HH:mm') AS ScheduledPickupDate_sys, FORMAT(ti.DDT,N'yyyy-MM-dd HH:mm') AS [EstItemDueDate_sysDDT] \n, FORMAT(t.Billed,N'yyyy-MM-dd HH:mm') AS InvoiceDate_sys\n\n, IIF(ISDATE(CASE WHEN ti.Comments LIKE '%Called Off #%on%' THEN SUBSTRING(LTRIM(SUBSTRING(RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy')))), CHARINDEX('on ',RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy'))))) + 3, LEN(RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy'))))))),0,CHARINDEX(' ',LTRIM(SUBSTRING(RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy')))), CHARINDEX('on ',RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy'))))) + 3, LEN(RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy'))))))))) ELSE NULL END)=1,CASE WHEN ti.Comments LIKE '%Called Off #%on%' THEN SUBSTRING(LTRIM(SUBSTRING(RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy')))), CHARINDEX('on ',RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy'))))) + 3, LEN(RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy'))))))),0,CHARINDEX(' ',LTRIM(SUBSTRING(RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy')))), CHARINDEX('on ',RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy'))))) + 3, LEN(RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy'))))))))) ELSE NULL END,NULL) AS CalledOffOnDate\n, IIF(ISDATE(CASE WHEN ti.Comments LIKE '%Called Off #%for%' THEN \nRTRIM(SUBSTRING(LTRIM(SUBSTRING(RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy')))), CHARINDEX('for ',RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy'))))) + 3, LEN(RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy'))))))),0,PATINDEX('%/[0-9][0-9][0-9][0-9]%',LTRIM(SUBSTRING(RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy')))), CHARINDEX('for ',RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy'))))) + 3, LEN(RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy'))))))))+5))\nELSE NULL END)=1,CASE WHEN ti.Comments LIKE '%Called Off #%for%' THEN \nRTRIM(SUBSTRING(LTRIM(SUBSTRING(RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy')))), CHARINDEX('for ',RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy'))))) + 3, LEN(RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy'))))))),0,PATINDEX('%/[0-9][0-9][0-9][0-9]%',LTRIM(SUBSTRING(RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy')))), CHARINDEX('for ',RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy'))))) + 3, LEN(RIGHT(REPLACE(ti.Comments,'PO#','yyy'),CHARINDEX('#',REVERSE(REPLACE(ti.Comments,'PO#','yyy'))))))))+5))\nELSE NULL END,NULL) AS CalledOffForDate\n\n, IIF(ti.TXTY = 'RH' AND ti.[DDT] <= GETDATE() AND t.Pickup = 0, 1, 0) AS IsInCalledOffStatus\n, IIF(ti.TXTY = 'RH' AND TI.[DDT] <= GETDATE() AND t.Pickup = 1, 1, 0) AS IsInPickupStatus\n\n, IIF(t.CONT = '', 0,1) AS IsCycleBill\n, IIF(LEFT(t.STAT,1)='O',1,0) IsOpenStatusCNTR\n, IIF(LEFT(t.STAT,1)='C' OR (LEFT(t.STAT,1)<>'O' AND t.CLDT IS NOT NULL),1,0) AS IsClosedCNTR\n, IIF(LEFT(ti.TXTY,1)='R',1,0) AS IsRentalItems\n, IIF(ISNUMERIC(LEFT(t.CNTR,1))=1,1,0) AS IsNonPrefixedCNTR\n, IIF(ti.ITEM IS NULL,1,0) AS IsItemlessCNTR\n\n, t.[STR] AS Branch, pf.STORE_NAME AS StoreName\n, ti.Comments\n, ti.TXTY, ifi.[TYPE]\n, ic.Category AS CategoryNumber\n, ic.[Name] AS Category\n, ifi.Header\n, ifi.[KEY]\n, ifi.NUM\n, ifi.[Name]\n, ti.[Desc]\n, ifi.SerialNumber AS SerialNumber\n, ifi.MANF AS Make\n, ifi.MODN AS Model\n, ifi.Modelyear AS ModelYear\n, ifi.QTY AS ItemQty\n, ti.QTY AS CNTRQty\n, ti.PRIC AS AmountCharged\n, ti.DiscountAmount\n, t.DMG AS ExtendedProtectionPlan\n, ti.DailyAmount\n, ifi.RATE1 AS BookRateDaily\n, ti.WeeklyAmount\n, ifi.RATE2 AS BookRateWeekly\n, ti.MonthlyAmount\n, ifi.RATE3 AS BookRateMonthly\n, ifi.PURP AS [SP_PURP]\n, ifi.ExtraCharges AS SP_ExtraCharges\n, oec.OEC\n, oec.[BriggsPURP_PlusExtraCharges]\n, ifi.BulkItem AS IsBulkItem\n, ifi.Inactive AS IsInactive\n, ifi.Asset AS IsAsset\n, IIF((ifi.[TYPE] NOT IN ('b','e','f','i','k','m','n','o','p','s','v','w') AND (ifi.Inactive=0 AND ifi.BulkItem=0 AND ifi.QTY<90000)),1,0) AS IsMatchSummaryTableItems --Match Executive_Dashboard_Stage_Summary items\n, CASE WHEN ti.Substatus = 7 THEN 1 ELSE 0 END AS IsSubstitute\n, t.Delvr AS IsDeliveryRequired\n, cf.APILink AS NSCustomerNumber\n, cf.[CNUM] AS CustomerNumber\n, cf.[Name] AS CustomerName\n, CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END AS CustomerType\n, pm.PayType\n, t.JOBN\n, t.JBPO\n, t.JBID\n, cjs.[Description] AS JobSiteName\n, t.DeliverToCompany\n, COALESCE(NULLIF(cjs.SiteAddress,''), NULLIF(t.DeliveryAddress,''), NULLIF(pf.STORE_STRT,'')) AS DeliveryStreetAddress\n, COALESCE(NULLIF(LEFT(cjs.SiteCity, CHARINDEX(',',cjs.SiteCity + ',', 1) -1),''),NULLIF(LEFT(t.DeliveryCity, CHARINDEX(',',t.DeliveryCity + ',', 1) -1),''), NULLIF(LEFT(pf.STORE_CITY, CHARINDEX(',',pf.STORE_CITY + ',', 1) -1),'')) AS DeliveryCity\n, COALESCE(LEFT(TRIM(NULLIF(RIGHT(cjs.SiteCity, NULLIF(CHARINDEX(',',REVERSE(cjs.SiteCity)),'') -1),'')),2),LEFT(TRIM(NULLIF(RIGHT(t.DeliveryCity, NULLIF(CHARINDEX(',',REVERSE(t.DeliveryCity)),'') -1),'')),2) , LEFT(TRIM(NULLIF(RIGHT(pf.STORE_CITY, NULLIF(CHARINDEX(',',REVERSE(pf.STORE_CITY)),'') -1),'')),2)) AS DeliveryState\n, COALESCE(NULLIF(cjs.SiteZip,''), NULLIF(t.DeliveryZip,''), NULLIF(pf.STORE_ZIP,'')) AS DeliveryPostalCode\n, t.ContactPhone\n, s.[Name] AS ContractSalesRep\n, s2.[Name] AS CustomerSalesRep\n, o.OPNM AS CreatedOperatorName\n, o2.OPNM AS AssignedOperatorName\n, CAST(GETDATE() AS DATE) AS LastLoadDate\nFROM POR.dbo.Transactions t\nJOIN (SELECT t0.CNTR, t0.[DATE] AS OriginalContractDate FROM POR.dbo.Transactions t0 WHERE RIGHT(t0.CNTR,1) NOT LIKE '[A-Za-z]%') t1\nON t1.CNTR = CASE WHEN RIGHT(t.CNTR,1) LIKE '[A-Za-z]%' THEN LEFT(t.CNTR, LEN(t.CNTR)-1) ELSE t.CNTR END\nLEFT JOIN POR.dbo.TransactionItems ti ON ti.CNTR = t.CNTR\nLEFT JOIN POR.dbo.ItemFile ifi ON ifi.NUM = ti.ITEM\nLEFT JOIN POR.dbo.ItemCategory ic ON ic.Category = ifi.Category\nLEFT JOIN POR.dbo.CustomerJobSite cjs ON cjs.Number = t.JobSite\nLEFT JOIN POR.dbo.ParameterFile pf ON pf.Store = t.[STR]\nLEFT JOIN POR.dbo.PaymentMethod pm ON pm.PayMeth = t.PYMT\nLEFT JOIN (SELECT ipd.ItemNumber ,sum((ipd.QuantityPurchased - ipd.QuantitySold) * (ipd.PriceEach + ipd.ExtraCharges)) AS OEC, SUM(ipd.PriceEach + ipd.ExtraCharges) AS [BriggsPURP_PlusExtraCharges]\n\t\t\tFROM POR.dbo.ItemPurchaseDetail ipd\n\t\t\tWHERE ipd.Disposed = 0\n\t\t\tGROUP BY ipd.ItemNumber) AS oec ON ifi.[NUM] = oec.ItemNumber\nLEFT JOIN POR.dbo.CustomerFile cf ON cf.CNUM = t.CUSN\nLEFT JOIN POR.dbo.Salesman s ON s.Number = t.Salesman\nLEFT JOIN POR.dbo.Salesman s2 ON s2.Number = cf.Salesman -- Example CNTR 103071 See GUI. Trans SM is Misha Tufkova, but Customer assigned SM is Daniel Lee\nLEFT JOIN POR.dbo.OperatorId o ON o.OPNO = t.OperatorCreated\nLEFT JOIN POR.dbo.OperatorId o2 ON o2.OPNO = t.OperatorAssigned;",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table [POR].[Executive_Dashboard_Stage_TransactionDetails];",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"enableSkipIncompatibleRow": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "CNTR",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CNTR",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CNTRStatus",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CNTRStatus",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CNTRStartDate",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CNTRStartDate",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "OriginalCNTRStartDate",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "OriginalCNTRStartDate",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CNTRClosedDate",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CNTRClosedDate",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "DeliveryDate_sys",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "DeliveryDate_sys",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ScheduledPickupDate_sys",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ScheduledPickupDate_sys",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "EstItemDueDate_sysDDT",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "EstItemDueDate_sysDDT",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "InvoiceDate_sys",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "InvoiceDate_sys",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CalledOffOnDate",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CalledOffOnDate",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CalledOffForDate",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CalledOffForDate",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "IsInCalledOffStatus",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IsInCalledOffStatus",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IsInPickupStatus",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IsInPickupStatus",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IsCycleBill",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IsCycleBill",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IsOpenStatusCNTR",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IsOpenStatusCNTR",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IsClosedCNTR",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IsClosedCNTR",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IsRentalItems",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IsRentalItems",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IsNonPrefixedCNTR",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IsNonPrefixedCNTR",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IsItemlessCNTR",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IsItemlessCNTR",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Branch",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Branch",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "StoreName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "StoreName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Comments",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Comments",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "TYPE",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "TYPE",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CategoryNumber",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "CategoryNumber",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Category",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Category",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "KEY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "KEY",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "NUM",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "NUM",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "NAME",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Desc",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "DESC",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "SerialNumber",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "SerialNumber",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ModelYear",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ModelYear",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "ItemQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "CNTRQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "CNTRQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "AmountCharged",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "AmountCharged",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "DiscountAmount",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "DiscountAmount",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "ExtendedProtectionPlan",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "ExtendedProtectionPlan",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "DailyAmount",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "DailyAmount",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "BookRateDaily",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "BookRateDaily",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "WeeklyAmount",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "WeeklyAmount",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "BookRateWeekly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "BookRateWeekly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "MonthlyAmount",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "MonthlyAmount",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "BookRateMonthly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "BookRateMonthly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "SP_PURP",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "SP_PURP",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "SP_ExtraCharges",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "SP_ExtraCharges",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "OEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "OEC",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "BriggsPURP_PlusExtraCharges",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "BriggsPURP_PlusExtraCharges",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "IsBulkItem",
											"type": "Boolean",
											"physicalType": "bit"
										},
										"sink": {
											"name": "IsBulkItem",
											"type": "Boolean",
											"physicalType": "bit"
										}
									},
									{
										"source": {
											"name": "IsInactive",
											"type": "Boolean",
											"physicalType": "bit"
										},
										"sink": {
											"name": "IsInactive",
											"type": "Boolean",
											"physicalType": "bit"
										}
									},
									{
										"source": {
											"name": "IsAsset",
											"type": "Boolean",
											"physicalType": "bit"
										},
										"sink": {
											"name": "IsAsset",
											"type": "Boolean",
											"physicalType": "bit"
										}
									},
									{
										"source": {
											"name": "IsMatchSummaryTableItems",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IsMatchSummaryTableItems",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IsSubstitute",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IsSubstitute",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IsDeliveryRequired",
											"type": "Boolean",
											"physicalType": "bit"
										},
										"sink": {
											"name": "IsDeliveryRequired",
											"type": "Boolean",
											"physicalType": "bit"
										}
									},
									{
										"source": {
											"name": "NSCustomerNumber",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "NSCustomerNumber",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CustomerNumber",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CustomerNumber",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CustomerName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CustomerName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "PayType",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PayType",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "JOBN",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "JOBN",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "JBPO",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "JBPO",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "JBID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "JBID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "JobSiteName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "JobSiteName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "DeliverToCompany",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "DeliverToCompany",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "DeliveryStreetAddress",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "DeliveryStreetAddress",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "DeliveryCity",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "DeliveryCity",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "DeliveryState",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "DeliveryState",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "DeliveryPostalCode",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "DeliveryPostalCode",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ContactPhone",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ContactPhone",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ContractSalesRep",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ContractSalesRep",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CustomerSalesRep",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CustomerSalesRep",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CreatedOperatorName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CreatedOperatorName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "AssignedOperatorName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "AssignedOperatorName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "LastLoadDate",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "LastLoadDate",
											"type": "DateTime",
											"physicalType": "date"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "POR_Dataset",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Executive_Dashboard_Stage_TransactionDetails"
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "To be Deleted"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-22T14:42:25Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/POR_Dataset')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Rouse_asset_pricing')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "GetData",
						"description": "ping sftp, get data",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"additionalColumns": [
									{
										"name": "ImportDate",
										"value": {
											"value": "@formatDateTime(subtractFromTime(utcNow(),5,'Hour'),'yyyy-MM-dd HH:mm:ss')",
											"type": "Expression"
										}
									}
								],
								"storeSettings": {
									"type": "SftpReadSettings",
									"recursive": false,
									"enablePartitionDiscovery": false,
									"disableChunking": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table POR.RouseAssetPricing_staging;",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "EquipmentNumber",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "EquipmentNumber",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Branch",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "Branch",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "BranchName",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "BranchName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ListPrice",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "ListPrice",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Make",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Year",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "Year",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CatClass",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "CatClass",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "SerialNum",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "SerialNum",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "NBV",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "NBV",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "GP",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "GP",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "GPPercent",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "GPPercent",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "FMV",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "FMV",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "OLV",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "OLV",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "FLV",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "FLV",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "BottomQuartile",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "BottomQuartile",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "TopQuartile",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "TopQuartile",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ImportDate",
											"type": "String"
										},
										"sink": {
											"name": "ImportDate",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "RouseFileFeed",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "RouseAssetPricing_staging"
								}
							}
						]
					},
					{
						"name": "ExecuteSP",
						"description": "execute:  [POR].[Load_RouseAssetPricing]",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "GetData",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[POR].[Load_RouseAssetPricing]"
						},
						"linkedServiceName": {
							"referenceName": "briggs-b-wus-syn-01-WorkspaceDefaultSqlServer",
							"type": "LinkedServiceReference",
							"parameters": {
								"DBName": "briggsbetamdw"
							}
						}
					},
					{
						"name": "EmailFailure_SFTP",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "GetData",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": "https://prod-24.centralus.logic.azure.com:443/workflows/ce605247ec3d441aa49633355f8cfd9a/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=4u7EFMoueVGeSUWsCQdMuUhNkpMSirU6tk7w8wDfS-Y",
							"connectVia": {
								"referenceName": "AutoResolveIntegrationRuntime",
								"type": "IntegrationRuntimeReference"
							},
							"method": "POST",
							"headers": {
								"content-type": "application/json"
							},
							"body": {
								"value": "{\n    \"Pipeline\":\"@{pipeline().Pipeline}\",\n    \"DataFactoryName\" : \"@{pipeline().DataFactory}\",\n    \"ActivityType\" : \"@{activity('GetData').ActivityType}\",\n    \"Runid\" : \"@{pipeline().RunId}\"\n}",
								"type": "Expression"
							}
						}
					},
					{
						"name": "EmailFailure_Internal",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "ExecuteSP",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": "https://prod-24.centralus.logic.azure.com:443/workflows/ce605247ec3d441aa49633355f8cfd9a/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=4u7EFMoueVGeSUWsCQdMuUhNkpMSirU6tk7w8wDfS-Y",
							"connectVia": {
								"referenceName": "AutoResolveIntegrationRuntime",
								"type": "IntegrationRuntimeReference"
							},
							"method": "POST",
							"headers": {
								"content-type": "application/json"
							},
							"body": {
								"value": "{\n    \"Pipeline\":\"@{pipeline().Pipeline}\",\n    \"DataFactoryName\" : \"@{pipeline().DataFactory}\",\n    \"ActivityType\" : \"@{activity('ExecuteSP').ActivityType}\",\n    \"Runid\" : \"@{pipeline().RunId}\"\n}",
								"type": "Expression"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "Other Vendors"
				},
				"annotations": [],
				"lastPublishTime": "2022-08-19T19:13:50Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/RouseFileFeed')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/briggs-b-wus-syn-01-WorkspaceDefaultSqlServer')]",
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Rouse_asset_pricing_copy')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "GetData",
						"description": "ping sftp, get data",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "DelimitedTextSource",
								"additionalColumns": [
									{
										"name": "ImportDate",
										"value": {
											"value": "@formatDateTime(subtractFromTime(utcNow(),5,'Hour'),'yyyy-MM-dd HH:mm:ss')",
											"type": "Expression"
										}
									}
								],
								"storeSettings": {
									"type": "SftpReadSettings",
									"recursive": false,
									"enablePartitionDiscovery": false,
									"disableChunking": false
								},
								"formatSettings": {
									"type": "DelimitedTextReadSettings"
								}
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table POR.RouseAssetPricing_staging;",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "EquipmentNumber",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "EquipmentNumber",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Branch",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "Branch",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "BranchName",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "BranchName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ListPrice",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "ListPrice",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Make",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Year",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "Year",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CatClass",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "CatClass",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "SerialNum",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "SerialNum",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "NBV",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "NBV",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "GP",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "GP",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "GPPercent",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "GPPercent",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "FMV",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "FMV",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "OLV",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "OLV",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "FLV",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "FLV",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "BottomQuartile",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "BottomQuartile",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "TopQuartile",
											"type": "String",
											"physicalType": "String"
										},
										"sink": {
											"name": "TopQuartile",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ImportDate",
											"type": "String"
										},
										"sink": {
											"name": "ImportDate",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "RouseFileFeed",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "RouseAssetPricing_staging"
								}
							}
						]
					},
					{
						"name": "ExecuteSP",
						"description": "execute:  [POR].[Load_RouseAssetPricing]",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "GetData",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[POR].[Load_RouseAssetPricing]"
						},
						"linkedServiceName": {
							"referenceName": "briggs-b-wus-syn-01-WorkspaceDefaultSqlServer",
							"type": "LinkedServiceReference",
							"parameters": {
								"DBName": "briggsbetamdw"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "Other Vendors"
				},
				"annotations": [],
				"lastPublishTime": "2022-07-01T13:30:49Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/RouseFileFeed')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/briggs-b-wus-syn-01-WorkspaceDefaultSqlServer')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_SCALE_AZURE_SQL_DW')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Until SQL POOL is Paused or Online",
						"type": "Until",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@or(bool(startswith(activity('Check for changed SQLPool Status').Output.Properties.status,'Paused')),Bool(startswith(activity('Check for changed SQLPool Status').Output.Properties.status,'Online')))",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Check for changed SQLPool Status",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "https://management.azure.com/subscriptions/@{pipeline().parameters.SubscriptionID}/resourceGroups/@{pipeline().parameters.Synapse_ResourceGroupName}/providers/Microsoft.Synapse/workspaces/@{pipeline().parameters.SynapseWorkspace}/sqlPools/@{pipeline().parameters.SynapseDedicatedSQLPool}/?api-version=2019-06-01-preview",
											"type": "Expression"
										},
										"method": "GET",
										"headers": {},
										"authentication": {
											"type": "MSI",
											"resource": "https://management.azure.com/"
										}
									}
								},
								{
									"name": "Wait1",
									"type": "Wait",
									"dependsOn": [
										{
											"activity": "Check for changed SQLPool Status",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"waitTimeInSeconds": {
											"value": "@pipeline().parameters.WaitTimeUntil",
											"type": "Expression"
										}
									}
								}
							],
							"timeout": "0.00:20:00"
						}
					},
					{
						"name": "Check if SQL POOL is Paused",
						"type": "IfCondition",
						"dependsOn": [
							{
								"activity": "Until SQL POOL is Paused or Online",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@bool(startswith(activity('Check for changed SQLPool Status').Output.Properties.status,'Paused'))",
								"type": "Expression"
							},
							"ifTrueActivities": [
								{
									"name": "Web1",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "https://management.azure.com/subscriptions/{pipeline().parameters.SubscriptionID}/resourceGroups/{pipeline().parameters.Synapse_ResourceGroupName}/providers/Microsoft.Synapse/workspaces/{pipeline().parameters.SynapseWorkspace}/sqlPools/{pipeline().parameters.SynapseDedicatedSQLPool}/@{pipeline().parameters.Action}?api-version=2019-06-01-preview",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {},
										"body": "The",
										"authentication": {
											"type": "MSI",
											"resource": "https://management.azure.com/"
										}
									}
								},
								{
									"name": "Wait2",
									"type": "Wait",
									"dependsOn": [
										{
											"activity": "Web1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"waitTimeInSeconds": {
											"value": "@pipeline().parameters.WaitTime",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "Scale SQL Pool",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "Check if SQL POOL is Paused",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "https://management.azure.com/subscriptions/@{pipeline().parameters.SubscriptionID}/resourceGroups/@{pipeline().parameters.Synapse_ResourceGroupName}/providers/Microsoft.Synapse/workspaces/@{pipeline().parameters.SynapseWorkspace}/sqlPools/@{pipeline().parameters.SynapseDedicatedSQLPool}/?api-version=2019-06-01-preview",
								"type": "Expression"
							},
							"method": "PATCH",
							"headers": {
								"Content-Type": "application/json"
							},
							"body": {
								"value": "{\"sku\": { \"name\": '@{pipeline().parameters.PerformanceLevel}' } }",
								"type": "Expression"
							},
							"authentication": {
								"type": "MSI",
								"resource": "https://management.azure.com/"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"Action": {
						"type": "string",
						"defaultValue": "Resume"
					},
					"WaitTime": {
						"type": "int",
						"defaultValue": 10
					},
					"WaitTimeUntil": {
						"type": "int",
						"defaultValue": 30
					},
					"Synapse_ResourceGroupName": {
						"type": "string",
						"defaultValue": "TalendResources"
					},
					"SynapseWorkspace": {
						"type": "string",
						"defaultValue": "briggs-p-wus-syn-01"
					},
					"SynapseDedicatedSQLPool": {
						"type": "string",
						"defaultValue": "briggsmdw"
					},
					"SubscriptionID": {
						"type": "string",
						"defaultValue": "92e01a22-48f8-44af-9e12-81a013ff7882"
					},
					"PerformanceLevel": {
						"type": "string",
						"defaultValue": "DW500c"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-09T05:21:58Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Pipeline 1')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "POR_Copy To_DataLake",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID2,sourceDB,SourcetableName From dbo.control_table_por Where ProcessName = 'AzSQL_ADLS'  and sourcedb='POR'\nand EnableAction = 1   order by ID",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_POR_CopyToDataLake",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "POR_Copy To_DataLake",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('POR_Copy To_DataLake').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_POR_copyToDataLake",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,targetstagetableschema,targetstagetablename\nfrom dbo.control_table_por\nwhere ID= ',item().ID2)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_POR_ADLS_CopyTo_DataLake",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Lookup_POR_copyToDataLake",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_POR_copyToDataLake').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "ParquetSink",
											"storeSettings": {
												"type": "AzureBlobStorageWriteSettings"
											},
											"formatSettings": {
												"type": "ParquetWriteSettings"
											}
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "POR_Dataset",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Parquet1",
											"type": "DatasetReference",
											"parameters": {
												"ContainerName": {
													"value": "@activity('Lookup_POR_copyToDataLake').output.firstRow.TargetContainer",
													"type": "Expression"
												},
												"Path": {
													"value": "@activity('Lookup_POR_copyToDataLake').output.firstRow.TargetPath",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(activity('Lookup_POR_copyToDataLake').output.firstRow.TargetFile,'.',activity('Lookup_POR_copyToDataLake').output.firstRow.FileFormat)",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "To be Deleted"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-23T10:25:14Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/datasets/POR_Dataset')]",
				"[concat(variables('workspaceId'), '/datasets/Parquet1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Prashant')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Wait1",
						"type": "Wait",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"waitTimeInSeconds": 10
						}
					},
					{
						"name": "Wait2",
						"type": "Wait",
						"dependsOn": [
							{
								"activity": "Wait1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"waitTimeInSeconds": 1
						}
					},
					{
						"name": "Validation1",
						"type": "Validation",
						"dependsOn": [
							{
								"activity": "Wait2",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"dataset": {
								"referenceName": "RouseFileFeed",
								"type": "DatasetReference",
								"parameters": {}
							},
							"timeout": "0.12:00:00",
							"sleep": 10
						}
					},
					{
						"name": "Wait3",
						"type": "Wait",
						"dependsOn": [
							{
								"activity": "Validation1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"waitTimeInSeconds": 2
						}
					},
					{
						"name": "Wait4",
						"type": "Wait",
						"dependsOn": [
							{
								"activity": "Wait3",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"waitTimeInSeconds": 2
						}
					},
					{
						"name": "Wait5",
						"type": "Wait",
						"dependsOn": [
							{
								"activity": "Wait1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"waitTimeInSeconds": 1
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/RouseFileFeed')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ResumeDB')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Resume_SQL_Pool",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "https://management.azure.com/subscriptions/@{pipeline().parameters.SubscriptionID}/resourceGroups/@{pipeline().parameters.Synapse_ResourceGroupName}/providers/Microsoft.Synapse/workspaces/@{pipeline().parameters.SynapseWorkspace}/sqlPools/@{pipeline().parameters.SynapseDedicatedSQLPool}/@{pipeline().parameters.Action}?api-version=2019-06-01-preview",
								"type": "Expression"
							},
							"connectVia": {
								"referenceName": "AutoResolveIntegrationRuntime",
								"type": "IntegrationRuntimeReference"
							},
							"method": "POST",
							"headers": {},
							"body": "The",
							"authentication": {
								"type": "MSI",
								"resource": "https://management.azure.com/"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"Action": {
						"type": "string",
						"defaultValue": "Resume"
					},
					"SynapseWorkspace": {
						"type": "string",
						"defaultValue": "briggs-b-wus-syn-01"
					},
					"Synapse_ResourceGroupName": {
						"type": "string",
						"defaultValue": "TalendResources"
					},
					"SynapseDedicatedSQLPool": {
						"type": "string",
						"defaultValue": "briggsbetamdw"
					},
					"SubscriptionID": {
						"type": "string",
						"defaultValue": "92e01a22-48f8-44af-9e12-81a013ff7882"
					}
				},
				"annotations": [],
				"lastPublishTime": "2022-06-08T05:30:16Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RingCentral')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "GetBearerToken",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": "https://platform.devtest.ringcentral.com/restapi/oauth/token",
							"connectVia": {
								"referenceName": "AutoResolveIntegrationRuntime",
								"type": "IntegrationRuntimeReference"
							},
							"method": "POST",
							"headers": {
								"Content-type": "application/x-www-form-urlencoded",
								"Authorization": "Basic Smg4cHEwRTJRdS1DRWEwLTJyLXg5dzotSU9zSWJMNFJ5V3FBdzdGNHVjMlRnZkdMQzQ4UkdRUTZQZ0tUbTZMUlRnQQ=="
							},
							"body": {
								"value": "@concat('grant_type=password&username=+19294592133&password=','2kH%5CCd%25%3FupAfrL%24')\n",
								"type": "Expression"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "annie"
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Salesforce')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "ToSalesforce_copy1",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "SELECT\n  e.entityid\n, e.altname AS AccountName\n, CASE WHEN es.entitytype IS NULL THEN NULL WHEN es.entitytype = 'LEAD' THEN 'Other' ELSE UPPER(LEFT(es.entitytype,1)) + LOWER(SUBSTRING(es.entitytype,2,LEN(es.entitytype))) END AS [Type]\n, e.email AS CustomerEmailAddress\n, c.CreditLimit AS CreditLimit\n, te.[name] AS CreditTerms\n, CASE WHEN c.custentity_por_payment_method = 3 THEN 'Account' WHEN c.custentity_por_payment_method IS NOT NULL THEN 'Cash' ELSE NULL END AS PaymentMethod\n, a.OpenBalance\n, e.Phone\n, REPLACE(REPLACE(RTRIM(CONCAT(LTRIM(RTRIM(ea.addr1)), ' ', LTRIM(RTRIM(ea.addr2)), ' ', LTRIM(RTRIM(ea.addr3)))), '  ', ' '),'  ', ' ') AS BillingStreet\n, ea.city AS BillingCity\n, ea.[state] AS BillingState\n, ea.zip AS BillingPostalCode\nFROM Netsuite.Entity e\nJOIN Netsuite.Customer c ON c.entityid = e.entityid\nJOIN Netsuite.EntityStatus es ON es.[key] = c.entitystatus\nLEFT JOIN Netsuite.term te ON te.id = c.terms\nLEFT JOIN Netsuite.EntityAddress ea ON ea.nkey = c.defaultbillingaddress\nLEFT JOIN (\n\tSELECT t.entity, CAST(SUM(ISNULL(tal.AmountUnpaid,0) - ISNULL(tal.PaymentAmountUnused,0)) AS DECIMAL(18,2)) AS OpenBalance\n\tFROM Netsuite.[Transaction] t\n\tJOIN Netsuite.TransactionLine tl ON t.id = tl.[transaction]\n\tJOIN Netsuite.TransactionAccountingLine tal ON tal.[transaction] = t.id\n\tWHERE t.posting = 'T'\n\tAND t.voided = 'F'\n\tAND tl.mainline = 'T'\n\tAND (tal.AmountUnpaid <> 0 OR tal.PaymentAmountUnused <> 0)\n\tAND t.abbrevtype IN ('CREDMEM','PMT','SALEINV')\n\tAND ISNULL(DATEDIFF(d,CAST(t.duedate AS DATE),GETDATE()),DATEDIFF(d,CAST(t.trandate AS DATE),GETDATE())) >= 1\n\tGROUP BY t.entity\n) a ON a.entity = e.id\nWHERE LEFT(c.entityid,1) = 'C'",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "SalesforceSink",
								"writeBatchSize": 5000,
								"writeBehavior": "upsert",
								"externalIdFieldName": "NetSuite_Customer_Number__c",
								"ignoreNullValues": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "AccountName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Name",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "Type",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Type",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "BillingStreet",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "BillingStreet",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "BillingCity",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "BillingCity",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "BillingState",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "BillingState",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "BillingPostalCode",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "BillingPostalCode",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "Phone",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Phone",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "entityid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "NetSuite_Customer_Number__c",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "CustomerEmailAddress",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer_Email_Address__c",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "CreditLimit",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "Credit_Limit__c",
											"type": "Decimal"
										}
									},
									{
										"source": {
											"name": "CreditTerms",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Credit_Terms__c",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "PaymentMethod",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Payment_Method__c",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "OpenBalance",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										},
										"sink": {
											"name": "AR_Balance__c",
											"type": "Decimal"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": false,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "SalesforceObject",
								"type": "DatasetReference",
								"parameters": {}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "Salesforce"
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/datasets/SalesforceObject')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/a_test')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Copy data1",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[POR].[Load_RouseAssetPricing]",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "delete from POR.RouseAssetPricing where ImportDate = cast(switchoffset(sysdatetimeoffset(),'-05:00') as date);",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "RouseAssetPricing_staging"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "[POR]",
									"table_name": "[RouseAssetPricing]"
								}
							}
						]
					},
					{
						"name": "Lookup1",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[POR].[Load_RouseAssetPricing]",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "RouseAssetPricing_staging"
								}
							},
							"firstRowOnly": false
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "annie"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-30T17:43:58Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/test')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Load_From_Prod_To_Stage",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "SELECT * FROM [POR].[executive_dashboard_fleet_Summary]",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table [POR].[executive_dashboard_fleet_Summary]",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "Branch",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "branch",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "sort_order",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "sort_order",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Fleets",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "fleets",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "Total",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "total",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "OEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "oec",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "diff",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "diff",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "%off",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "%off",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "-1%",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "-1%",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "-1d$",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "-1d$",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "snapshot_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "snapshot_date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "day",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "day",
											"type": "Int32",
											"physicalType": "int"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "AzureProdDatabase",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "executive_dashboard_fleet_Summary"
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "MDP POR DataLoad_New"
				},
				"annotations": [],
				"lastPublishTime": "2022-08-03T09:27:42Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/AzureProdDatabase')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/testing')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "ToSalesforce_copy1",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "SELECT\n  e.entityid\n, e.altname AS AccountName\n, CASE WHEN es.entitytype IS NULL THEN NULL WHEN es.entitytype = 'LEAD' THEN 'Other' ELSE UPPER(LEFT(es.entitytype,1)) + LOWER(SUBSTRING(es.entitytype,2,LEN(es.entitytype))) END AS [Type]\n, e.email AS CustomerEmailAddress\n, c.CreditLimit AS CreditLimit\n, te.[name] AS CreditTerms\n, CASE WHEN c.custentity_por_payment_method = 3 THEN 'Account' WHEN c.custentity_por_payment_method IS NOT NULL THEN 'Cash' ELSE NULL END AS PaymentMethod\n, a.OpenBalance\n, e.Phone\n, REPLACE(REPLACE(RTRIM(CONCAT(LTRIM(RTRIM(ea.addr1)), ' ', LTRIM(RTRIM(ea.addr2)), ' ', LTRIM(RTRIM(ea.addr3)))), '  ', ' '),'  ', ' ') AS BillingStreet\n, ea.city AS BillingCity\n, ea.[state] AS BillingState\n, ea.zip AS BillingPostalCode\nFROM Netsuite.Entity e\nJOIN Netsuite.Customer c ON c.entityid = e.entityid\nJOIN Netsuite.EntityStatus es ON es.[key] = c.entitystatus\nLEFT JOIN Netsuite.term te ON te.id = c.terms\nLEFT JOIN Netsuite.EntityAddress ea ON ea.nkey = c.defaultbillingaddress\nLEFT JOIN (\n\tSELECT t.entity, CAST(SUM(ISNULL(tal.AmountUnpaid,0) - ISNULL(tal.PaymentAmountUnused,0)) AS DECIMAL(18,2)) AS OpenBalance\n\tFROM Netsuite.[Transaction] t\n\tJOIN Netsuite.TransactionLine tl ON t.id = tl.[transaction]\n\tJOIN Netsuite.TransactionAccountingLine tal ON tal.[transaction] = t.id\n\tWHERE t.posting = 'T'\n\tAND t.voided = 'F'\n\tAND tl.mainline = 'T'\n\tAND (tal.AmountUnpaid <> 0 OR tal.PaymentAmountUnused <> 0)\n\tAND t.abbrevtype IN ('CREDMEM','PMT','SALEINV')\n\tAND ISNULL(DATEDIFF(d,CAST(t.duedate AS DATE),GETDATE()),DATEDIFF(d,CAST(t.trandate AS DATE),GETDATE())) >= 1\n\tGROUP BY t.entity\n) a ON a.entity = e.id\nWHERE LEFT(c.entityid,1) = 'C'",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "SalesforceSink",
								"writeBatchSize": 5000,
								"writeBehavior": "upsert",
								"externalIdFieldName": "NetSuite_Customer_Number__c",
								"ignoreNullValues": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "AccountName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Name",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "Type",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Type",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "BillingStreet",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "BillingStreet",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "BillingCity",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "BillingCity",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "BillingState",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "BillingState",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "BillingPostalCode",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "BillingPostalCode",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "Phone",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Phone",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "entityid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "NetSuite_Customer_Number__c",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "CustomerEmailAddress",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer_Email_Address__c",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "CreditLimit",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "Credit_Limit__c",
											"type": "Decimal"
										}
									},
									{
										"source": {
											"name": "CreditTerms",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Credit_Terms__c",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "PaymentMethod",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Payment_Method__c",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "OpenBalance",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										},
										"sink": {
											"name": "AR_Balance__c",
											"type": "Decimal"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": false,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "SalesforceObject",
								"type": "DatasetReference",
								"parameters": {}
							}
						]
					},
					{
						"name": "ToSalesforce",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "SELECT\n  e.entityid\n, CAST(SUM(ISNULL(tal.AmountUnpaid,0) - ISNULL(tal.PaymentAmountUnused,0)) AS DECIMAL(18,2)) AS OpenBalance\nFROM Netsuite.[Transaction] t\nJOIN Netsuite.TransactionLine tl ON t.id = tl.[transaction]\nJOIN Netsuite.TransactionAccountingLine tal ON tal.[transaction] = t.id\nJOIN Netsuite.Entity e ON e.id = t.entity\nWHERE t.posting = 'T'\nAND t.voided = 'F'\nAND tl.mainline = 'T'\nAND (tal.AmountUnpaid <> 0 OR tal.PaymentAmountUnused <> 0)\nAND t.abbrevtype IN ('CREDMEM','PMT','SALEINV')\nAND LEFT(e.entityid,1) = 'C'\nAND ISNULL(DATEDIFF(d,CAST(t.duedate AS DATE),GETDATE()),DATEDIFF(d,CAST(t.trandate AS DATE),GETDATE())) >= 1\nAND e.entityid = 'C103192'\nGROUP BY e.entityid\nORDER BY e.entityid",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "SalesforceSink",
								"writeBatchSize": 5000,
								"writeBehavior": "upsert",
								"externalIdFieldName": "NetSuite_Customer_Number__c",
								"ignoreNullValues": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "entityid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "NetSuite_Customer_Number__c",
											"type": "String"
										}
									},
									{
										"source": {
											"name": "OpenBalance",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										},
										"sink": {
											"name": "AR_Balance__c",
											"type": "Decimal"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": false,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "SalesforceObject",
								"type": "DatasetReference",
								"parameters": {}
							}
						]
					},
					{
						"name": "FromSalesforce_preview data",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "ToSalesforce",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SalesforceSource",
								"query": "SELECT *\nFROM Account\nWHERE LEFT(Netsuite_Customer_Number__c, 1) = 'C'\nORDER BY Netsuite_Customer_Number__c",
								"readBehavior": "query"
							},
							"sink": {
								"type": "JsonSink",
								"storeSettings": {
									"type": "AzureBlobStorageWriteSettings"
								},
								"formatSettings": {
									"type": "JsonWriteSettings"
								}
							},
							"enableStaging": false
						},
						"inputs": [
							{
								"referenceName": "SalesforceObject",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_ADLS_JSON_1",
								"type": "DatasetReference",
								"parameters": {
									"ContainerName": "main",
									"Path": "Data/Sammons Industrial/SiteProRentals/Salesforce/Account",
									"FileName": "Account"
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "annie"
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/datasets/SalesforceObject')]",
				"[concat(variables('workspaceId'), '/datasets/DS_ADLS_JSON_1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AzureProdDatabase')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureProdDatabase",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/AzureProdDatabase')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AzureSynapseAnalyticsConnector')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "briggs-b-wus-syn-01-WorkspaceDefaultSqlServer",
					"type": "LinkedServiceReference",
					"parameters": {
						"DBName": "briggsbetamdw"
					}
				},
				"annotations": [],
				"type": "AzureSqlDWTable",
				"schema": [
					{
						"name": "EmployeeNumber",
						"type": "nvarchar"
					},
					{
						"name": "EmployeeLastName",
						"type": "nvarchar"
					},
					{
						"name": "EmployeeFirstName",
						"type": "nvarchar"
					},
					{
						"name": "EmployeeMiddleName",
						"type": "nvarchar"
					},
					{
						"name": "EmploymentStatus",
						"type": "nvarchar"
					},
					{
						"name": "EmployeeHireDate",
						"type": "date"
					},
					{
						"name": "EmployeeTerminationDate",
						"type": "date"
					},
					{
						"name": "JobName",
						"type": "nvarchar"
					},
					{
						"name": "JobTitle",
						"type": "nvarchar"
					},
					{
						"name": "OrgUnit",
						"type": "nvarchar"
					},
					{
						"name": "DepartmentName",
						"type": "nvarchar"
					},
					{
						"name": "ManagerName",
						"type": "nvarchar"
					},
					{
						"name": "PayType",
						"type": "nvarchar"
					},
					{
						"name": "PayClass",
						"type": "nvarchar"
					},
					{
						"name": "EmployeeGender",
						"type": "nvarchar"
					},
					{
						"name": "SSN4",
						"type": "nvarchar"
					},
					{
						"name": "LastLoadDate",
						"type": "date"
					}
				],
				"typeProperties": {
					"schema": "POR",
					"table": "Ceridian_EmployeeInformation"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/briggs-b-wus-syn-01-WorkspaceDefaultSqlServer')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AzureSynapseAnalytics_CeridianEmployeeInformation_staging')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "briggs-b-wus-syn-01-WorkspaceDefaultSqlServer",
					"type": "LinkedServiceReference",
					"parameters": {
						"DBName": "briggsbetamdw"
					}
				},
				"annotations": [],
				"type": "AzureSqlDWTable",
				"schema": [
					{
						"name": "EmployeeNumber",
						"type": "nvarchar"
					},
					{
						"name": "EmployeeLastName",
						"type": "nvarchar"
					},
					{
						"name": "EmployeeFirstName",
						"type": "nvarchar"
					},
					{
						"name": "EmployeeMiddleName",
						"type": "nvarchar"
					},
					{
						"name": "EmploymentStatus",
						"type": "nvarchar"
					},
					{
						"name": "EmployeeHireDate",
						"type": "date"
					},
					{
						"name": "EmployeeTerminationDate",
						"type": "date"
					},
					{
						"name": "JobName",
						"type": "nvarchar"
					},
					{
						"name": "JobTitle",
						"type": "nvarchar"
					},
					{
						"name": "OrgUnit",
						"type": "nvarchar"
					},
					{
						"name": "DepartmentName",
						"type": "nvarchar"
					},
					{
						"name": "ManagerName",
						"type": "nvarchar"
					},
					{
						"name": "PayType",
						"type": "nvarchar"
					},
					{
						"name": "PayClass",
						"type": "nvarchar"
					},
					{
						"name": "EmployeeGender",
						"type": "nvarchar"
					},
					{
						"name": "SSN4",
						"type": "nvarchar"
					},
					{
						"name": "LastLoadDate",
						"type": "date"
					}
				],
				"typeProperties": {
					"schema": "POR",
					"table": "Ceridian_EmployeeInformation_staging"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/briggs-b-wus-syn-01-WorkspaceDefaultSqlServer')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Briggs_Dataset')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "Briggs_Dataset",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "SqlServerTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/Briggs_Dataset')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Briggs_MDW')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureSqlDatabase1",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"schema_name": {
						"type": "string",
						"defaultValue": "dbo"
					},
					"table_name": {
						"type": "string",
						"defaultValue": "user"
					}
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [],
				"typeProperties": {
					"schema": {
						"value": "@dataset().schema_name",
						"type": "Expression"
					},
					"table": {
						"value": "@dataset().table_name",
						"type": "Expression"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Briggs_MDW1')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureSqlDatabase1",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"schema_name": {
						"type": "string",
						"defaultValue": "dbo"
					},
					"table_name": {
						"type": "string",
						"defaultValue": "user"
					}
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [],
				"typeProperties": {
					"schema": {
						"value": "@dataset().schema_name",
						"type": "Expression"
					},
					"table": {
						"value": "@dataset().table_name",
						"type": "Expression"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Bruin_RestDataset')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "Bruin_RestLinkedService",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "RestResource",
				"typeProperties": {
					"relativeUrl": {
						"value": "@concat('api/User?ClientID=89750')",
						"type": "Expression"
					}
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/Bruin_RestLinkedService')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/DS_ABS_CSV')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureBlobStorage2",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"ContainerName": {
						"type": "string"
					},
					"Path": {
						"type": "string"
					},
					"FileName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@dataset().Path",
							"type": "Expression"
						},
						"container": {
							"value": "@dataset().ContainerName",
							"type": "Expression"
						}
					},
					"columnDelimiter": ",",
					"escapeChar": "\\",
					"firstRowAsHeader": true,
					"quoteChar": "\""
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/AzureBlobStorage2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/DS_ADLS_JSON_1')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureBlobStorage2",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"ContainerName": {
						"type": "string"
					},
					"Path": {
						"type": "string"
					},
					"FileName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "Json",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@dataset().Path",
							"type": "Expression"
						},
						"container": {
							"value": "@dataset().ContainerName",
							"type": "Expression"
						}
					}
				},
				"schema": {}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/AzureBlobStorage2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/DS_ADLS_Parquet_1')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureBlobStorage2",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"ContainerName": {
						"type": "string"
					},
					"Path": {
						"type": "string"
					},
					"FileName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "Parquet",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@dataset().Path",
							"type": "Expression"
						},
						"container": {
							"value": "@dataset().ContainerName",
							"type": "Expression"
						}
					},
					"compressionCodec": "snappy"
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/AzureBlobStorage2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/GetCeridianToken')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "RestService_Ceridian",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "RestResource",
				"typeProperties": {
					"relativeUrl": {
						"value": "@concat('APIDataLakeReport?1e2fa368-49b6-4796-9606-7e5b5dd33cbe=',formatDateTime(subtractFromTime(utcNow(),5,'Hour'),'MM'),'%2F',formatDateTime(subtractFromTime(utcNow(),5,'Hour'),'dd'),'%2F',formatDateTime(subtractFromTime(utcNow(),5,'Hour'),'yyyy'),'%2012%3A00%3A00%20AM')",
						"type": "Expression"
					}
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/RestService_Ceridian')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Netsuite')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "Netsuite",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "OdbcTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/Netsuite')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/POR_Dataset')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "POR_Dataset",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "SqlServerTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/POR_Dataset')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Parquet1')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureBlobStorage_Parquet",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"ContainerName": {
						"type": "string"
					},
					"Path": {
						"type": "string"
					},
					"FileName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "Parquet",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@dataset().Path",
							"type": "Expression"
						},
						"container": {
							"value": "@dataset().ContainerName",
							"type": "Expression"
						}
					},
					"compressionCodec": "snappy"
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/AzureBlobStorage_Parquet')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RouseFileFeed')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "RouseSFTP",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "SftpLocation",
						"fileName": "STP_pricingfile.txt",
						"folderPath": "/Outbound"
					},
					"columnDelimiter": "|",
					"escapeChar": "\\",
					"firstRowAsHeader": true,
					"quoteChar": "\""
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/RouseSFTP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SalesforceObject')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "Salesforce_sandbox",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "SalesforceObject",
				"schema": [],
				"typeProperties": {
					"objectApiName": "Account"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/Salesforce_sandbox')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AzureBlobStorage1')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobStorage",
				"typeProperties": {
					"connectionString": "[parameters('AzureBlobStorage1_connectionString')]"
				},
				"connectVia": {
					"referenceName": "STAGE-POR-IntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/STAGE-POR-IntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AzureBlobStorage2')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobStorage",
				"typeProperties": {
					"connectionString": "[parameters('AzureBlobStorage2_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AzureBlobStorage_Parquet')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobStorage",
				"typeProperties": {
					"connectionString": "[parameters('AzureBlobStorage_Parquet_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AzureProdDatabase')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureSqlDatabase",
				"typeProperties": {
					"connectionString": "[parameters('AzureProdDatabase_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AzureSqlDatabase1')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureSqlDatabase",
				"typeProperties": {
					"connectionString": "[parameters('AzureSqlDatabase1_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Briggs_Dataset')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "SqlServer",
				"typeProperties": {
					"connectionString": "[parameters('Briggs_Dataset_connectionString')]"
				},
				"connectVia": {
					"referenceName": "STAGE-POR-IntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/STAGE-POR-IntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Bruin_RestLinkedService')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Bruin REST API connection\n* note: swagger exists:  https://api.bruin.com/index.html#/User/get_api_User",
				"annotations": [],
				"type": "RestService",
				"typeProperties": {
					"url": "[parameters('Bruin_RestLinkedService_properties_typeProperties_url')]",
					"enableServerCertificateValidation": true,
					"authenticationType": "Anonymous"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/LS_POR99')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "SqlServer",
				"typeProperties": {
					"connectionString": "[parameters('LS_POR99_connectionString')]"
				},
				"connectVia": {
					"referenceName": "STAGE-POR-IntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/STAGE-POR-IntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Netsuite')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "Odbc",
				"typeProperties": {
					"connectionString": {
						"type": "SecureString",
						"value": "[parameters('Netsuite_connectionString')]"
					},
					"authenticationType": "Basic",
					"userName": "[parameters('Netsuite_properties_typeProperties_userName')]",
					"password": {
						"type": "SecureString",
						"value": "[parameters('Netsuite_password')]"
					}
				},
				"connectVia": {
					"referenceName": "STAGE-netsuite-IntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/STAGE-netsuite-IntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/POR_Dataset')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "SqlServer",
				"typeProperties": {
					"connectionString": "[parameters('POR_Dataset_connectionString')]"
				},
				"connectVia": {
					"referenceName": "STAGE-POR-IntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/STAGE-POR-IntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RestService_Ceridian')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Ceridian Dayforce REST API connection",
				"annotations": [],
				"type": "RestService",
				"typeProperties": {
					"url": "[parameters('RestService_Ceridian_properties_typeProperties_url')]",
					"enableServerCertificateValidation": false,
					"authenticationType": "Anonymous"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RouseSFTP')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "Sftp",
				"typeProperties": {
					"host": "[parameters('RouseSFTP_properties_typeProperties_host')]",
					"port": 22,
					"skipHostKeyValidation": true,
					"authenticationType": "Basic",
					"userName": "[parameters('RouseSFTP_properties_typeProperties_userName')]",
					"password": {
						"type": "SecureString",
						"value": "[parameters('RouseSFTP_password')]"
					}
				},
				"connectVia": {
					"referenceName": "STAGE-POR-IntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/STAGE-POR-IntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Salesforce_sandbox')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "Salesforce",
				"typeProperties": {
					"environmentUrl": "[parameters('Salesforce_sandbox_properties_typeProperties_environmentUrl')]",
					"username": "[parameters('Salesforce_sandbox_properties_typeProperties_username')]",
					"password": {
						"type": "SecureString",
						"value": "[parameters('Salesforce_sandbox_password')]"
					},
					"securityToken": {
						"type": "SecureString",
						"value": "[parameters('Salesforce_sandbox_securityToken')]"
					},
					"apiVersion": "56.0"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/atest')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('atest_properties_typeProperties_url')]",
					"accountKey": {
						"type": "SecureString",
						"value": "[parameters('atest_accountKey')]"
					}
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/briggs-b-wus-syn-01-WorkspaceDefaultSqlServer')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"parameters": {
					"DBName": {
						"type": "String"
					}
				},
				"annotations": [],
				"type": "AzureSqlDW",
				"typeProperties": {
					"connectionString": "[parameters('briggs-b-wus-syn-01-WorkspaceDefaultSqlServer_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/briggs-b-wus-syn-01-WorkspaceDefaultStorage')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('briggs-b-wus-syn-01-WorkspaceDefaultStorage_properties_typeProperties_url')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/1_3_PM_IST')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "PL_Master_Netsuite_Source",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 1,
						"startTime": "2022-06-22T14:20:00",
						"timeZone": "India Standard Time",
						"schedule": {
							"minutes": [
								30
							],
							"hours": [
								13
							]
						}
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Master_Netsuite_Source')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/1_PM_IST')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "PL_MASTER_LOAD_POR_New",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 1,
						"startTime": "2022-06-22T14:19:00",
						"timeZone": "India Standard Time",
						"schedule": {
							"minutes": [
								0
							],
							"hours": [
								13
							]
						}
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_MASTER_LOAD_POR_New')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Morning_1-40_cst')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "MetTel",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 1,
						"startTime": "2022-08-05T19:41:00",
						"timeZone": "Central Standard Time",
						"schedule": {
							"minutes": [
								40
							],
							"hours": [
								1
							]
						}
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/MetTel')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RouseDaily')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "PL_Rouse_asset_pricing",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 1,
						"startTime": "2022-06-29T00:00:00",
						"timeZone": "Central Standard Time",
						"schedule": {
							"minutes": [
								35
							],
							"hours": [
								3
							]
						}
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Rouse_asset_pricing')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AutoResolveIntegrationRuntime')]",
			"type": "Microsoft.Synapse/workspaces/integrationRuntimes",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "Managed",
				"typeProperties": {
					"computeProperties": {
						"location": "AutoResolve",
						"dataFlowProperties": {
							"computeType": "General",
							"coreCount": 8,
							"timeToLive": 0
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/STAGE-POR-IntegrationRuntime')]",
			"type": "Microsoft.Synapse/workspaces/integrationRuntimes",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "SelfHosted",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/STAGE-netsuite-IntegrationRuntime')]",
			"type": "Microsoft.Synapse/workspaces/integrationRuntimes",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "SelfHosted",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/GetDataToEncrypt')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "DS_ADLS_JSON_1",
								"type": "DatasetReference"
							},
							"name": "GetDataToEncrypt"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "AzureSynapseAnalytics_CeridianEmployeeInformation_staging",
								"type": "DatasetReference"
							},
							"name": "SinkThis"
						}
					],
					"transformations": [
						{
							"name": "CeridianSPFlat"
						},
						{
							"name": "Derivations"
						}
					],
					"scriptLines": [
						"source(output(",
						"          Data as (Rows as (Department_ShortName as string, DeptJob_ShortName as string, EmployeeEmploymentStatus_EmployeeNumber as integer, EmployeeManager_ManagerDisplayName as string, Employee_FirstName as string, Employee_Gender as string, Employee_HireDate as string, Employee_LastName as string, Employee_MiddleName as string, Employee_SocialSecurityNumber as integer, Employee_TerminationDate as string, EmploymentStatus_ShortName as string, Job_ShortName as string, OrgUnit_ShortName as string, PayClass_ShortName as string, PayType_ShortName as string)[], XRefCode as string),",
						"          Paging as (Next as string)",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     documentForm: 'documentPerLine') ~> GetDataToEncrypt",
						"GetDataToEncrypt foldDown(unroll(Data.Rows),",
						"     mapColumn(",
						"          EmployeeNumber = Data.Rows.EmployeeEmploymentStatus_EmployeeNumber,",
						"          EmployeeLastName = Data.Rows.Employee_LastName,",
						"          EmployeeFirstName = Data.Rows.Employee_FirstName,",
						"          EmployeeMiddleName = Data.Rows.Employee_MiddleName,",
						"          EmploymentStatus = Data.Rows.EmploymentStatus_ShortName,",
						"          EmployeeHireDate = Data.Rows.Employee_HireDate,",
						"          EmployeeTerminationDate = Data.Rows.Employee_TerminationDate,",
						"          JobName = Data.Rows.Job_ShortName,",
						"          JobTitle = Data.Rows.DeptJob_ShortName,",
						"          OrgUnit = Data.Rows.OrgUnit_ShortName,",
						"          DepartmentName = Data.Rows.Department_ShortName,",
						"          ManagerName = Data.Rows.EmployeeManager_ManagerDisplayName,",
						"          PayType = Data.Rows.PayType_ShortName,",
						"          PayClass = Data.Rows.PayClass_ShortName,",
						"          EmployeeGender = Data.Rows.Employee_Gender,",
						"          SSN4 = Data.Rows.Employee_SocialSecurityNumber",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> CeridianSPFlat",
						"CeridianSPFlat derive(EmployeeNumber = lpad(toString(EmployeeNumber),6,'0'),",
						"          EmployeeHireDate = toDate(substring(EmployeeHireDate,0,10), 'yyyy-MM-dd'),",
						"          EmployeeTerminationDate = toDate(substring(EmployeeTerminationDate,0,10), 'yyyy-MM-dd'),",
						"          PayType = replace(PayType, '(', ' ('),",
						"          SSN4 = right(toString(SSN4), 4),",
						"          LastLoadDate = currentDate()) ~> Derivations",
						"Derivations sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     input(",
						"          EmployeeNumber as string,",
						"          EmployeeLastName as string,",
						"          EmployeeFirstName as string,",
						"          EmployeeMiddleName as string,",
						"          EmploymentStatus as string,",
						"          EmployeeHireDate as date,",
						"          EmployeeTerminationDate as date,",
						"          JobName as string,",
						"          JobTitle as string,",
						"          OrgUnit as string,",
						"          DepartmentName as string,",
						"          ManagerName as string,",
						"          PayType as string,",
						"          PayClass as string,",
						"          EmployeeGender as string,",
						"          SSN4 as string,",
						"          LastLoadDate as date",
						"     ),",
						"     deletable:false,",
						"     insertable:true,",
						"     updateable:false,",
						"     upsertable:false,",
						"     format: 'table',",
						"     staged: true,",
						"     preSQLs:['truncate table POR.Ceridian_EmployeeInformation_staging;'],",
						"     errorHandlingOption: 'stopOnFirstError') ~> SinkThis"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/DS_ADLS_JSON_1')]",
				"[concat(variables('workspaceId'), '/datasets/AzureSynapseAnalytics_CeridianEmployeeInformation_staging')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/TransformToSink')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "DS_ADLS_JSON_1",
								"type": "DatasetReference"
							},
							"name": "GetData"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "AzureSynapseAnalyticsConnector",
								"type": "DatasetReference"
							},
							"name": "sinkIt"
						}
					],
					"transformations": [
						{
							"name": "CeridianSPFlat"
						},
						{
							"name": "Derivations"
						}
					],
					"scriptLines": [
						"source(output(",
						"          Data as (Rows as (Department_ShortName as string, DeptJob_ShortName as string, EmployeeEmploymentStatus_EmployeeNumber as integer, EmployeeManager_ManagerDisplayName as string, Employee_FirstName as string, Employee_Gender as string, Employee_HireDate as string, Employee_LastName as string, Employee_MiddleName as string, Employee_SocialSecurityNumber as integer, Employee_TerminationDate as string, EmploymentStatus_ShortName as string, Job_ShortName as string, OrgUnit_ShortName as string, PayClass_ShortName as string, PayType_ShortName as string)[], XRefCode as string),",
						"          Paging as (Next as string)",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     ignoreNoFilesFound: false,",
						"     documentForm: 'documentPerLine') ~> GetData",
						"GetData foldDown(unroll(Data.Rows),",
						"     mapColumn(",
						"          EmployeeNumber = Data.Rows.EmployeeEmploymentStatus_EmployeeNumber,",
						"          EmployeeLastName = Data.Rows.Employee_LastName,",
						"          EmployeeFirstName = Data.Rows.Employee_FirstName,",
						"          EmployeeMiddleName = Data.Rows.Employee_MiddleName,",
						"          EmploymentStatus = Data.Rows.EmploymentStatus_ShortName,",
						"          EmployeeHireDate = Data.Rows.Employee_HireDate,",
						"          EmployeeTerminationDate = Data.Rows.Employee_TerminationDate,",
						"          JobName = Data.Rows.Job_ShortName,",
						"          JobTitle = Data.Rows.DeptJob_ShortName,",
						"          OrgUnit = Data.Rows.OrgUnit_ShortName,",
						"          DepartmentName = Data.Rows.Department_ShortName,",
						"          ManagerName = Data.Rows.EmployeeManager_ManagerDisplayName,",
						"          PayType = Data.Rows.PayType_ShortName,",
						"          PayClass = Data.Rows.PayClass_ShortName,",
						"          EmployeeGender = Data.Rows.Employee_Gender,",
						"          SSN4 = Data.Rows.Employee_SocialSecurityNumber",
						"     ),",
						"     skipDuplicateMapInputs: false,",
						"     skipDuplicateMapOutputs: false) ~> CeridianSPFlat",
						"CeridianSPFlat derive(EmployeeNumber = lpad(toString(EmployeeNumber),6,'0'),",
						"          EmployeeHireDate = toDate(substring(EmployeeHireDate,0,10), 'yyyy-MM-dd'),",
						"          EmployeeTerminationDate = toDate(substring(EmployeeTerminationDate,0,10), 'yyyy-MM-dd'),",
						"          PayType = replace(PayType, '(', ' ('),",
						"          SSN4 = right(toString(SSN4), 4),",
						"          LastLoadDate = currentDate()) ~> Derivations",
						"Derivations sink(allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     input(",
						"          EmployeeNumber as string,",
						"          EmployeeLastName as string,",
						"          EmployeeFirstName as string,",
						"          EmployeeMiddleName as string,",
						"          EmploymentStatus as string,",
						"          EmployeeHireDate as date,",
						"          EmployeeTerminationDate as date,",
						"          JobName as string,",
						"          JobTitle as string,",
						"          OrgUnit as string,",
						"          DepartmentName as string,",
						"          ManagerName as string,",
						"          PayType as string,",
						"          PayClass as string,",
						"          EmployeeGender as string,",
						"          SSN4 as string,",
						"          LastLoadDate as date",
						"     ),",
						"     deletable:false,",
						"     insertable:true,",
						"     updateable:false,",
						"     upsertable:false,",
						"     format: 'table',",
						"     staged: true,",
						"     preSQLs:['truncate table POR.Ceridian_EmployeeInformation;'],",
						"     errorHandlingOption: 'stopOnFirstError',",
						"     mapColumn(",
						"          EmployeeNumber,",
						"          EmployeeLastName,",
						"          EmployeeFirstName,",
						"          EmployeeMiddleName,",
						"          EmploymentStatus,",
						"          EmployeeHireDate,",
						"          EmployeeTerminationDate,",
						"          JobName,",
						"          JobTitle,",
						"          OrgUnit,",
						"          DepartmentName,",
						"          ManagerName,",
						"          PayType,",
						"          PayClass,",
						"          EmployeeGender,",
						"          SSN4,",
						"          LastLoadDate",
						"     )) ~> sinkIt"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/DS_ADLS_JSON_1')]",
				"[concat(variables('workspaceId'), '/datasets/AzureSynapseAnalyticsConnector')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/WorkspaceSystemIdentity')]",
			"type": "Microsoft.Synapse/workspaces/credentials",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "ManagedIdentity",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/briggsbetamdw')]",
			"type": "Microsoft.Synapse/workspaces/sqlPools",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"collation": "SQL_Latin1_General_CP1_CI_AS",
				"maxSizeBytes": 263882790666240,
				"annotations": []
			},
			"dependsOn": [],
			"location": "westus"
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RingCentral_JWT')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "GetBearerToken",
						"type": "WebActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": "https://platform.devtest.ringcentral.com/restapi/oauth/token",
							"connectVia": {
								"referenceName": "AutoResolveIntegrationRuntime",
								"type": "IntegrationRuntimeReference"
							},
							"method": "POST",
							"headers": {
								"Content-type": "application/x-www-form-urlencoded",
								"Authorization": {
									"value": "@concat('Basic ', base64('jNW_3spcQZWYyqu5mBE5hQ:DDJbGUXzRuGLHylvm13JNQtSjd3XGbSVehASpe9bbttw'))",
									"type": "Expression"
								}
							},
							"body": {
								"value": "@concat('grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Ajwt-bearer&assertion=','eyJraWQiOiI4NzYyZjU5OGQwNTk0NGRiODZiZjVjYTk3ODA0NzYwOCIsInR5cCI6IkpXVCIsImFsZyI6IlJTMjU2In0.eyJhdWQiOiJodHRwczpcL1wvcGxhdGZvcm0uZGV2dGVzdC5yaW5nY2VudHJhbC5jb21cL3Jlc3RhcGlcL29hdXRoXC90b2tlbiIsInN1YiI6Ijc0ODc1MjAwNSIsImlzcyI6Imh0dHBzOlwvXC9wbGF0Zm9ybS5kZXZ0ZXN0LnJpbmdjZW50cmFsLmNvbSIsImV4cCI6MzgxMzA4MTY3NiwiaWF0IjoxNjY1NTk4MDI5LCJqdGkiOiJ6STZlOWdXU1NueVNNQ3p5bjhyRm1nIn0.Uno8K_3G78A_KSkI_kmaFOYrgy1Pqzyza83q6zauTn6JjwgxILR52WIRRfcfgwGOa7_3s0pC9_1ixr3r715izCb5ZudLFMcjeIBn1rSIyLVloFhRov9xpiIXeb6Er3rXPIjRXU1xOwB35i8mIKjp2Bd2YE72mbjH70X0b2EEiYK5k0kDwO8R0FstA8sEbJPPxKB6YD3adiaXwbszj-AuLZv7Maik5ezwxnK6E3BKI4jdOVPjwinz7l0CrcsIgk6K2DplhluERESn44INey2qzffkbQsf_BqRd-P6N0P1tvpdlplBGgTgurWcpUc2ia0mJEOukul_zEyp0Yf6bj2_4Q')",
								"type": "Expression"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "annie"
				},
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		}
	]
}