{
	"name": "LOAD_POR_TEMP",
	"properties": {
		"activities": [
			{
				"name": "Heavy Equipment Tax_Updated",
				"type": "Copy",
				"dependsOn": [],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "SqlServerSource",
						"sqlReaderQuery": " SELECT distinct  CLDT\n  ,CONVERT (varchar(10),CLDT, 101) as ClosedDate\n  ,CASE LEFT(t.CNTR,1) \n\t  WHEN 'c' THEN 'Credit'\n\t  ELSE 'Invoice'\n\t  END AS TransactionType,\n      t.CNTR as 'Contract'\n\t, cust.[KEY] AS 'POR Customer'\n\t, cust.[NAME] As 'Customer Name'\n\t, cust.APILink AS NetSuiteCustomer\n\t,[STR] AS 'Store'\n\t,CASE SUBSTRING(TXTY,1,1)\n\t\t\tWHEN 'R' THEN 'Rental'\n\t\t\tWHEN 'S' THEN 'Sale'\n\t\t\tEND AS LinePrimaryStatus\n\t\t--CASE SUBSTRING(TXTY,2,1)\n\t\t--\tWHEN 'R' THEN 'Returned'\n\t\t--\tWHEN 'X' THEN 'Prev Returned'\n\t\t--\tWHEN 'H' THEN 'Not Returned. Hold'\n\t\t--\tWHEN 'S' THEN 'Sales Item'\n\t\t--\tWHEN 'A' THEN 'Sold Asset'\n\t\t--\tWHEN 'D' THEN 'Not Returned'\n\t\t--\tWHEN 'M' THEN 'Not Returned Reservation'\n\t\t--\tWHEN 'N' THEN 'Not Returned'\n\t\t--\tWHEN ' ' THEN 'Not Returned'\n\t\t--ELSE 'UNKNOWN'\n\t\t--END AS LineSecondaryStatus\n\t,cat.[Name] AS CatDesc\n\t,ifile.[KEY] AS ItemKey\n\t,ifile.NUM AS ItemNumber\n\t,ifile.[Name] As EquipDesc\n\t,FUEL\n\t,MANF AS Manufacturer\n\t,MODN AS ModelNumber\n\t,ModelYear\n\t,SerialNumber\n\t,DEPA AS AssetCost\n\t,PRIC AS ItemAmount,\n\tgetdate() last_refresh_date\n    FROM [POR].dbo.Transactions t\n        JOIN [POR].dbo.AccountingAPIQueueTR api ON api.ContractNumber = t.CNTR\n        JOIN [POR].dbo.TransactionItems i ON i.CNTR = t.CNTR\n        JOIN [POR].dbo.ItemFile ifile ON ifile.NUM = i.ITEM  ---\n        JOIN [POR].dbo.ItemCategory cat ON ifile.Category = cat.Category\n        JOIN [POR].dbo.CustomerFile cust ON cust.CNUM = t.CUSN\n        LEFT JOIN [POR].dbo.ParameterFile store ON t.[STR] = store.Store\n    WHERE \nt.STAT IN ('C', 'CR') \nAND api.NoExport = 0\nAND STORE_CITY LIKE '%TX%'\n--AND ifile.TYPE IN ('H','T')\nAND  GVWR = 1\nAND cat.[Name] !='RERENT'\norder by t.CLDT",
						"queryTimeout": "02:00:00",
						"partitionOption": "None"
					},
					"sink": {
						"type": "AzureSqlSink",
						"preCopyScript": "truncate table por.Heavy_Equipment_Tax",
						"disableMetricsCollection": false
					},
					"enableStaging": false,
					"translator": {
						"type": "TabularTranslator",
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "POR_Dataset",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "Briggs_MDW",
						"type": "DatasetReference",
						"parameters": {
							"schema_name": "POR",
							"table_name": "Heavy_Equipment_Tax"
						}
					}
				]
			},
			{
				"name": "TERP with Equipment Rented or Sold_Updated",
				"type": "Copy",
				"dependsOn": [
					{
						"activity": "TERP LINE ONLY_Updated",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "SqlServerSource",
						"sqlReaderQuery": "\n SELECT ClosedDate,\nTransactionType,\nT.[Contract],\n[POR Customer],\n[NetSuiteCustomer],\n[Store],\n[RentalTotal],\n[TERPAmount],\n[DeliverToName],\n[custPickup],\n[DeliveryAddress],\n[DeliveryCity],\n[DeliveryState],\n[DeliveryZip],\n[CatDesc],\n[EquipDesc],\n[SerialNumber],\n[FUEL]\n,getdate() last_refresh_date\n  FROM\n\n --- TERP Line Item \n (\n SELECT distinct \n  CONVERT (varchar(10),CLDT, 101) as ClosedDate\n  ,CASE LEFT(t.CNTR,1) \n  WHEN 'c' THEN 'Credit'\n  ELSE 'Invoice'\n  END AS TransactionType,\n        t.CNTR as 'Contract'\n\t, cust.[KEY] AS 'POR Customer'\n\t, cust.APILink AS NetSuiteCustomer\n\t,[STR] AS 'Store'\n\t,t.RENT AS RentalTotal\n\t,i.PRIC AS TERPAmount\n\t,COALESCE(NULLIF(t.DeliverToCompany,''), NULLIF(cust.[NAME],'')) AS DeliverToName\n\t, t.Pickup AS custPickup\n\t\t,CASE t.Pickup \tWHEN 0 THEN \n\t COALESCE(NULLIF(j.SiteAddress,''), NULLIF(t.DeliveryAddress,''), NULLIF(store.STORE_STRT,''))\n\t ELSE (store.STORE_STRT)\n\t END AS DeliveryAddress\n\t, CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(NULLIF(LEFT(j.SiteCity, CHARINDEX(',',j.SiteCity + ',',  1) -1),''),NULLIF(LEFT(t.DeliveryCity, CHARINDEX(',',t.DeliveryCity + ',',  1) -1),''), NULLIF(LEFT(store.STORE_CITY, CHARINDEX(',',store.STORE_CITY + ',',  1) -1),'')) \n\tELSE LEFT(STORE_CITY, CHARINDEX(',',STORE_CITY + ',',  1) -1)\n\tEND AS DeliveryCity\n\t,CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(NULLIF(LEFT(j.SiteCity, CHARINDEX(',',j.SiteCity + ',',  1) -1),''),NULLIF(LEFT(t.DeliveryCity, CHARINDEX(',',t.DeliveryCity + ',',  1) -1),''), NULLIF(LEFT(store.STORE_CITY, CHARINDEX(',',store.STORE_CITY + ',',  1) -1),'')) \n\tELSE SUBSTRING(STORE_CITY,CHARINDEX(',',STORE_CITY)+1,3)\tEND AS DeliveryState\n\t,CASE t.Pickup \tWHEN 0 THEN \n\tCOALESCE(NULLIF(j.SiteZip,''), NULLIF(t.DeliveryZip,''), NULLIF(store.STORE_ZIP,'')) \n\tELSE NULLIF(store.STORE_ZIP,'') END AS DeliveryZip\n\n\n    FROM [POR].dbo.Transactions t\n        JOIN [POR].dbo.AccountingAPIQueueTR api ON api.ContractNumber = t.CNTR\n        JOIN [POR].dbo.TransactionItems i ON i.CNTR = t.CNTR\n        JOIN [POR].dbo.ItemFile ifile ON ifile.NUM = i.ITEM\n        JOIN [POR].dbo.ItemCategory cat ON ifile.Category = cat.Category\n        JOIN [POR].dbo.CustomerFile cust ON cust.CNUM = t.CUSN\n        LEFT JOIN [POR].dbo.CustomerJobSite j ON t.JobSite = j.Number\n        LEFT JOIN [POR].dbo.ParameterFile store ON t.[STR] = store.Store\n    WHERE \napi.NoExport = 0\nAND  ifile.[KEY] = 'EQTAX'\nAND PRIC >0\nAND STORE_CITY LIKE '%TX%'\n--AND CLDT BETWEEN DATEADD(month, DATEDIFF(month, -1, getdate()) - 2, 0) AND DATEADD(ss, -1, DATEADD(month, DATEDIFF(month, 0, getdate()), 0))\n\n\n) T\nJOIN \n--- Equipment on Rent\n(\n\n   select distinct\n   t.CNTR AS Contract\n\t,cat.[Name] AS CatDesc\n\t,ifile.[Name] As EquipDesc\n\t,SerialNumber\n\t,ifile.FUEL\n\t\n    FROM [POR].dbo.Transactions t\n        JOIN [POR].dbo.AccountingAPIQueueTR api ON api.ContractNumber = t.CNTR\n        JOIN [POR].dbo.TransactionItems i ON i.CNTR = t.CNTR\n        JOIN [POR].dbo.ItemFile ifile ON ifile.NUM = i.ITEM  ---\n        JOIN [POR].dbo.ItemCategory cat ON ifile.Category = cat.Category\n        JOIN [POR].dbo.CustomerFile cust ON cust.CNUM = t.CUSN\n        LEFT JOIN [POR].dbo.CustomerJobSite j ON t.JobSite = j.Number\n        LEFT JOIN [POR].dbo.ParameterFile store ON t.[STR] = store.Store\n    WHERE \napi.NoExport = 0\nAND t.CNTR In\n(select i.CNTR From TransactionItems i JOIN Itemfile ifile ON i.ITEM= ifile.NUM  where  [KEY] = 'EQTAX' AND PRIC >0)\nAND STORE_CITY LIKE '%TX%'\nAND ifile.TYPE IN ('H','T')\n) E ON T.Contract= E.Contract\n",
						"queryTimeout": "02:00:00",
						"partitionOption": "None"
					},
					"sink": {
						"type": "AzureSqlSink",
						"preCopyScript": "truncate table por.TERP_Support",
						"disableMetricsCollection": false
					},
					"enableStaging": false,
					"translator": {
						"type": "TabularTranslator",
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "POR_Dataset",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "Briggs_MDW",
						"type": "DatasetReference",
						"parameters": {
							"schema_name": "POR",
							"table_name": "TERP_Support"
						}
					}
				]
			},
			{
				"name": "TERP LINE ONLY_Updated",
				"type": "Copy",
				"dependsOn": [
					{
						"activity": "Tax Recap_Updated",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "SqlServerSource",
						"sqlReaderQuery": "SELECT distinct \n  CONVERT (varchar(10),CLDT, 101) as ClosedDate\n  ,CASE LEFT(t.CNTR,1) \n  WHEN 'c' THEN 'Credit'\n  ELSE 'Invoice'\n  END AS TransactionType,\n        t.CNTR as 'Contract'\n\t, cust.[KEY] AS 'POR Customer'\n\t, cust.APILink AS NetSuiteCustomer\n\t,[STR] AS 'Store'\n\t,t.RENT AS RentalTotal\n\t,i.PRIC AS TERPAmount\n\t,COALESCE(NULLIF(t.DeliverToCompany,''), NULLIF(cust.[NAME],'')) AS DeliverToName\n\t, t.Pickup AS custPickup\n\t\t,CASE t.Pickup \tWHEN 0 THEN \n\t COALESCE(NULLIF(j.SiteAddress,''), NULLIF(t.DeliveryAddress,''), NULLIF(store.STORE_STRT,''))\n\t ELSE (store.STORE_STRT)\n\t END AS DeliveryAddress\n\t, CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(NULLIF(LEFT(j.SiteCity, CHARINDEX(',',j.SiteCity + ',',  1) -1),''),NULLIF(LEFT(t.DeliveryCity, CHARINDEX(',',t.DeliveryCity + ',',  1) -1),''), NULLIF(LEFT(store.STORE_CITY, CHARINDEX(',',store.STORE_CITY + ',',  1) -1),'')) \n\tELSE LEFT(STORE_CITY, CHARINDEX(',',STORE_CITY + ',',  1) -1)\n\tEND AS DeliveryCity\n\t,CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(NULLIF(LEFT(j.SiteCity, CHARINDEX(',',j.SiteCity + ',',  1) -1),''),NULLIF(LEFT(t.DeliveryCity, CHARINDEX(',',t.DeliveryCity + ',',  1) -1),''), NULLIF(LEFT(store.STORE_CITY, CHARINDEX(',',store.STORE_CITY + ',',  1) -1),'')) \n\tELSE SUBSTRING(STORE_CITY,CHARINDEX(',',STORE_CITY)+1,3)\tEND AS DeliveryState\n\t,CASE t.Pickup \tWHEN 0 THEN \n\tCOALESCE(NULLIF(j.SiteZip,''), NULLIF(t.DeliveryZip,''), NULLIF(store.STORE_ZIP,'')) \n\tELSE NULLIF(store.STORE_ZIP,'') END AS DeliveryZip\n\n\t,getdate() last_refresh_date\n    FROM [POR].dbo.Transactions t\n        JOIN [POR].dbo.AccountingAPIQueueTR api ON api.ContractNumber = t.CNTR\n        JOIN [POR].dbo.TransactionItems i ON i.CNTR = t.CNTR\n        JOIN [POR].dbo.ItemFile ifile ON ifile.NUM = i.ITEM\n        JOIN [POR].dbo.ItemCategory cat ON ifile.Category = cat.Category\n        JOIN [POR].dbo.CustomerFile cust ON cust.CNUM = t.CUSN\n        LEFT JOIN [POR].dbo.CustomerJobSite j ON t.JobSite = j.Number\n        LEFT JOIN [POR].dbo.ParameterFile store ON t.[STR] = store.Store\n    WHERE \napi.NoExport = 0\nAND  ifile.[KEY] = 'EQTAX'\nAND PRIC >0\nAND STORE_CITY LIKE '%TX%'\n--AND CLDT BETWEEN DATEADD(month, DATEDIFF(month, -1, getdate()) - 2, 0) AND DATEADD(ss, -1, DATEADD(month, DATEDIFF(month, 0, getdate()), 0))\n",
						"queryTimeout": "02:00:00",
						"partitionOption": "None"
					},
					"sink": {
						"type": "AzureSqlSink",
						"preCopyScript": "truncate table por.TERP",
						"disableMetricsCollection": false
					},
					"enableStaging": false,
					"translator": {
						"type": "TabularTranslator",
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "POR_Dataset",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "Briggs_MDW",
						"type": "DatasetReference",
						"parameters": {
							"schema_name": "POR",
							"table_name": "TERP"
						}
					}
				]
			},
			{
				"name": "Tax Recap_Updated",
				"type": "Copy",
				"dependsOn": [
					{
						"activity": "Heavy Equipment Tax_Updated",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "SqlServerSource",
						"sqlReaderQuery": "select distinct CLDT,\n  CONVERT (varchar(10),CLDT, 101) as ClosedDate\n  ,CASE LEFT(CNTR,1) \n  WHEN 'c' THEN 'Credit'\n  ELSE 'Invoice'\n  END AS TransactionType,\n        t.CNTR as 'Contract'\n\t, cust.[KEY] AS 'POR Customer'\n\t, cust.APILink AS NetSuiteCustomer\n\t, cust.[Name] As 'Customer Name'\n\t, [STR] AS 'Store'\n\t, t.Rent AS 'RentTotal'\n\t, t.SALE AS 'SaleTotal'\n\t, t.Rent + t.SALE AS 'RevTotal'\n\t, t.DMG AS 'Damage Waiver'\n\t, Tax\n\t, Totl AS InvoiceTotal\n\t, CASE t.Pickup \n\tWHEN 0 THEN 'Delivery'\n\tWHEN 1 THEN 'Customer Pickup'\n\tELSE 'NA'\n\tEND AS custPickup\n\t--\t, COALESCE(NULLIF(j.SiteAddress,''), NULLIF(t.DeliveryAddress,''), NULLIF(store.STORE_STRT,'')) as DeliveryAddress\n\t\n\t,CASE t.Pickup \tWHEN 0 THEN \n\t COALESCE(NULLIF(j.SiteAddress,''), NULLIF(t.DeliveryAddress,''), NULLIF(store.STORE_STRT,''))\n\t ELSE (store.STORE_STRT)\n\t END AS DeliveryAddress\n\t, CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(NULLIF(LEFT(j.SiteCity, CHARINDEX(',',j.SiteCity + ',',  1) -1),''),NULLIF(LEFT(t.DeliveryCity, CHARINDEX(',',t.DeliveryCity + ',',  1) -1),''), NULLIF(LEFT(store.STORE_CITY, CHARINDEX(',',store.STORE_CITY + ',',  1) -1),'')) \n\tELSE LEFT(STORE_CITY, CHARINDEX(',',STORE_CITY + ',',  1) -1)\n\tEND AS DeliveryCity\n\t,CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(TRIM(NULLIF(RIGHT(j.SiteCity, NULLIF(CHARINDEX(',',REVERSE(j.SiteCity)),'') -1),'')),TRIM(NULLIF(RIGHT(t.DeliveryCity, NULLIF(CHARINDEX(',',REVERSE(t.DeliveryCity)),'') -1),''))\t,\n\tTRIM(NULLIF(RIGHT(store.STORE_CITY, NULLIF(CHARINDEX(',',REVERSE(store.STORE_CITY)),'') -1),''))) \n\tELSE TRIM(SUBSTRING(STORE_CITY,CHARINDEX(',',STORE_CITY)+1,3))\tEND AS DeliveryState\n\t,CASE t.Pickup \tWHEN 0 THEN \n\tCOALESCE(NULLIF(j.SiteZip,''), NULLIF(t.DeliveryZip,''), NULLIF(store.STORE_ZIP,'')) \n\tELSE NULLIF(store.STORE_ZIP,'') END AS DeliveryZip\n\t--,store.STORE_NAME As StoreName,\n\t--store.STORE_STRT AS StoreAddress, STORE_CITY AS StoreCity, STORE_ZIP AS StoreZipCode\n    ,getdate() last_refresh_date\n\tFROM [POR].dbo.Transactions t\n        JOIN [POR].dbo.AccountingAPIQueueTR api ON api.ContractNumber = t.CNTR\n        JOIN [POR].dbo.CustomerFile cust ON cust.CNUM = t.CUSN\n        LEFT JOIN [POR].dbo.CustomerJobSite j ON t.JobSite = j.Number\n        LEFT JOIN [POR].dbo.ParameterFile store ON t.[STR] = store.Store\n\t    WHERE t.STAT IN ('C', 'CR')  AND\n api.NoExport = 0\n-- AND CLDT BETWEEN DATEADD(month, DATEDIFF(month, -1, getdate()) - 2, 0) AND DATEADD(ss, -1, DATEADD(month, DATEDIFF(month, 0, getdate()), 0))\n order by CLDT, CNTR\n",
						"queryTimeout": "02:00:00",
						"partitionOption": "None"
					},
					"sink": {
						"type": "AzureSqlSink",
						"preCopyScript": "truncate table por.Tax_Summary",
						"disableMetricsCollection": false
					},
					"enableStaging": false,
					"translator": {
						"type": "TabularTranslator",
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "POR_Dataset",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "Briggs_MDW",
						"type": "DatasetReference",
						"parameters": {
							"schema_name": "POR",
							"table_name": "Tax_Summary"
						}
					}
				]
			},
			{
				"name": "POR_Open_Contract",
				"type": "Copy",
				"dependsOn": [],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "SqlServerSource",
						"sqlReaderQuery": "SELECT\n--Below are Transaction Level Items\nCASE WHEN pf.Store <> '001' THEN RIGHT(pf.STORE_NAME, LEN(pf.STORE_NAME) - 4) ELSE pf.STORE_NAME END AS [Store_Name]\n, t.[STR] AS [Store_No]\n, CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END AS Customer_Type\n--, cf.[Key] AS [Customer Number]\n, cf.[CNUM] AS [Customer_Number]\n, cf.[Name] AS [Customer_Name]\n, t.JOBN AS [Job_Name]\n, t.JBPO AS [Job_PO]\n, t.JBID AS [Job_id]\n, cjs.Description AS [Job_Site_Name]\n, ISNULL(cjs.SiteAddress,'') + ' ' + ISNULL(cjs.SiteCity,'') + ' ' + ISNULL(cjs.SiteZip,'') AS [Job_Site_Address]\n, t.DMG AS [Extended_Protection_Plan]\n, s.[Name] AS [Contract_Salesman]\n, s2.[Name] AS [Customer_Salesman]\n, o.OPNM AS [Created_by_Operator_Name]\n, o2.OPNM AS [Assigned_to_Operator_Name] -- This drives the revenue\n, t.[DATE] AS [Contract_Date]\n, t1.OriginalContractDate AS [Original_Contract_Date]\n, t.[CNTR] AS [Contract_No]\n--Below are Item level details\n/** NOTE for this case statement --IF TXTY is RR (Called Off) then we should add ti.DDT as called off date, otherwise John doesn't want to see ti.DDT. Not sure best way to go about that in PowerBI **/\n, CASE WHEN ti.TXTY = 'R' THEN 'RENT'\nWHEN ti.TXTY = 'RR' THEN 'Returned'\nWHEN ti.TXTY = 'RX' THEN 'Previously Returned'\nWHEN ti.TXTY = 'RH' THEN 'Not Returned. Item on hold for pickup'\nWHEN ti.TXTY = 'RD' THEN 'Not Returned. Demand letter sent'\nWHEN ti.TXTY = 'RM' THEN 'Not Returned. Reservation Reminder letter sent'\nWHEN ti.TXTY = 'RN' THEN 'Not Returned. Reminder letter sent'\nWHEN ti.TXTY = 'RV' THEN 'Not Returned. Reservation Verify letter sent'\nWHEN ti.TXTY = '' THEN 'Not Returned. No letters have been sent'\nELSE 'Sale Item' END AS [Item_Status]\n, ifi.Header -- John wants to see HEADER key that each ITEM belongs too for grouping/pivot/lookup purposes\n--, ti.ITEM AS [Key]\n\n, ifi.[KEY] \n, ifi.Name\n, ifi.SerialNumber AS [Serial_Number]\n, ifi.MANF AS [Make]\n, ifi.MODN AS [Model]\n, ifi.Modelyear AS [Model_Year]\n, ti.PRIC AS [Amount_Charged]\n, ti.DailyAmount AS [Daily]\n, ifi.RATE1 AS [Book_Rate_Daily]\n, ti.WeeklyAmount AS [Weekly]\n, ifi.RATE2 AS [Book_Rate_Weekly]\n, ti.MonthlyAmount AS [Monthly]\n, ifi.RATE3 AS [Book_Rate_Monthly]\n, CASE WHEN ti.Substatus = 7 THEN 'Substitute' ELSE '' END AS [Is_Substitute]\n, CASE WHEN ti.Substatus = 7 THEN ti.Comments ELSE '' END AS [Substitution_Comments]\n, ITF_OEC.OEC AS [OEC]\n, getdate() last_refresh_date\n, ti.ITEM AS [ItemNum]\n,oec\n,''[Job site zipcode]\nFROM POR.dbo.transactions t\nJOIN POR.dbo.TransactionItems ti ON ti.CNTR = t.CNTR\nJOIN POR.dbo.ItemFile ifi ON ifi.NUM = ti.ITEM\nJOIN POR.dbo.ParameterFile pf ON pf.Store = t.[STR]\nJOIN (SELECT t0.CNTR, t0.[DATE] AS OriginalContractDate FROM POR.dbo.Transactions t0 WHERE RIGHT(t0.CNTR,1) NOT LIKE '[A-Za-z]%') t1\nON t1.CNTR = CASE WHEN RIGHT(t.CNTR,1) LIKE '[A-Za-z]%' THEN LEFT(t.CNTR, LEN(t.CNTR)-1) ELSE t.CNTR END\nLEFT JOIN POR.dbo.ItemComments ic ON ic.NUM = ifi.NUM\nLEFT JOIN POR.dbo.CustomerFile cf ON cf.CNUM = t.CUSN\nLEFT JOIN POR.dbo.CustomerJobSite cjs ON cjs.Number = t.JobSite\nLEFT JOIN POR.dbo.Salesman s ON s.Number = t.Salesman\nLEFT JOIN POR.dbo.Salesman s2 ON s2.Number = cf.Salesman -- Example CNTR 103071 See GUI. Trans SM is Misha Tufkova, but Customer assigned SM is Daniel Lee\nLEFT JOIN POR.dbo.OperatorId o ON o.OPNO = t.OperatorCreated\nLEFT JOIN POR.dbo.OperatorId o2 ON o2.OPNO = t.OperatorAssigned -- Exampel CMTR 102919 See GUI.\nLEFT JOIN (SELECT [ItemNumber] ,sum(([QuantityPurchased] - [QuantitySold]) * ([PriceEach] + [ExtraCharges])) AS OEC\nFROM [ItemPurchaseDetail]\nWHERE [Disposed] = 0\nGROUP BY [ItemNumber]) AS ITF_OEC ON ifi.[NUM] = ITF_OEC.[ItemNumber]\nWHERE LEFT(t.STAT,1) = 'O'\nAND LEFT(t.CNTR,1) NOT IN ('q','r','s','t')\nAND (ifi.TYPE IN ('T','H','U','V','A','L','R','N','K','D') -- Include Rental types & delivery/pickup charges only; exclude sales, diesel, etc.\nOR ifi.Name LIKE 'Delivery%' --2. Sale items to include\nOR ifi.Name LIKE 'Pickup%' --3. Sale items to include\\\n)\nAND t.STAT NOT IN ('OH','RR','OR')\nAND ti.TXTY <> 'RR'\nORDER BY [Store_Name], cf.[NAME], t.[DATE] ASC, t.CNTR, s.[Name]",
						"queryTimeout": "02:00:00",
						"partitionOption": "None"
					},
					"sink": {
						"type": "AzureSqlSink",
						"preCopyScript": "truncate table por.POR_Open_Contracts",
						"writeBehavior": "insert",
						"sqlWriterUseTableLock": false,
						"disableMetricsCollection": false
					},
					"enableStaging": false,
					"translator": {
						"type": "TabularTranslator",
						"mappings": [
							{
								"source": {
									"name": "Store_Name",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Store_Name",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Store_No",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Store_No",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Customer_Type",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Customer_Type",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Customer_Number",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Customer_Number",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Customer_Name",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Customer_Name",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Job_Name",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Job_Name",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Job_PO",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Job_PO",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Job_id",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Job_ID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Job_Site_Name",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Job_Site_Name",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Job_Site_Address",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Job_Site_Address",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Extended_Protection_Plan",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								},
								"sink": {
									"name": "Extended_Protection_Plan",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								}
							},
							{
								"source": {
									"name": "Contract_Salesman",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Contract_Salesman",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Customer_Salesman",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Customer_Salesman",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Created_by_Operator_Name",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Created_By_Operator_Name",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Assigned_to_Operator_Name",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Assigned_To_Operator_Name",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Contract_Date",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "Contract_Date",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "Original_Contract_Date",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "Original_Contract_Date",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "Contract_No",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Contract_No",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Item_Status",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Item_Status",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Header",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Header",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "KEY",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Key",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Name",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Name",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Serial_Number",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Serial_Number",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Make",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Make",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Model",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Model",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Model_Year",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Model_Year",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Amount_Charged",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								},
								"sink": {
									"name": "Amount_Charged",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								}
							},
							{
								"source": {
									"name": "Daily",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								},
								"sink": {
									"name": "Daily",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								}
							},
							{
								"source": {
									"name": "Book_Rate_Daily",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								},
								"sink": {
									"name": "Book_Rate_Daily",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								}
							},
							{
								"source": {
									"name": "Weekly",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								},
								"sink": {
									"name": "Weekly",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								}
							},
							{
								"source": {
									"name": "Book_Rate_Weekly",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								},
								"sink": {
									"name": "Book_Rate_Weekly",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								}
							},
							{
								"source": {
									"name": "Monthly",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								},
								"sink": {
									"name": "Monthly",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								}
							},
							{
								"source": {
									"name": "Book_Rate_Monthly",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								},
								"sink": {
									"name": "Book_Rate_Monthly",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								}
							},
							{
								"source": {
									"name": "Is_Substitute",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Is_Substitute",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Substitution_Comments",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Substitution_Comments",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "last_refresh_date",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "last_refresh_date",
									"type": "DateTime",
									"physicalType": "date"
								}
							},
							{
								"source": {
									"name": "ItemNum",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "ItemNum",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "OEC",
									"type": "Double",
									"physicalType": "float"
								},
								"sink": {
									"name": "OEC",
									"type": "Double",
									"physicalType": "float"
								}
							},
							{
								"source": {
									"name": "Job site zipcode",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Job Site ZipCode",
									"type": "String",
									"physicalType": "nvarchar"
								}
							}
						],
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "POR_Dataset",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "Briggs_MDW",
						"type": "DatasetReference",
						"parameters": {
							"schema_name": "POR",
							"table_name": "POR_Open_Contracts"
						}
					}
				]
			},
			{
				"name": "Inventory",
				"type": "Copy",
				"dependsOn": [
					{
						"activity": "POR_Open_Contract",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "SqlServerSource",
						"sqlReaderQuery": "/*\nDATA PULL_Inventory_approved_v2\nLast edit:  2022 March 22\n*/\n\n--Temp table (1/1)\tHave system generate unique dates\n--IF OBJECT_ID('tempdb..#DateRange') IS NOT NULL \n--   DROP TABLE #DateRange;  \n--GO\n--CREATE TABLE #DateRange (UniqueDate DATE PRIMARY KEY)\n--INSERT INTO #DateRange\n--SELECT TOP (10592) DATEADD(DAY,ROW_NUMBER() OVER (ORDER BY (SELECT 1)), '20201231') AS N\n--FROM master.dbo.spt_values v1, master.dbo.spt_values v2;\nwith DateRange_cte As\n(\n\tSELECT TOP (10592) DATEADD(DAY,ROW_NUMBER() OVER (ORDER BY (SELECT 1)), '20201231') AS UniqueDate\n\tFROM master.dbo.spt_values v1, master.dbo.spt_values v2\n)\n\n--CTEs:  amalgamate details and summary for scripted/automatic aggregation as needed\n--CTE (1/5)\t\tRepair info:  details and aggregates\n, repairs_cte AS\t\t--alias:  rc\n(\nSELECT\n  ti0.ITEM\n, summary.MaintenanceType\n, summary.TotalLaborHours\n, CAST(summary.LaborCost/NULLIF(summary.NumAssets,0) AS DECIMAL(18,2)) AS LaborCost\n, CAST(summary.ServicePartsCost/NULLIF(summary.NumAssets,0) AS DECIMAL(18,2)) AS ServicePartsCost\n, summary.OutDate\n, summary.CompletedDate\n, summary.CNTR\n, summary.DaysDown\nFROM POR.dbo.TransactionItems ti0\nJOIN POR.dbo.ItemFile ifi0 ON ifi0.NUM = ti0.ITEM\nJOIN (\n\tSELECT\n\t  details.CNTR\n\t, details.MaintenanceType\n\t, SUM(IIF(details.Asset = 1,1,0)) AS NumAssets\n\t, SUM(details.LaborHours) AS TotalLaborHours\n\t, SUM(IIF(details.Name LIKE 'labor', details.Pric,0)) AS LaborCost\n\t, SUM(IIF(details.Name NOT LIKE 'labor', details.Pric,0)) AS ServicePartsCost\n\t, MIN(details.OutDate) AS OutDate\n\t, MAX(details.CompletedDate) AS CompletedDate\n\t, DATEDIFF(d,details.OutDate,IIF(details.CompletedDate IS NULL, GETDATE(),details.CompletedDate)) AS DaysDown\n\tFROM (\n\t\tSELECT t.CNTR, ti.Sort, ifi.Asset, ifi.Name, ifi.NUM, IIF(ifi.Name LIKE '%labor%', ti.QTY, 0) AS LaborHours, ti.PRIC\n\t\t, CASE WHEN CF.[KEY] LIKE 'REPAIRS-MAINT%' THEN 'IMO'\n\t\t\tWHEN CF.[KEY] NOT LIKE 'REPAIRS-MAINT%' THEN 'IRO'\n\t\t\tEND AS [MaintenanceType]\n\t\t, CF.[KEY]\n\t\t, CAST(t.[DATE] AS DATE) AS OutDate\n\t\t, CAST(t.Completed AS DATE) AS CompletedDate\n\t\tFROM POR.dbo.Transactions t\n\t\tJOIN POR.dbo.TransactionItems ti ON ti.CNTR = t.CNTR\n\t\tJOIN POR.dbo.ItemFile ifi ON ifi.NUM = ti.ITEM\n\t\tJOIN POR.dbo.CustomerFile CF ON T.CUSN = CF.CNUM\n\t\tWHERE LEFT(t.CNTR,1) = 'r'\n\t\tAND LEFT(ti.Sort,4) <> 'zzzz'\n\t\tAND RIGHT(ifi.[KEY],2) <> 'RR'\n\t) details\n\tGROUP BY\n\t  details.CNTR\n\t, details.MaintenanceType\n\t, DATEDIFF(d,details.OutDate,IIF(details.CompletedDate IS NULL, GETDATE(),details.CompletedDate))\n) summary ON summary.CNTR = ti0.CNTR\nWHERE ifi0.Asset = 1\n)\n\n--CTE (2/5)\t\tRepair info:  Days since item was last down\n, lastCompletedDate_cte AS\t\t--alias:  lcd\n(\nSELECT ITEM, repairs_cte.MaintenanceType, repairs_cte.CompletedDate AS LastCompletedDate\n\t, ROW_NUMBER() OVER(PARTITION BY repairs_cte.ITEM ORDER BY (CASE WHEN repairs_cte.CompletedDate IS NULL THEN GETDATE() ELSE repairs_cte.CompletedDate END) DESC) AS [RowNumber]\nFROM repairs_cte\n)\n\n--CTE (3/5)\t\tRepair days:  Use unique days\n, repairDays_cte AS\t\t--alias:  rd\n(\n\tSELECT\n\t  a.ITEM\n\t, COUNT(DISTINCT CASE WHEN a.UniqueDate >= '2021-12-01' AND a.MaintenanceType = 'IMO' THEN a.UniqueDate ELSE NULL END) AS TotalDaysIMO\n\t, COUNT(DISTINCT CASE WHEN a.UniqueDate >= '2021-12-01' AND a.MaintenanceType = 'IRO' THEN a.UniqueDate ELSE NULL END) AS TotalDaysIRO\n\t, COUNT(DISTINCT CASE WHEN a.UniqueDate >= '2021-12-01' THEN a.UniqueDate ELSE NULL END) AS TotalDaysRepair\n\tFROM (\n\t\tSELECT\n\t\tti3.ITEM\n\t\t, CASE WHEN CF3.[KEY] LIKE 'REPAIRS-MAINT%' THEN 'IMO'\n\t\t\tWHEN CF3.[KEY] NOT LIKE 'REPAIRS-MAINT%' THEN 'IRO'\n\t\t\tEND AS [MaintenanceType]\n\t\t, dr3.UniqueDate\n\t\tFROM POR.dbo.Transactions t3\n\t\tJOIN POR.dbo.TransactionItems ti3 ON ti3.CNTR = t3.CNTR\n\t\tJOIN POR.dbo.ItemFile ifi3 ON ifi3.NUM = ti3.ITEM\n\t\tJOIN POR.dbo.CustomerFile CF3 ON T3.CUSN = CF3.CNUM\n\t\tJOIN DateRange_cte dr3 ON dr3.UniqueDate BETWEEN CAST(t3.[DATE] AS DATE) AND CAST(CASE WHEN t3.Completed IS NULL THEN GETDATE() ELSE CAST(t3.Completed AS DATE) END AS DATE)\n\t\tWHERE LEFT(t3.CNTR,1) = 'r'\n\t\tAND LEFT(ti3.Sort,4) <> 'zzzz'\n\t\tAND RIGHT(ifi3.[KEY],2) <> 'RR'\n\t\tGROUP BY\n\t\tti3.ITEM\n\t\t, CASE WHEN CF3.[KEY] LIKE 'REPAIRS-MAINT%' THEN 'IMO'\n\t\t\tWHEN CF3.[KEY] NOT LIKE 'REPAIRS-MAINT%' THEN 'IRO'\n\t\t\tEND\n\t\t, dr3.UniqueDate\n\t) a\n\tGROUP BY\n\t  a.ITEM\n)\n\n--CTE (4/5)\t\tContract info:  Aggregates by ITEM\n, contractRev_cte AS\t--alias:  cr\n(\nSELECT\n  c.ITEM\n, SUM(c.TotalContractRevenue) AS TotalRentalRevenue\n, SUM(c.[30d_ContractRevenue]) AS [30d_TotalRentalRevenue]\n, SUM(c.[60d_ContractRevenue]) AS [60d_TotalRentalRevenue]\n, SUM(c.[90d_ContractRevenue]) AS [90d_TotalRentalRevenue]\n, SUM(c.[180d_ContractRevenue]) AS [180d_TotalRentalRevenue]\n, SUM(c.[R12d_ContractRevenue]) AS [R12d_TotalRentalRevenue]\n, SUM(c.[YTD_ContractRevenue]) AS [YTD_TotalRentalRevenue]\n, CAST(MAX(c.MaxContractStartDate) AS DATE) AS [LastItemContractStartDate]\n, CAST(MAX(c.MaxContractDate) AS DATE) AS [LastItemContractDate]\n, CAST(MAX(c.MaxCurrentDate) AS DATE) AS [LastItemContractDate_current]\nFROM (\n\tSELECT\n\t  LEFT(b.CNTR,6) AS CNTR\n\t, b.ITEM\n\t, SUM(b.PRIC) AS TotalContractRevenue\n\t, SUM(CASE WHEN b.ARdays  = 30 THEN b.PRIC ELSE 0 END) AS [30d_ContractRevenue]\n\t, SUM(CASE WHEN b.ARdays <= 60 THEN b.PRIC ELSE 0 END) AS [60d_ContractRevenue]\n\t, SUM(CASE WHEN b.ARdays <= 90 THEN b.PRIC ELSE 0 END) AS [90d_ContractRevenue]\n\t, SUM(CASE WHEN b.ARdays <= 180 THEN b.PRIC ELSE 0 END) AS [180d_ContractRevenue]\n\t, SUM(CASE WHEN b.ARdays <= 365 THEN b.PRIC ELSE 0 END) AS [R12d_ContractRevenue]\n\t, SUM(IIF(YEAR(b.DATE) = YEAR(GETDATE()),b.PRIC,0)) AS [YTD_ContractRevenue]\n\t, MAX(b.DATE) AS MaxContractStartDate\n\t, MAX(b.MaxActualContractDate) AS MaxContractDate\n\t, MAX(b.MaxCurrentContractDate) AS MaxCurrentDate\n\tFROM (\n\t\tSELECT\n\t\t  ti0.CNTR\n\t\t, ti0.ITEM\n\t\t, ti0.PRIC\n\t\t, CASE WHEN DATEDIFF(d,t0.[DATE],GETDATE()) <= 30 THEN 30\n\t\t\tWHEN DATEDIFF(d,t0.[DATE],GETDATE()) > 30 AND DATEDIFF(d,t0.[DATE],GETDATE()) <= 60 THEN 60\n\t\t\tWHEN DATEDIFF(d,t0.[DATE],GETDATE()) > 60 AND DATEDIFF(d,t0.[DATE],GETDATE()) <= 90 THEN 90\n\t\t\tWHEN DATEDIFF(d,t0.[DATE],GETDATE()) > 90 AND DATEDIFF(d,t0.[DATE],GETDATE()) <= 180 THEN 180\n\t\t\tWHEN DATEDIFF(d,t0.[DATE],GETDATE()) > 180 AND DATEDIFF(d,t0.[DATE],GETDATE()) <= 365 THEN 365\n\t\t\tELSE 9999 END AS ARdays\n\t\t, t0.[DATE]\n\t\t, a.MaxActualContractDate\n\t\t, a.MaxCurrentContractDate\n\t\tFROM POR.dbo.Transactions t0\n\t\tJOIN POR.dbo.TransactionItems ti0 ON ti0.CNTR = t0.CNTR\n\t\tJOIN POR.dbo.ItemFile ifi0 ON ifi0.NUM = ti0.ITEM\n\t\tJOIN POR.dbo.ItemType it0 ON it0.[Type] = ifi0.[TYPE]\n\t\tJOIN (\n\t\t\t\tSELECT LEFT(ti1.CNTR,6) AS CNTRgroup, ti1.ITEM\n\t\t\t\t, MIN(t1.[DATE]) AS MinContractDate\n\t\t\t\t, MAX(CASE WHEN ti1.TXTY IN ('RR','RX') THEN ti1.DDT ELSE t1.CLDT END) AS MaxActualContractDate\t\t--basing on picked up date because they are partitioning at the item level\n\t\t\t\t, MAX(CASE WHEN t1.CLDT IS NULL THEN '3333-12-31' WHEN ti1.TXTY IN ('RR','RX') THEN ti1.DDT ELSE t1.CLDT END) AS MaxCurrentContractDate\n\t\t\t\tFROM POR.dbo.Transactions t1\n\t\t\t\tJOIN POR.dbo.TransactionItems ti1 ON ti1.CNTR = t1.CNTR\n\t\t\t\tJOIN POR.dbo.ItemFile ifi1 ON ifi1.NUM = ti1.ITEM\n\t\t\t\tWHERE ((ifi1.UserDefined1 <> '' AND t1.[DATE] >= '2021-12-01') OR ifi1.UserDefined1 = '')\n\t\t\t\tAND t1.[DATE] <= GETDATE()\n\t\t\t\tGROUP BY LEFT(ti1.CNTR,6), ti1.ITEM\n\t\t) a ON a.CNTRgroup = LEFT(ti0.CNTR,6) AND a.ITEM = ifi0.NUM\n\t\tWHERE LEFT(t0.CNTR,1) NOT IN ('q','r','s','t','w','c') \n\t\tAND LEFT(it0.TypeDescrip,6) = 'Rental'\n\t\tAND RIGHT(ifi0.[KEY],2) <> 'RR'\n\t\tAND ((ifi0.UserDefined1 <> '' AND t0.[DATE] >= '2021-12-01') OR ifi0.UserDefined1 = '')\n\t\tAND t0.[DATE] <= GETDATE()\n\t) b\n\tGROUP BY\n\t  LEFT(b.CNTR,6)\n\t, b.ITEM\n) c\nGROUP BY\n  c.ITEM\n)\n\n--CTE (5/5)\t\tTimeUt by Item info:  uses temp table at beginning of query\n, timeUt_cte AS (\t--alias:  tu\nSELECT\n  a.ITEM\n, SUM(IIF(a.UniqueDate >= CAST(IIF(DATEADD(DAY,-30,GETDATE()) < '2021-12-01', '2021-12-01',DATEADD(DAY,-30,GETDATE()+1)) AS DATE), 1, 0)) AS [30dDistinct_OnRent]\n, SUM(IIF(a.UniqueDate >= CAST(IIF(DATEADD(DAY,-90,GETDATE()) < '2021-12-01', '2021-12-01',DATEADD(DAY,-90,GETDATE()+1)) AS DATE), 1, 0)) AS [90dDistinct_OnRent]\n, SUM(IIF(a.UniqueDate >= CAST(IIF(DATEADD(DAY,-180,GETDATE()) < '2021-12-01', '2021-12-01',DATEADD(DAY,-180,GETDATE()+1)) AS DATE), 1, 0)) AS [180dDistinct_OnRent]\n, SUM(IIF(a.UniqueDate >= CAST(IIF(DATEADD(DAY,-365,GETDATE()) < '2021-12-01', '2021-12-01',DATEADD(DAY,-365,GETDATE()+1)) AS DATE), 1, 0)) AS [R12dDistinct_OnRent]\n, SUM(IIF(a.UniqueDate >= DATEADD(yy, DATEDIFF(yy, 0, GETDATE()), 0), 1, 0)) AS [YTDdistinct_OnRent]\n, SUM(IIF(a.UniqueDate >= '2021-12-01', 1, 0)) AS [TotalDistinct_UT]\nFROM (\n\tSELECT ti2.ITEM, dr.UniqueDate\n\tFROM POR.dbo.Transactions t2\n\tJOIN POR.dbo.TransactionItems ti2 ON ti2.CNTR = t2.CNTR\n\tJOIN POR.dbo.ItemFile ifi2 ON ifi2.NUM = ti2.ITEM\n\tJOIN POR.dbo.ItemPurchaseDetail ipd2 ON ipd2.ItemNumber = ifi2.NUM\n\tJOIN DateRange_cte dr ON dr.UniqueDate BETWEEN CAST(t2.[DATE] AS DATE) AND CAST(CASE WHEN t2.CLDT IS NULL THEN GETDATE() ELSE ti2.DDT END AS DATE)\n\tWHERE LEFT(t2.CNTR,1) NOT IN ('q','r','s','t','w','c')\n\tAND ifi2.SerialNumber <> ''\n\tAND t2.DATE < CAST(GETDATE() AS DATE)\n\tAND dr.UniqueDate <= GETDATE()\n\tAND dr.UniqueDate >= ipd2.PurchaseDate\n\tGROUP BY ti2.ITEM, dr.UniqueDate\n) a\nGROUP BY a.ITEM\n)\n\n\n\n--MAIN QUERY:\n--Expected approximation:  3.4k results\nSELECT\nifi.[KEY], ifi.Header, ifi.[Name], ic.[Name] AS Category, ifi.MANF AS Make, ifi.MODN AS Model\n, ifi.ModelYear AS [Model_Year], ifi.SerialNumber AS [Serial_Number]\n, DATEDIFF(m,ipd.PurchaseDate,GETDATE()) AS [Age_In_Months]\n, CAST(ipd.PurchaseDate AS DATE) AS [Original_DOP], ipd.OEC, ifi.CURV AS NBV, ifi.DEPA AS [Accum_Depr]\n, ifi.PURP AS [Acquisition_Cost], ipd.PONumber AS [PO_Number], ipd.ExtraCost AS [Extra_Cost], ifi.CurrentStore AS [Current_Store]\n, CASE WHEN pf.Store <> '001' THEN RIGHT(pf.STORE_NAME, LEN(pf.STORE_NAME) - 4) ELSE pf.STORE_NAME END AS [Store_Name]\n, it.TypeDescrip AS [Type], ifi.MTOT AS [Hours], ifi.UserDefined1 AS [Legacy_ID]\n\n--Time utilization\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[30dDistinct_OnRent] AS DECIMAL(18,2))/30.00 *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [30d_TU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[90dDistinct_OnRent] AS DECIMAL(18,2))/90.00 *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [90d_TU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[180dDistinct_OnRent] AS DECIMAL(18,2))/180.00 *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [180d_TU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[R12dDistinct_OnRent] AS DECIMAL(18,2))/365.00 *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [R12_TU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[YTDdistinct_OnRent] AS DECIMAL(18,2))/(DATEDIFF(d,DATEADD(yy, DATEDIFF(yy, 0, GETDATE()), 0),GETDATE()+1)) *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [YTD_TU]\n\n--Dollar utilization\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[30d_TotalRentalRevenue]/NULLIF(ipd.OEC,0))*12) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [30d_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[90d_TotalRentalRevenue]/NULLIF(ipd.OEC,0))*4) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [90d_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[180d_TotalRentalRevenue]/NULLIF(ipd.OEC,0))*2) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [180d_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[R12d_TotalRentalRevenue]/NULLIF(ipd.OEC,0))) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [R12_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[YTD_TotalRentalRevenue]/NULLIF(ipd.OEC,0))*(365/DATEDIFF(d,DATEADD(yy, DATEDIFF(yy, 0, GETDATE()), 0),GETDATE()))) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [YTD_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN ISNULL(cr.TotalRentalRevenue,0) ELSE NULL END AS [LTD_Revenue]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL(CAST(CAST(tu.[TotalDistinct_UT] AS DECIMAL(18,2)) / NULLIF(DATEDIFF(d,IIF(ifi.UserDefined1 <> '','2021-12-01',CAST(ipd.PurchaseDate AS DATE)),CAST(GETDATE()+1 AS DATE)),0)*100 AS DECIMAL(18,2)),0) AS VARCHAR(10)) + '%' ELSE NULL END AS [SP%_LTDTU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN ISNULL(CAST(MAX(CAST(CAST(rd.TotalDaysRepair AS DECIMAL(18,2)) / NULLIF(DATEDIFF(d,IIF(ifi.UserDefined1 <> '','2021-12-01',CAST(ipd.PurchaseDate AS DATE)),GETDATE()+1),0)*100 AS DECIMAL(18,2))) AS VARCHAR(10)),0) + '%' ELSE NULL END AS [SP%_Life_Down]\n, IIF((cr.LastItemContractDate_current = '3333-12-31' OR GETDATE() BETWEEN cr.LastItemContractStartDate AND cr.LastItemContractDate_current),'On rent', CAST(DATEDIFF(d,cr.LastItemContractDate,GETDATE())AS VARCHAR(20)) ) AS [Last_Rent_In_Days]\n\n--Maintenance/Repair\n, SUM(IIF(rc.ITEM IS NOT NULL,ISNULL(rc.TotalLaborHours,0),NULL)) AS [Total_Labor_Hours]\n, SUM(rc.LaborCost) AS [Total_Labor_Cost]\n, CASE WHEN rc.ITEM IS NOT NULL AND lcd.RowNumber = 1 AND lcd.LastCompletedDate IS NOT NULL THEN CAST(DATEDIFF(d, lcd.LastCompletedDate,GETDATE()) AS VARCHAR(20))\n\tWHEN rc.ITEM IS NOT NULL AND lcd.LastCompletedDate IS NULL THEN CAST('Down' AS VARCHAR(5))\n\tELSE NULL END AS [Days_Since_Last_Down]\n, lcd.MaintenanceType AS [Last_Down_Type]\n, SUM(IIF(rc.ITEM IS NOT NULL,IIF(rc.MaintenanceType = 'IRO',1,0),NULL)) AS [IRO_Totals]\n, rd.TotalDaysIRO AS [IRO_Days_Down]\n, SUM(IIF(rc.ITEM IS NOT NULL,IIF(rc.MaintenanceType = 'IRO',rc.LaborCost + rc.ServicePartsCost,0),NULL)) AS [IRO_Labor_Parts_Cost]\n, SUM(IIF(rc.ITEM IS NOT NULL,IIF(rc.MaintenanceType = 'IMO',1,0),NULL)) AS [IMO_Totals]\n, rd.TotalDaysIMO AS [IMO_Days_Down]\n, SUM(IIF(rc.ITEM IS NOT NULL,IIF(rc.MaintenanceType = 'IMO',rc.LaborCost + rc.ServicePartsCost,0),NULL)) AS [IMO_Labor_PartsCost]\n, GETDATE() [last_refresh_date]\nFROM POR.dbo.ItemFile ifi\nLEFT JOIN POR.dbo.ItemCategory ic ON ic.Category = ifi.Category\nJOIN POR.dbo.ItemType it ON it.[Type] = ifi.[TYPE]\nJOIN (SELECT\n\t\tipd0.ItemNumber, CASE WHEN ipd0.PONumber = 0 THEN NULL ELSE ipd0.PONumber END AS PONumber, ipd0.PurchaseDate, ipd0.ExtraCharges AS ExtraCost\n\t\t, SUM(([QuantityPurchased] - [QuantitySold]) * ([PriceEach] + [ExtraCharges])) AS OEC\n\t\t, ROW_NUMBER() OVER(PARTITION BY ipd0.ItemNumber ORDER BY ipd0.PurchaseDate) AS [RowNumber]\n\t\tFROM POR.dbo.ItemPurchaseDetail ipd0\n\t\tWHERE ipd0.QuantityPurchased > 0\n\t\tGROUP BY ipd0.ItemNumber, CASE WHEN ipd0.PONumber = 0 THEN NULL ELSE ipd0.PONumber END, ipd0.PurchaseDate, ipd0.ExtraCharges\n\t) ipd ON ipd.ItemNumber = ifi.NUM\nLEFT JOIN POR.dbo.ParameterFile pf ON pf.Store = ifi.CurrentStore\nLEFT JOIN repairs_cte rc ON rc.ITEM = ifi.NUM\nLEFT JOIN lastCompletedDate_cte lcd ON lcd.ITEM = ifi.NUM AND lcd.RowNumber = 1\nLEFT JOIN contractRev_cte cr ON cr.ITEM = ifi.NUM\nLEFT JOIN timeUt_cte tu ON tu.ITEM = ifi.NUM\nLEFT JOIN repairDays_cte rd ON rd.ITEM = ifi.NUM\n\nWHERE ifi.SerialNumber <> ''\nAND ifi.QTY > 0\nAND ipd.RowNumber = 1\nAND RIGHT(ifi.[KEY],2) <> 'RR'\n\nGROUP BY\n  ifi.[KEY], ifi.Header, ifi.NUM, ifi.[Name], ic.[Name], ifi.MANF, ifi.MODN, ifi.ModelYear, ifi.SerialNumber, ipd.PurchaseDate, ipd.PONumber, ipd.OEC, ipd.ExtraCost, ifi.CurrentStore, CASE WHEN pf.Store <> '001' THEN RIGHT(pf.STORE_NAME, LEN(pf.STORE_NAME) - 4) ELSE pf.STORE_NAME END  \n, it.TypeDescrip, ifi.MTOT, ifi.CURV, ifi.DEPA, ifi.PURP, ifi.UserDefined1\n, CASE WHEN rc.ITEM IS NOT NULL AND lcd.RowNumber = 1 AND lcd.LastCompletedDate IS NOT NULL THEN CAST(DATEDIFF(d, lcd.LastCompletedDate,GETDATE()) AS VARCHAR(20))\n\tWHEN rc.ITEM IS NOT NULL AND lcd.LastCompletedDate IS NULL THEN CAST('Down' AS VARCHAR(5))\n\tELSE NULL END, lcd.MaintenanceType\n, cr.TotalRentalRevenue\n, tu.[TotalDistinct_UT]\n, IIF((cr.LastItemContractDate_current = '3333-12-31' OR GETDATE() BETWEEN cr.LastItemContractStartDate AND cr.LastItemContractDate_current),'On rent', CAST(DATEDIFF(d,cr.LastItemContractDate,GETDATE())AS VARCHAR(20)) )\n, rd.TotalDaysIRO, rd.TotalDaysIMO\n\nORDER BY RTRIM(LTRIM(ifi.Num))\n\n--DROP TABLE #DateRange",
						"queryTimeout": "02:00:00",
						"partitionOption": "None"
					},
					"sink": {
						"type": "AzureSqlSink",
						"preCopyScript": "truncate table por.Inventory",
						"writeBehavior": "insert",
						"sqlWriterUseTableLock": false,
						"disableMetricsCollection": false
					},
					"enableStaging": false,
					"translator": {
						"type": "TabularTranslator",
						"mappings": [
							{
								"source": {
									"name": "KEY",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "KEY",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Name",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Name",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Model",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Model",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Serial_Number",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Serial_Number",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Model_Year",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Model_Year",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Age_In_Months",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "Age_In_Months",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "Original_DOP",
									"type": "DateTime",
									"physicalType": "date"
								},
								"sink": {
									"name": "Original_DOP",
									"type": "DateTime",
									"physicalType": "date"
								}
							},
							{
								"source": {
									"name": "OEC",
									"type": "Double",
									"physicalType": "float"
								},
								"sink": {
									"name": "OEC",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								}
							},
							{
								"source": {
									"name": "NBV",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								},
								"sink": {
									"name": "NBV",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								}
							},
							{
								"source": {
									"name": "Accum_Depr",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								},
								"sink": {
									"name": "Accum_Depr",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								}
							},
							{
								"source": {
									"name": "Acquisition_Cost",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								},
								"sink": {
									"name": "Acquisition_Cost",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								}
							},
							{
								"source": {
									"name": "PO_Number",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "PO_Number",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "Extra_Cost",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								},
								"sink": {
									"name": "Extra_Cost",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								}
							},
							{
								"source": {
									"name": "Current_Store",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Current_Store",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Category",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Category",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Header",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Header",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Type",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Type",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Hours",
									"type": "Single",
									"physicalType": "real"
								},
								"sink": {
									"name": "Hours",
									"type": "Single",
									"physicalType": "real"
								}
							},
							{
								"source": {
									"name": "Make",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Make",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Legacy_ID",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Legacy_ID",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "30d_TU",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "30d_TU",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "90d_TU",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "90d_TU",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "180d_TU",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "180d_TU",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "R12_TU",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "R12_TU",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "YTD_TU",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "YTD_TU",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "30d_$Ut%",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "30d_$Ut%",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "90d_$Ut%",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "90d_$Ut%",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "180d_$Ut%",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "180d_$Ut%",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "R12_$Ut%",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "R12_$Ut%",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "YTD_$Ut%",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "YTD_$Ut%",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "LTD_Revenue",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								},
								"sink": {
									"name": "LTD_Revenue",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								}
							},
							{
								"source": {
									"name": "SP%_LTDTU",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "SP%_LTDTU",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "SP%_Life_Down",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "SP%_Life_Down",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Last_Rent_In_Days",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Last_Rent_In_Days",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Total_Labor_Hours",
									"type": "Double",
									"physicalType": "float"
								},
								"sink": {
									"name": "Total_Labor_Hours",
									"type": "Double",
									"physicalType": "float"
								}
							},
							{
								"source": {
									"name": "Total_Labor_Cost",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 2,
									"precision": 38
								},
								"sink": {
									"name": "Total_Labor_Cost",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								}
							},
							{
								"source": {
									"name": "Days_Since_Last_Down",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Days_Since_Last_Down",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Last_Down_Type",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Last_Down_Type",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "IRO_Totals",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "IRO_Totals",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "IRO_Days_Down",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "IRO_Days_Down",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "IRO_Labor_Parts_Cost",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 2,
									"precision": 38
								},
								"sink": {
									"name": "IRO_Labor_Parts_Cost",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								}
							},
							{
								"source": {
									"name": "IMO_Totals",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "IMO_Totals",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "IMO_Days_Down",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "IMO_Days_Down",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "IMO_Labor_PartsCost",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 2,
									"precision": 38
								},
								"sink": {
									"name": "IMO_Labor_PartsCost",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								}
							},
							{
								"source": {
									"name": "last_refresh_date",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "last_refresh_date",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "Store_Name",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Store_Name",
									"type": "String",
									"physicalType": "nvarchar"
								}
							}
						],
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "POR_Dataset",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "Briggs_MDW",
						"type": "DatasetReference",
						"parameters": {
							"schema_name": "POR",
							"table_name": "Inventory"
						}
					}
				]
			},
			{
				"name": "Purchase_Orders",
				"type": "Copy",
				"dependsOn": [
					{
						"activity": "Inventory",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "SqlServerSource",
						"sqlReaderQuery": "--IF OBJECT_ID('tempdb..##POStatus') IS NOT NULL\n--   DROP TABLE #POStatus;\n\n--CREATE TABLE #POStatus (POStatusID VARCHAR(1) PRIMARY KEY, POStatus VARCHAR(15))\n\nDeclare @POStatus as TABLE (POStatusID VARCHAR(1) PRIMARY KEY, POStatus VARCHAR(15))\nINSERT INTO @POStatus VALUES\n('O', 'Open')\n,('B', 'BackOrdered')\n,('C', 'Closed')\n,('V', 'Voided')\n,('P', 'Requisition');\n\n --CTE (1/1)  ShipTo column - clean and normalize\n\nWITH storeName_cte AS (\nSELECT\npo.PONumber, po.Sequence, pod.LineNumber, post.Company\n, CASE WHEN post.Company LIKE '%Reserve%' THEN 'Reserve'\n       WHEN po.Notes LIKE '%Ship to%#%' THEN IIF(ISNUMERIC(LEFT(LTRIM(SUBSTRING(po.Notes,CHARINDEX('#',po.Notes)+1,LEN(po.Notes))),3))=1, LEFT(LTRIM(SUBSTRING(po.Notes,CHARINDEX('#',po.Notes)+1,LEN(po.Notes))),3), 'Reserve')\n       WHEN po.Notes LIKE '%Ship to %' THEN IIF(ISNUMERIC(LTRIM(RTRIM(SUBSTRING(post.Company, PATINDEX('%[0-9]%', post.Company), PATINDEX('%[0-9][^0-9]%', post.Company + 't') - PATINDEX('%[0-9]%', post.Company) + 1))))=1,LTRIM(RTRIM(SUBSTRING(post.Company, PATINDEX('%[0-9]%', post.Company), PATINDEX('%[0-9][^0-9]%', post.Company + 't') - PATINDEX('%[0-9]%', post.Company) + 1))) ,'Reserve')\n       WHEN po.Notes LIKE '%Reserve%' THEN 'Reserve'\n       WHEN ISNUMERIC(LTRIM(RTRIM(LEFT(post.Company,3))))=1 THEN LTRIM(RTRIM(LEFT(post.Company,3)))\n       WHEN ISNUMERIC(LEFT(LTRIM(RTRIM(SUBSTRING(post.Company, PATINDEX('%[0-9]%', post.Company), PATINDEX('%[0-9][^0-9]%', post.Company + 't') - PATINDEX('%[0-9]%', post.Company) + 1))),3)) =1 THEN CAST(LEFT(LTRIM(RTRIM(SUBSTRING(post.Company, PATINDEX('%[0-9]%', post.Company), PATINDEX('%[0-9][^0-9]%', post.Company + 't') - PATINDEX('%[0-9]%', post.Company) + 1))),3) AS VARCHAR(MAX))\n       WHEN ifi.CurrentStore > 0 THEN ifi.CurrentStore\n       ELSE 'Unknown' END AS StoreNumber\nFROM POR.dbo.PurchaseOrder po\nJOIN POR.dbo.PurchaseOrderDetail pod ON pod.PONumber = po.PONumber AND pod.[Sequence] = po.[Sequence]\nLEFT JOIN POR.dbo.PurchaseOrderShipTo post ON post.PONumber = po.PONumber AND post.[Sequence] = po.[Sequence]\nLEFT JOIN POR.dbo.ItemFile ifi ON ifi.NUM = pod.ItemNumber\nLEFT JOIN POR.dbo.ParameterFile pf ON pf.Store = ifi.CurrentStore\n)\n\n--Main select\n\nSELECT\n  po.PONumber AS [PO_Number]\n, po.Store\n, COALESCE(pf.STORE_NAME, IIF(LEN(sn.StoreNumber)=3, sn.Company,sn.StoreNumber)) AS [Ship_To]\n, po.[Sequence]\n, pod.LineNumber AS [Line_Number]\n, CASE WHEN po.[Status] <> 'C' THEN pos.POStatus WHEN po.[Status] = 'C' THEN IIF(LEN(po.InvoiceNumber)>0,'Posted','Closed') END AS [PO_Status]\n, CAST(po.[Date] AS DATE) AS [PO_Date]\n, COALESCE(NULLIF(SUBSTRING(SUBSTRING(REPLACE(pod.Comments,'EST ',''),CHARINDEX('<',pod.Comments)+1,LEN(pod.Comments)),0,CHARINDEX('>',SUBSTRING(REPLACE(pod.Comments,'EST ',''),CHARINDEX('<',pod.Comments)+1,LEN(pod.Comments)))),''),IIF(pod.QuantityOrdered = pod.QuantityReceived,CAST(pod.DateReceived AS DATE),NULL)) AS [Est_Arrival]\n, oi.OPNM AS [PO_By]\n, vh.VendorName AS [Vendor_Name]\n, pod.Comments AS [Line_Comments]\n, po.Notes AS [PO_Notes]\n, pod.ItemNumber AS [PO_Item_Num]\n, COALESCE(ifi.Header,ic.Name) AS [Header]\n, SUBSTRING(ic.[Name],0,CHARINDEX('-',ic.[Name])) AS Category\n, SUBSTRING(ic.[Name],CHARINDEX('-',ic.[Name])+1,LEN(ic.[Name])) AS [Category_Description]\n, pod.ItemName AS [Item_Name]\n, pod.QuantityOrdered AS [Quantity_Ordered]\n, pod.PriceEach AS [Price_Each]\n, pod.ExtendedPrice AS [Extended_Price]\n, CAST((pod.QuantityOrdered * pod.FreightEach) AS DECIMAL(18,2)) AS [Extended_Freight]\n, CAST((pod.QuantityOrdered * pod.TaxEach) AS DECIMAL(18,2)) AS [Extended_Tax]\n, CAST((pod.QuantityOrdered * pod.MiscEach) AS DECIMAL(18,2)) AS [Extended_Misc]\n, CAST(SUM(pod.ExtendedPrice + (pod.QuantityOrdered * pod.FreightEach) + (pod.QuantityOrdered * pod.TaxEach) + (pod.QuantityOrdered * pod.MiscEach)) AS DECIMAL(18,2)) AS [Total_Line_Amt]\n, IIF(pod.QuantityOrdered = pod.QuantityReceived,'Y','N') AS Received\n, po.InvoiceNumber AS [Invoice_Number]\n, IIF(pod.QuantityOrdered = pod.QuantityReceived, CAST(pod.DateReceived AS DATE), NULL) AS [Received_Date]\n, IIF(pod.QuantityOrdered = pod.QuantityReceived, ifi.NUM, NULL) AS [Item_Num]\n, IIF(pod.QuantityOrdered = pod.QuantityReceived, ifi.SerialNumber, NULL) AS [Serial_Number]\n, pogl.Number AS [GL_Number]\n, pogl.GLAccountNumber AS [GL_Account_Number]\n, GETDATE() [Last_Refresh_Date]\nFROM POR.dbo.PurchaseOrder po\nJOIN POR.dbo.PurchaseOrderDetail pod ON pod.PONumber = po.PONumber AND pod.[Sequence] = po.[Sequence]\nJOIN @POStatus pos ON pos.POStatusID = po.[Status]\nJOIN storeName_cte sn ON sn.PONumber = pod.PONumber AND sn.[Sequence] = pod.[Sequence] AND sn.LineNumber = pod.LineNumber\nLEFT JOIN POR.dbo.PurchaseOrderGL pogl ON pogl.Number = pod.GLNumber\nLEFT JOIN POR.dbo.VendorFile vh ON vh.VendorNumber = po.VendorNumber\nLEFT JOIN POR.dbo.ItemFile ifi ON ifi.NUM = pod.ItemNumber\nLEFT JOIN POR.dbo.ItemCategory ic ON ic.Category = ifi.Category\nLEFT JOIN POR.dbo.ParameterFile pf ON pf.Store = sn.StoreNumber\nLEFT JOIN POR.dbo.OperatorId oi ON oi.OPNO = po.Opr\nWHERE pod.GLAccount = 'Equipment ASSET Purchases'\nAND pod.QuantityOrdered > 0\nAND (LEFT(ifi.[KEY],7) <> 'SpclOrd' OR ifi.[KEY] IS NULL)\nGROUP BY\n  po.PONumber\n  , po.Store\n, COALESCE(pf.STORE_NAME, IIF(LEN(sn.StoreNumber)=3, sn.Company,sn.StoreNumber))\n, po.[Sequence]\n, pod.LineNumber\n, CASE WHEN po.[Status] <> 'C' THEN pos.POStatus WHEN po.[Status] = 'C' THEN IIF(LEN(po.InvoiceNumber)>0,'Posted','Closed') END\n, CAST(po.[Date] AS DATE)\n, COALESCE(NULLIF(SUBSTRING(SUBSTRING(REPLACE(pod.Comments,'EST ',''),CHARINDEX('<',pod.Comments)+1,LEN(pod.Comments)),0,CHARINDEX('>',SUBSTRING(REPLACE(pod.Comments,'EST ',''),CHARINDEX('<',pod.Comments)+1,LEN(pod.Comments)))),''),IIF(pod.QuantityOrdered = pod.QuantityReceived,CAST(pod.DateReceived AS DATE),NULL))\n, oi.OPNM\n, vh.VendorName\n, pod.Comments\n, po.Notes\n, pod.ItemNumber\n, COALESCE(ifi.Header,ic.Name)\n, SUBSTRING(ic.[Name],0,CHARINDEX('-',ic.[Name]))\n, SUBSTRING(ic.[Name],CHARINDEX('-',ic.[Name])+1,LEN(ic.[Name]))\n, pod.ItemName\n, pod.QuantityOrdered\n, pod.PriceEach\n, pod.ExtendedPrice\n, CAST((pod.QuantityOrdered * pod.FreightEach) AS DECIMAL(18,2))\n, CAST((pod.QuantityOrdered * pod.TaxEach) AS DECIMAL(18,2))\n, CAST((pod.QuantityOrdered * pod.MiscEach) AS DECIMAL(18,2))\n, IIF(pod.QuantityOrdered = pod.QuantityReceived,'Y','N')\n, po.InvoiceNumber\n, IIF(pod.QuantityOrdered = pod.QuantityReceived, CAST(pod.DateReceived AS DATE), NULL)\n, IIF(pod.QuantityOrdered = pod.QuantityReceived, ifi.NUM, NULL)\n, IIF(pod.QuantityOrdered = pod.QuantityReceived, ifi.SerialNumber, NULL)\n, pogl.Number\n, pogl.GLAccountNumber\n\nORDER BY po.PONumber, po.[Sequence], pod.LineNumber\n\n--DROP TABLE #POStatus\n",
						"queryTimeout": "02:00:00",
						"partitionOption": "None"
					},
					"sink": {
						"type": "AzureSqlSink",
						"preCopyScript": "truncate table por.Purchase_Orders",
						"writeBehavior": "insert",
						"sqlWriterUseTableLock": false,
						"disableMetricsCollection": false
					},
					"enableStaging": false,
					"translator": {
						"type": "TabularTranslator",
						"mappings": [
							{
								"source": {
									"name": "PO_Number",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "PO_Number",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "Store",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Store",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Ship_To",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Ship_To",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Sequence",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "Sequence",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "Line_Number",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "Line_Number",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "PO_Status",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "PO_Status",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "PO_Date",
									"type": "DateTime",
									"physicalType": "date"
								},
								"sink": {
									"name": "PO_Date",
									"type": "DateTime",
									"physicalType": "date"
								}
							},
							{
								"source": {
									"name": "Est_Arrival",
									"type": "DateTime",
									"physicalType": "date"
								},
								"sink": {
									"name": "Est_Arrival",
									"type": "DateTime",
									"physicalType": "date"
								}
							},
							{
								"source": {
									"name": "PO_By",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "PO_By",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Vendor_Name",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Vendor_Name",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Line_Comments",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Line_Comments",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "PO_Notes",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "PO_Notes",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "PO_Item_Num",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "PO_Item_Num",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Header",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Header",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Category",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Category",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Category_Description",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Category_Description",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Quantity_Ordered",
									"type": "Double",
									"physicalType": "float"
								},
								"sink": {
									"name": "Quantity_Ordered",
									"type": "Double",
									"physicalType": "float"
								}
							},
							{
								"source": {
									"name": "Price_Each",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								},
								"sink": {
									"name": "Price_Each",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								}
							},
							{
								"source": {
									"name": "Extended_Price",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								},
								"sink": {
									"name": "Extended_Price",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								}
							},
							{
								"source": {
									"name": "Extended_Freight",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 2,
									"precision": 18
								},
								"sink": {
									"name": "Extended_Freight",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 2,
									"precision": 18
								}
							},
							{
								"source": {
									"name": "Extended_Tax",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 2,
									"precision": 18
								},
								"sink": {
									"name": "Extended_Tax",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 2,
									"precision": 18
								}
							},
							{
								"source": {
									"name": "Extended_Misc",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 2,
									"precision": 18
								},
								"sink": {
									"name": "Extended_Misc",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 2,
									"precision": 18
								}
							},
							{
								"source": {
									"name": "Total_Line_Amt",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 2,
									"precision": 18
								},
								"sink": {
									"name": "Total_Line_Amt",
									"type": "Decimal",
									"physicalType": "decimal",
									"scale": 2,
									"precision": 18
								}
							},
							{
								"source": {
									"name": "Received",
									"type": "String",
									"physicalType": "varchar"
								},
								"sink": {
									"name": "Received",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Received_Date",
									"type": "DateTime",
									"physicalType": "date"
								},
								"sink": {
									"name": "Received_Date",
									"type": "DateTime",
									"physicalType": "date"
								}
							},
							{
								"source": {
									"name": "Item_Num",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Item_Num",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Serial_Number",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Serial_Number",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "GL_Number",
									"type": "Int32",
									"physicalType": "int"
								},
								"sink": {
									"name": "GL_Number",
									"type": "Int32",
									"physicalType": "int"
								}
							},
							{
								"source": {
									"name": "GL_Account_Number",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "GL_Account_Number",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Last_Refresh_Date",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "Last_Refresh_Date",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "Item_Name",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Item_Name",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Invoice_Number",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "Invoice_Number",
									"type": "String",
									"physicalType": "nvarchar"
								}
							}
						],
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "POR_Dataset",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "Briggs_MDW",
						"type": "DatasetReference",
						"parameters": {
							"schema_name": "POR",
							"table_name": "Purchase_Orders"
						}
					}
				]
			},
			{
				"name": "Texas_Heavy_Equipment",
				"type": "Copy",
				"dependsOn": [
					{
						"activity": "Purchase_Orders",
						"dependencyConditions": [
							"Succeeded"
						]
					}
				],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"typeProperties": {
					"source": {
						"type": "SqlServerSource",
						"sqlReaderQuery": "SELECT\n\n  ifi.ModelYear\n\n, cat.[Name] AS CategoryName\n\n, ifi.[Name] AS ItemName\n\n, ifi.[KEY]\n\n, ifi.MANF\n\n, ifi.FUEL\n\n, ifi.PURD PurchaseDate\n\n, ifi.PURP AS purchasePrice\n\n, ifi.CURV CurrentValue\n\n, ifi.HomeStore\n\n, ifi.CurrentStore\n\n, pf.STORE_CITY\n, getdate() Refresh_DateTime\n\nFROM POR.dbo.ItemFile ifi\n\nJOIN POR.dbo.ParameterFile pf ON pf.Store = ifi.HomeStore\n\nJOIN POR.dbo.ItemCategory cat ON cat.Category = ifi.Category\n\nWHERE ifi.GVWR = 1\n\nAND ifi.Asset = 1\n\nAND pf.STORE_CITY LIKE '%TX'\n\nAND ifi.[KEY] NOT LIKE '%RR%'\n\nAND ifi.[TYPE] NOT IN ( 'A' )\n\nAND ifi.SOLD IS NULL\n\nORDER BY ifi.[KEY];",
						"queryTimeout": "02:00:00",
						"partitionOption": "None"
					},
					"sink": {
						"type": "AzureSqlSink",
						"preCopyScript": "truncate table por.Texas_Heavy_Equipment",
						"writeBehavior": "insert",
						"sqlWriterUseTableLock": false,
						"disableMetricsCollection": false
					},
					"enableStaging": false,
					"translator": {
						"type": "TabularTranslator",
						"mappings": [
							{
								"source": {
									"name": "ModelYear",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "ModelYear",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "CategoryName",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "CategoryName",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "ItemName",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "ItemName",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "KEY",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "KEY",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "MANF",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "MANF",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "FUEL",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "FUEL",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "PurchaseDate",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "PurchaseDate",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							},
							{
								"source": {
									"name": "purchasePrice",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								},
								"sink": {
									"name": "PurchasePrice",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								}
							},
							{
								"source": {
									"name": "CurrentValue",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								},
								"sink": {
									"name": "CurrentValue",
									"type": "Decimal",
									"physicalType": "money",
									"scale": 4,
									"precision": 19
								}
							},
							{
								"source": {
									"name": "HomeStore",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "HomeStore",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "CurrentStore",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "CurrentStore",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "STORE_CITY",
									"type": "String",
									"physicalType": "nvarchar"
								},
								"sink": {
									"name": "STORE_CITY",
									"type": "String",
									"physicalType": "nvarchar"
								}
							},
							{
								"source": {
									"name": "Refresh_DateTime",
									"type": "DateTime",
									"physicalType": "datetime"
								},
								"sink": {
									"name": "Refresh_DateTime",
									"type": "DateTime",
									"physicalType": "datetime"
								}
							}
						],
						"typeConversion": true,
						"typeConversionSettings": {
							"allowDataTruncation": true,
							"treatBooleanAsNumber": false
						}
					}
				},
				"inputs": [
					{
						"referenceName": "POR_Dataset",
						"type": "DatasetReference"
					}
				],
				"outputs": [
					{
						"referenceName": "Briggs_MDW",
						"type": "DatasetReference",
						"parameters": {
							"schema_name": "POR",
							"table_name": "Texas_Heavy_Equipment"
						}
					}
				]
			}
		],
		"folder": {
			"name": "To be Deleted"
		},
		"annotations": [],
		"lastPublishTime": "2022-06-22T14:42:29Z"
	},
	"type": "Microsoft.Synapse/workspaces/pipelines"
}